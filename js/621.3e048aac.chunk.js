/*! For license information please see 621.3e048aac.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkwebpack_starter=self.webpackChunkwebpack_starter||[]).push([[621],{8621:function(e,t,i){i.r(t),i.d(t,{DBRWeb:function(){return J}});var r=i(9895),o=i(6652);function n(e,t,i,r){return new(i||(i=Promise))((function(o,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function a(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((r=r.apply(e,t||[])).next())}))}"object"==typeof i.g&&i.g.process&&i.g.process.release&&i.g.process.release.name;const s="undefined"==typeof self;class a{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this.predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this.mapCameraResolutions=new Map,this._bWebGLSupported=!0,this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._cvsSingleFrameMode=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameModeIpt=null,this._clickIptSingleFrameMode=()=>{if(this.singleFrameMode){if(!this._singleFrameModeIpt){const e=document.createElement("input");this._singleFrameModeIpt=e,e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.addEventListener("change",(()=>n(this,void 0,void 0,(function*(){const t=e.files[0];e.value="";const i=yield(e=>n(this,void 0,void 0,(function*(){let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=yield createImageBitmap(e),t)return t}catch(t){}var r;return t||(i=yield(r=e,new Promise(((e,t)=>{let i=URL.createObjectURL(r),o=new Image;o.dbrObjUrl=i,o.src=i,o.onload=()=>{e(o)},o.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i})))(t),r=i instanceof HTMLImageElement?i.naturalWidth:i.width,o=i instanceof HTMLImageElement?i.naturalHeight:i.height;this._imgWidth=r,this._imgHeight=o,(e=>{if(!this._cvsSingleFrameMode){if(this._cvsSingleFrameMode=document.createElement("canvas"),this._cvsSingleFrameMode.className="cvs-single-frame-mode",this._cvsSingleFrameMode.addEventListener("click",this._clickIptSingleFrameMode),this._cvsSingleFrameMode.style.cursor="pointer",this._cvsSingleFrameMode.setAttribute("title","Take a photo"),!this._video)throw new Error("'video' is null.");this._video.after(this._cvsSingleFrameMode)}const t=this._cvsSingleFrameMode;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit="contain",t.width==r&&t.height==o||(t.width=r,t.height=o);let i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0)})(i),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);const s=(e=>{const t=Date.now();if(0===r||0===o)return null;const i=this._scanRegion,n=this.getFrameSize(r,o,i,this.maxCvsSideLength);if(!n)return null;let s,d;s=r!==n.sWidth||o!==n.sHeight,d=n.sWidth!==n.dWidth||n.sHeight!==n.dHeight;const l=(()=>!(!this._bWebGLSupported||d))(),h={data:null,region:i?JSON.parse(JSON.stringify(i)):null,sx:n.sx,sy:n.sy,width:n.dWidth,height:n.dHeight,colorMode:null,timeSpent:null,timeStamp:null,isCropped:s,toCanvas:this.toCanvas,_bUseWebGL:null},c=this._getImageData(e,r,o,n,null,{targetColorMode:this.frameColorMode,bUseWebGL:l});if(!c)return null;const _=Date.now();return a._onLog&&a._onLog("DCE: _getVideoFrame(region?) END: "+_),h.data=c.data,h.colorMode=c.colorMode,h._bUseWebGL=c._bUseWebGL,h.timeSpent=_-t,h.timeStamp=_,h})(i),d=this.mapCameraEvents.get("singleFrameAcquired");for(let e of d)try{const t={data:new Uint8Array(s.data),region:JSON.parse(JSON.stringify(s.region)),sx:s.sx,sy:s.sy,width:s.width,height:s.height,colorMode:s.colorMode,timeSpent:s.timeSpent,timeStamp:s.timeStamp,isCropped:s.isCropped,toCanvas:s.toCanvas,_bUseWebGL:s._bUseWebGL};yield e(t)}catch(e){console.error(e)}})))),e.style.position="fixed",e.style.left="-1px",e.style.top="-1px",e.style.width="1px",e.style.height="1px",e.style.backgroundColor="transparent",e.style.color="transparent",document.body.appendChild(e)}this._singleFrameModeIpt.click()}},this.styleEls=[],this._frameColorMode=void 0,this._defaultFrameColorMode="RGBA",this.currentFSColorMode="rgba",this.ifReuseArrayBufferView=!1,this.maxVideoCvsLength=3,this.canvas=null,this.videoGlCvs=null,this.videoGl=null,this.glImgData=null,this.webglTexture=null,this.webglProgramInfo=null,this.webglBuffers=null,this.toCanvas=function(){const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,"grey"===this.colorMode){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.data);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e},this._onCameraSelChange=()=>n(this,void 0,void 0,(function*(){yield this.selectCamera(this._selCam.value),this._bOpen||this.stop()})),this._onResolutionSelChange=()=>n(this,void 0,void 0,(function*(){let e,t;if(this._selRsl&&-1!=this._selRsl.selectedIndex){let i=this._selRsl.options[this._selRsl.selectedIndex];e=i.getAttribute("data-width"),t=i.getAttribute("data-height")}yield this.setResolution(e,t),this._bOpen||this.stop()})),this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.videoSrc=null,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{"visible"===document.visibilityState?this._vc_bPlayingVideoBeforeHide&&("Firefox"==a.browserInfo.browser?this.play():this._video.play(),this._vc_bPlayingVideoBeforeHide=!1):this._video&&!this._video.paused&&(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause())},this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._bStoppedByPause=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateCanvasTimeout=500,this.referenceConfigurationArray=[],this._onWindowResize=()=>{this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout((()=>{this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}),this._updateCanvasTimeout)},this.bDestroyed=!1,this.mapCameraEvents=new Map([["cameraOpen",[]],["cameraClose",[]],["cameraChange",[]],["resolutionChange",[]],["played",[]],["singleFrameAcquired",[]],["frameAddedToBuffer",[]]])}static getVersion(){return this._version}static detectEnvironment(){return n(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!("undefined"==typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");if(null==e&&(e="./"),s)a._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,a._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(a._engineResourcePath+="/")}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}set maxCvsSideLength(e){if(e<=0)throw new Error("The 'maxCvsSideLength' should be greater than 0.");this._maxCvsSideLength=e}get maxCvsSideLength(){return void 0!==this._maxCvsSideLength?this._maxCvsSideLength:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("maxCvsSideLength")?this.referenceConfigurationArray[0].maxCvsSideLength:this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){a._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=a._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",a.engineResourcePath)}getUIElement(){return this.UIElement}setUIElement(e){return n(this,void 0,void 0,(function*(){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if("string"==typeof e||e instanceof String){if(!e.trim().startsWith("<")){let t=yield fetch(e);if(!t.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+t.statusText);e=yield t.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let t=document.createElement("div");t.innerHTML=e;for(let e=0;e<t.childElementCount;++e){let i=t.children[e];i instanceof HTMLStyleElement&&(this.styleEls.push(i),document.head.append(i))}(e=1==t.childElementCount?t.children[0]:t).remove()}this.UIElement=e}))}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e}set frameColorMode(e){this._frameColorMode=e}get frameColorMode(){return void 0!==this._frameColorMode?this._frameColorMode:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("frameColorMode")?this.referenceConfigurationArray[0].frameColorMode:this._defaultFrameColorMode}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");let e=[this.UIElement];for(let t=0;t<e.length;++t)for(let i of e[t].children)e.push(i);for(let t of e)if(!this._video&&t.classList.contains("dce-video-container")){const e=document.createElement("video");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.objectFit=this.getVideoFit(),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),t.prepend(e),this._video=e}else!this._divScanArea&&t.classList.contains("dce-scanarea")?this._divScanArea=t:!this._divScanLight&&t.classList.contains("dce-scanlight")?this._divScanLight=t:!this._bgLoading&&t.classList.contains("dce-bg-loading")?this._bgLoading=t:!this._bgCamera&&t.classList.contains("dce-bg-camera")?this._bgCamera=t:!this._selCam&&t.classList.contains("dce-sel-camera")?this._selCam=t:!this._selRsl&&t.classList.contains("dce-sel-resolution")?(this._selRsl=t,this.videoSrc||this.singleFrameMode||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">1920x1080</option>','<option data-width="1280" data-height="720">1280x720</option>','<option data-width="640" data-height="480">640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&t.classList.contains("dce-opt-gotResolution")?this._optGotRsl=t:!this._btnClose&&t.classList.contains("dce-btn-close")&&(this._btnClose=t);if(!this._video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'");this.singleFrameMode?(this._video&&(this._video.addEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="pointer",this._video.setAttribute("title","Take a photo")),this._divScanArea&&(this._divScanArea.addEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="pointer",this._divScanArea.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="")):this._bgLoading&&(this._bgLoading.style.display=""),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.addEventListener("resize",this._onWindowResize)}_unbindUI(){this.singleFrameMode?(this._video&&(this._video.removeEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="",this._video.removeAttribute("title")),this._divScanArea&&(this._divScanArea.removeEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="",this._divScanArea.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this._cvsViewDecorator&&(this._cvsViewDecorator.removeEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="",this._cvsViewDecorator.removeAttribute("title"));for(let e of this._arrScanRegionOverlays)e&&(e.removeEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="",e.removeAttribute("title"));this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._video&&(this._video.onloadedmetadata=null,this._video.remove()),this._video=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameModeIpt&&(this._singleFrameModeIpt.remove(),this._singleFrameModeIpt=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.removeEventListener("resize",this._onWindowResize)}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);this._bShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this._bShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this._cvsViewDecorator&&(this._cvsViewDecorator.addEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="pointer",this._cvsViewDecorator.setAttribute("title","Take a photo")),this.showScanRegionOverlays();for(let e of this._arrScanRegionOverlays)e&&(e.addEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="pointer",e.setAttribute("title","Take a photo"))}}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}set ifSaveLastUsedCamera(e){e?a.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`It is not allowed to set '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this.singleFrameMode)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}}getVideoFit(){return this.videoFit}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&"none"==this._cvsScanRegion.style.display&&(this._cvsScanRegion.style.display="")}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none")}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){return this._bShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="")}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none")}_checkValidRegion(e){return!(null!==e&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("The region is invalid.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(e.className="cvs-scan-region-overlay-"+this._arrScanRegionOverlays.length,this.singleFrameMode&&(e.addEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="pointer",e.setAttribute("title","Take a photo")),this._updateScanRegionOverlay(e),this._arrScanRegionOverlays.length>0){const t=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[t-1].after(e)}else if(this._cvsScanRegion)this._cvsScanRegion.before(e);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._video)throw new Error("'video' is null.");this._video.after(e)}return this._arrScanRegionOverlays.push(e),e}_updateScanRegionOverlay(e){if(!e)return;let t,i,r;if(this.singleFrameMode)t=this._imgWidth,i=this._imgHeight,r="contain";else{if(!this._video)return;t=this._video.videoWidth,i=this._video.videoHeight,r=this.getVideoFit()}if(t<=0||i<=0)return e.width=0,void(e.height=0);const o=this._getRegionInPixels(t,i,this._scanRegion),n=o.regionRight-o.regionLeft,s=o.regionBottom-o.regionTop;e.width==n&&e.height==s||(e.width=n,e.height=s);const a=window.getComputedStyle(this._video),d=parseFloat(a.width),l=parseFloat(a.height),h=d/l,c=t/i;let _,g,u,f,m=1;if("contain"===r)h<c?(m=d/t,_=0,g=(l-i*m)/2):(m=l/i,_=(d-t*m)/2,g=0),_+=o.regionLeft*m,g+=o.regionTop*m,u=(o.regionRight-o.regionLeft)*m,f=(o.regionBottom-o.regionTop)*m;else if("cover"===r)if(h<c){m=l/i,_=o.regionLeft*m-(t*m-d)/2,_=Math.max(_,0),_=Math.min(_,parseFloat(a.width)),g=o.regionTop*m;let e=o.regionRight*m-(t*m-d)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(a.width)),u=e-_,f=(o.regionBottom-o.regionTop)*m}else{m=d/t,_=o.regionLeft*m,g=o.regionTop*m-(i*m-l)/2,g=Math.max(g,0),g=Math.min(g,parseFloat(a.height));let e=o.regionBottom*m-(i*m-l)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(a.height)),u=(o.regionRight-o.regionLeft)*m,f=e-g}else _=0,g=0,u=0,f=0;e.style.position="absolute",e.style.left=_+"px",e.style.top=g+"px",e.style.width=u+"px",e.style.height=f+"px"}showScanRegionOverlays(){for(let e of this._arrScanRegionOverlays)e&&"none"==e.style.display&&(e.style.display="")}hideScanRegionOverlays(){for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none")}setViewDecorator(e,t){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));this._assertOpen();let i=[];if("string"==typeof e?i.push(e):Array.isArray(e)&&(i=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator)if(this._cvsViewDecorator=document.createElement("canvas"),this._cvsViewDecorator.className="cvs-view-decorator",this.singleFrameMode&&(this._cvsViewDecorator.addEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="pointer",this._cvsViewDecorator.setAttribute("title","Take a photo")),this._divScanArea)this._divScanArea.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._arrScanRegionOverlays&&0!=this._arrScanRegionOverlays.length){const e=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[e-1].after(this._cvsViewDecorator)}else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._video)throw new Error("'video' is null.");this._video.after(this._cvsViewDecorator)}this._decoratorArea=JSON.parse(JSON.stringify(t)),this._decoratorType.length=0;const r=["rectangle","focus"],o=["crossline","crosshair"];let n=!1,s=!1;for(let e of i)e=e.toLowerCase(),r.includes(e)&&!n&&(n=!0,this._decoratorType.push(e)),o.includes(e)&&!s&&(s=!0,!this._decoratorType.includes(e)&&this._decoratorType.push(e));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&"none"==this._cvsViewDecorator.style.display&&(this._cvsViewDecorator.style.display="")}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none")}setViewDecoratorLineWidth(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=t,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=t,this._updateViewDecorator()}setViewDecoratorFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=t,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=t,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen)return;if(!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this.singleFrameMode)e="contain";else{if(!this._video)return;e=this.getVideoFit()}const t=this._cvsViewDecorator;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit=e;const i=this.getVisibleRegion(!0),r=i.regionRight-i.regionLeft,o=i.regionBottom-i.regionTop;t.width==r&&t.height==o||(t.width=r,t.height=o);const n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);const s=this._decoratorArea.x/100*r,a=this._decoratorArea.y/100*o,d=this._decoratorArea.width/100*r,l=this._decoratorArea.height/100*o;for(let e of this._decoratorType){if("rectangle"===e){n.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,n.fillRect(0,0,t.width,t.height),n.clearRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,n.fillRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,n.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const e=n.lineWidth/2;n.strokeRect(Math.round(s-e),Math.round(a-e),Math.round(d+n.lineWidth),Math.round(l+n.lineWidth))}if("focus"===e){n.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,n.fillRect(0,0,t.width,t.height),n.clearRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.fillStyle=this._viewDecoratorInfo.focus.fillStyle,n.fillRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.lineWidth=this._viewDecoratorInfo.focus.lineWidth,n.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const e=n.lineWidth/2,i=[0,.25,.75,1],r=[0,.25,.75,1];n.beginPath();for(let e=0;e<i.length;e++)if(0==e||3==e)for(let t=0;t<r.length;t+=2)n.moveTo(Math.round(s+i[e]*d),Math.round(a+r[t]*l)),n.lineTo(Math.round(s+i[e]*d),Math.round(a+r[t+1]*l));for(let t=0;t<r.length;t++)if(0==t||3==t)for(let o=0;o<i.length;o+=2)n.moveTo(Math.round(s+i[o]*d-e),Math.round(a+r[t]*l)),n.lineTo(Math.round(s+i[o+1]*d+e),Math.round(a+r[t]*l));n.stroke()}if("crossline"===e&&(n.beginPath(),n.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,n.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,n.moveTo(Math.round(s),Math.round(a+l/2)),n.lineTo(Math.round(s+d),Math.round(a+l/2)),n.moveTo(Math.round(s+d/2),Math.round(a)),n.lineTo(Math.round(s+d/2),Math.round(a+l)),n.stroke()),"crosshair"===e){n.beginPath();const e=.05*Math.min(d,l);n.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,n.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,n.moveTo(Math.round(s+(d-e)/2),Math.round(a+l/2)),n.lineTo(Math.round(s+(d+e)/2),Math.round(a+l/2)),n.moveTo(Math.round(s+d/2),Math.round(a+(l-e)/2)),n.lineTo(Math.round(s+d/2),Math.round(a+(l+e)/2)),n.stroke()}}}getVisibleRegion(e){let t,i,r;if(this._assertOpen(),this.singleFrameMode)t=this._imgWidth,i=this._imgHeight,r="contain";else{if(!this._video)return null;t=this._video.videoWidth,i=this._video.videoHeight,r=this.getVideoFit()}let o=(()=>{const e=parseFloat(window.getComputedStyle(this._video).width),o=parseFloat(window.getComputedStyle(this._video).height);let n,s={regionBottom:i,regionRight:t,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return"cover"===r?e/o<t/i?(n=i/o,s.regionLeft=Math.floor((t-n*e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=0,s.regionBottom=i):(n=t/e,s.regionTop=Math.floor((i-n*o)/2),s.regionBottom=Math.ceil(i-s.regionTop),s.regionLeft=0,s.regionRight=t):"none"===r&&(e<t&&o<i?(s.regionLeft=Math.floor((t-e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=Math.floor((i-o)/2),s.regionBottom=Math.ceil(i-s.regionTop)):e<t?(s.regionLeft=Math.floor((t-e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=0,s.regionBottom=i):o<i&&(s.regionTop=Math.floor((i-o)/2),s.regionBottom=Math.ceil(i-s.regionTop),s.regionLeft=0,s.regionRight=t)),s})();return e?o.regionMeasuredByPercentage=!1:(o.regionBottom=Math.ceil(o.regionBottom/i*100),o.regionRight=Math.ceil(o.regionRight/t*100),o.regionLeft=Math.floor(o.regionLeft/t*100),o.regionTop=Math.floor(o.regionTop/i*100),o.regionMeasuredByPercentage=!0),o}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,t,i){if(!(e<=0||t<=0))return i?i.regionMeasuredByPercentage?{regionLeft:Math.round(i.regionLeft/100*e),regionTop:Math.round(i.regionTop/100*t),regionRight:Math.round(i.regionRight/100*e),regionBottom:Math.round(i.regionBottom/100*t),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(i)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:t,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e,t,i;if(this.singleFrameMode)e=this._imgWidth,t=this._imgHeight,i="contain";else{if(!this._video)return;e=this._video.videoWidth,t=this._video.videoHeight,i=this.getVideoFit()}if(e<=0||t<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const r=this._getRegionInPixels(e,t,this._scanRegion);if(!this._cvsScanRegion)if(this._cvsScanRegion=document.createElement("canvas"),this._cvsScanRegion.className="cvs-scan-region",this.singleFrameMode&&(this._cvsScanRegion.addEventListener("click",this._clickIptSingleFrameMode),this._cvsScanRegion.style.cursor="pointer",this._cvsScanRegion.setAttribute("title","Take a photo")),this._arrScanRegionOverlays&&0!=this._arrScanRegionOverlays.length){const e=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[e-1].after(this._cvsScanRegion)}else this._cvsSingleFrameMode?this._cvsSingleFrameMode.after(this._cvsScanRegion):this._video.after(this._cvsScanRegion);const o=this._cvsScanRegion;o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.left="0",o.style.top="0",o.style.objectFit=i,o.width==e&&o.height==t||(o.width=e,o.height=t);const n=o.getContext("2d");if(n.clearRect(0,0,o.width,o.height),0!=r.regionLeft||r.regionRight!=e||0!=r.regionTop||r.regionBottom!=t){const e=r.regionLeft,t=r.regionTop,i=r.regionRight-r.regionLeft,s=r.regionBottom-r.regionTop;n.fillStyle=this.regionMaskFillStyle,n.fillRect(0,0,o.width,o.height),n.clearRect(Math.round(e),Math.round(t),Math.round(i),Math.round(s)),n.strokeStyle=this.regionMaskStrokeStyle,n.lineWidth=this.regionMaskLineWidth;const a=n.lineWidth/2;n.strokeRect(Math.round(e-a),Math.round(t-a),Math.round(i+n.lineWidth),Math.round(s+n.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e,t,i;if(this.singleFrameMode)e=this._imgWidth,t=this._imgHeight,i="contain";else{if(!this._video)return;e=this._video.videoWidth,t=this._video.videoHeight,i=this.getVideoFit()}if(!this._divScanArea)return;if(e<=0||t<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const r=this._getRegionInPixels(e,t,this._scanRegion),o=window.getComputedStyle(this._video),n=parseFloat(o.width),s=parseFloat(o.height),a=n/s,d=e/t;let l,h,c,_,g=1;if("contain"===i)a<d?(g=n/e,l=0,h=(s-t*g)/2):(g=s/t,l=(n-e*g)/2,h=0),l+=r.regionLeft*g,h+=r.regionTop*g,c=(r.regionRight-r.regionLeft)*g,_=(r.regionBottom-r.regionTop)*g;else if("cover"===i)if(a<d){g=s/t,l=r.regionLeft*g-(e*g-n)/2,l=Math.max(l,0),l=Math.min(l,parseFloat(o.width)),h=r.regionTop*g;let i=r.regionRight*g-(e*g-n)/2;i=Math.max(i,0),i=Math.min(i,parseFloat(o.width)),c=i-l,_=(r.regionBottom-r.regionTop)*g}else{g=n/e,l=r.regionLeft*g,h=r.regionTop*g-(t*g-s)/2,h=Math.max(h,0),h=Math.min(h,parseFloat(o.height));let i=r.regionBottom*g-(t*g-s)/2;i=Math.max(i,0),i=Math.min(i,parseFloat(o.height)),c=(r.regionRight-r.regionLeft)*g,_=i-h}else l=0,h=0,c=0,_=0;this._divScanArea.style.left=l+"px",this._divScanArea.style.top=h+"px",this._divScanArea.style.width=c+"px",this._divScanArea.style.height=_+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){return void 0!==this._croppingRegions?this._croppingRegions:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("croppingRegions")?this.referenceConfigurationArray[0].croppingRegions:this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'loopInterval' should be greater than or equal to 0.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){return void 0!==this._loopInterval?this._loopInterval:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("loopInterval")?this.referenceConfigurationArray[0].loopInterval:this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("The 'maxNumberOfFramesInBuffer' should be greater than 0.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){return void 0!==this._maxNumberOfFramesInBuffer?this._maxNumberOfFramesInBuffer:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("maxNumberOfFramesInBuffer")?this.referenceConfigurationArray[0].maxNumberOfFramesInBuffer:this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){return void 0!==this._refreshInterval?this._refreshInterval:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("refreshInterval")?this.referenceConfigurationArray[0].refreshInterval:this._defaultRefreshInterval}isContextDestroyed(){return this.bDestroyed}static createInstance(e){return n(this,void 0,void 0,(function*(){let t=new a;("string"==typeof e||e instanceof String)&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return yield t.setUIElement(a.defaultUIElementURL),this._hasEngineResourceLoaded=!0,t}))}play(e,t,i){return n(this,void 0,void 0,(function*(){if(this._video&&this.videoSrc){yield new Promise(((e,t)=>{this._video.onloadedmetadata=()=>n(this,void 0,void 0,(function*(){this._video&&(this._video.onloadedmetadata=null,yield this._video.play(),e())})),"string"==typeof this.videoSrc||this.videoSrc instanceof String?this._video.src=this.videoSrc:this._video.srcObject=this.videoSrc,setTimeout((()=>t(new Error("Failed to play video. Timeout."))),4e3)}));let e={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};const t=this.mapCameraEvents.get("played");for(let i of t){const t=JSON.parse(JSON.stringify(e));setTimeout((()=>i(t)),0)}return e}if(this.singleFrameMode)return this._clickIptSingleFrameMode(),{width:0,height:0,deviceId:null};if(!this._video)return null;const r=++this.iPlayRound;let o=null,s=0,d=0;return this._currentCamera&&(o=this._currentCamera.deviceId),this._video&&(s=this._video.videoWidth,d=this._video.videoHeight),this.promisePlay&&(yield this.promisePlay,r<this.iPlayRound)?{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId}:(this.promisePlay=(()=>n(this,void 0,void 0,(function*(){var r;try{this._video&&this._video.srcObject&&this.stop(),a._onLog&&a._onLog("DCE: ======before video========");const l=()=>{if(!this._video)throw u&&u.getTracks().forEach((e=>{e.stop()})),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null.")},h=this.getVideoSettings();let c;"boolean"==typeof h.video&&(h.video={});const _=["rear","back","rück","arrière","trasera","trás","traseira","posteriore","后面","後面","背面","后置","後置","背置","задней","الخلفية","후","arka","achterzijde","หลัง","baksidan","bagside","sau","bak","tylny","takakamera","belakang","אחורית","πίσω","spate","hátsó","zadní","darrere","zadná","задня","stražnja","belakang","बैक"],g=()=>{for(let e of this._allCameras){let t=e.label.toLowerCase();if(t&&_.some((e=>-1!=t.indexOf(e)))&&/\b0(\b)?/.test(t)){delete h.video.facingMode,h.video.deviceId={ideal:e.deviceId};break}}h.video.deviceId||-1==["Android","HarmonyOS"].indexOf(a.browserInfo.OS)||(delete h.video.facingMode,h.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})};if(e)delete h.video.facingMode,h.video.deviceId={exact:e};else if(h.video.deviceId);else if(this._lastDeviceId)delete h.video.facingMode,h.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&a.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete h.video.facingMode,h.video.deviceId={exact:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),t=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&t&&(h.video.width=e,h.video.height=t)}else if(this.ifSkipCameraInspection);else if(h.video.facingMode){if(yield this.getAllCameras(),!this._video)return null;let e=h.video.facingMode;e instanceof Array&&e.length&&(e=e[0]),e=e.exact||e.ideal||e,"environment"===e&&(c=!!h.video.facingMode,g())}let u;t&&(h.video.width={ideal:t}),i&&(h.video.height={ideal:i}),a._onLog&&a._onLog("DCE: ======try getUserMedia========");let f,m=[0,500],R=null,v=null;function S(e){return n(this,void 0,void 0,(function*(){for(let t of m){l(),t&&(yield new Promise((e=>setTimeout(e,t)))),l();{const t=e.video.deviceId;v=t?t.exact||t.ideal||t:null}try{a._onLog&&a._onLog("DCE: ask "+JSON.stringify(e)),u=yield navigator.mediaDevices.getUserMedia(e),l();break}catch(e){R=e,a._onLog&&a._onLog("DCE: "+e.message||0)}}}))}if(yield S(h),u||(a._onLog&&a._onLog("DCE: ======try getUserMedia again========"),f=JSON.parse(JSON.stringify(h)),"object"==typeof f.video&&("iPhone"==a.browserInfo.OS?(t>=1280||i>=1280?f.video.width=1280:t>=640||i>=640?f.video.width=640:(t<640||i<640)&&(f.video.width=320),delete f.video.height):c&&!h.video.deviceId?(delete f.video.facingMode,this._allCameras.length&&(f.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):f.video=!0),a._onLog&&a._onLog("DCE: "+f),yield S(f)),u||(m=[1e3,2e3],yield S(h)),u||(yield S(f)),!u)throw R;const E=()=>{const e=u.getVideoTracks();let t,i;if(e.length&&(t=this._videoTrack=e[0]),this._video&&t){const e=t.getSettings();if(e)for(let r of this._allCameras)if(e.deviceId===r.deviceId){r._checked=!0,r.label=t.label,i=r;break}if(!i&&v)for(let e of this._allCameras)if(v==e.deviceId){t.label&&(e._checked=!0,e.label=t.label),i=e;break}}this._currentCamera=i};if(yield this.getAllCameras(),l(),c){E(),g();let e=h.video.deviceId;e&&(e=e.exact||e.ideal||e);let t=null===(r=this._currentCamera)||void 0===r?void 0:r.deviceId;!e||t&&e==t||(u.getTracks().forEach((e=>{e.stop()})),m=[0,500,1e3,2e3],yield S(h))}l();const p=()=>n(this,void 0,void 0,(function*(){a._onLog&&a._onLog("======play video========"),yield new Promise(((e,t)=>{l(),this._video.onloadedmetadata=()=>n(this,void 0,void 0,(function*(){l(),this._video.onloadedmetadata=null,yield this._video.play(),e()})),this._video.srcObject=u,setTimeout((()=>t(new Error("Failed to play video. Timeout."))),4e3)}))}));yield p(),l(),a._onLog&&a._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const I=this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=I,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),a._onLog&&a._onLog("DCE: got "+I),E(),l(),this._renderSelCameraInfo();const y={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};y.deviceId&&(this._lastDeviceId=y.deviceId,this.ifSaveLastUsedCamera&&a.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),h.video.width&&h.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(h.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(h.video.height)))));const A=this.mapCameraEvents.get("played");for(let e of A){const t=JSON.parse(JSON.stringify(y));setTimeout((()=>e(t)),0)}if(o&&o!=y.deviceId){const e=this.mapCameraEvents.get("cameraChange");for(let t of e){const e=JSON.parse(JSON.stringify(y));setTimeout((()=>t(e)),0)}}if(s&&d&&(s!=y.width||d!=y.height)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);const e=this.mapCameraEvents.get("resolutionChange");for(let t of e){const e=JSON.parse(JSON.stringify(y));setTimeout((()=>t(e)),0)}}return this.promisePlay=null,y}catch(e){throw this.promisePlay=null,e}})))(),yield this.promisePlay)}))}resume(){return n(this,void 0,void 0,(function*(){this._assertOpen(),yield this.play(),this._bStoppedByPause&&(this._bStoppedByPause=!1,this.startFetchingLoop()),this._bShowScanRegionLaser&&this.showScanRegionLaser()}))}pause(){this._bOpen||console.warn("The camera is not open."),this._video&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._bStoppedByPause=!0),this._bShowScanRegionLaser&&this.hideScanRegionLaser()}close(e){if(!this._video)return;this.stop(),this._unbindUI(),e&&(this.UIElement.style.display="none"),this.stopFetchingLoop(),this.bOpen=!1;const t=this.mapCameraEvents.get("cameraClose");for(let e of t){const t={width:0,height:0,deviceId:null};setTimeout((()=>e(t)),0)}}open(e){return n(this,void 0,void 0,(function*(){this._bindUI(),e&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display=""));let t=yield this.play();this.bOpen=!0;const i=this.mapCameraEvents.get("cameraOpen");for(let e of i){const i=JSON.parse(JSON.stringify(t));setTimeout((()=>e(i)),0)}return t}))}stop(){this._video&&this._video.srcObject&&(a._onLog&&a._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach((e=>{e.stop()})),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(a._onLog&&a._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0}getAllCameras(){return n(this,void 0,void 0,(function*(){let e=yield navigator.mediaDevices.enumerateDevices();if(!e[0].deviceId){let t=yield navigator.mediaDevices.getUserMedia({video:!0});e=yield navigator.mediaDevices.enumerateDevices(),t.getTracks().forEach((e=>{e.stop()})),t=null}const t=[],i=[];if(this._allCameras)for(let e of this._allCameras)e._checked&&i.push(e);for(let r=0;r<e.length;r++){let o,n=e[r];if("videoinput"==n.kind){for(let e of i)n.deviceId==e.deviceId&&(o=e);o||(o={},o.deviceId=n.deviceId,o.label=n.label?n.label:"camera "+r),t.push(o)}}return this._allCameras=t,a._onLog&&a._onLog("DCE: "+JSON.stringify(this._allCameras)),Promise.resolve(t)}))}_renderSelCameraInfo(){if(this._selCam&&(this._selCam.innerHTML=""),this._selCam){let e;for(let t of this._allCameras){let i=document.createElement("option");i.value=t.deviceId,i.innerText=t.label,this._selCam.append(i),t.deviceId&&this._currentCamera&&this._currentCamera.deviceId==t.deviceId&&(e=i)}this._selCam.value=e?e.value:""}}getSelectedCamera(){if(!this._bOpen){let e="";const t=this.videoSettings.video.deviceId;t&&(e=t.exact||t.ideal||t);for(let t of this._allCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}selectCamera(e){return n(this,void 0,void 0,(function*(){let t="";return e&&(t=e.deviceId||e),this.videoSettings.video.deviceId={exact:t},this._bOpen?yield this.play(e.deviceId||e):null}))}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,t=0;const i=this.videoSettings.video.width,r=this.videoSettings.video.height;return i&&(e=i.exact||i.ideal||i),r&&(t=r.exact||r.ideal||r),[e,t]}}setResolution(e,t){return n(this,void 0,void 0,(function*(){let i,r;return e instanceof Array?(i=e[0],r=e[1]):(i=e,r=t),this.videoSettings.video.width={ideal:i},this.videoSettings.video.height={ideal:r},this._bOpen?yield this.play(null,i,r):null}))}getResolutions(e){return n(this,void 0,void 0,(function*(){let t="";const i=(e,t)=>{const i=this.mapCameraResolutions.get(e);if(!i||!i.length)return!1;for(let e of i)if(e[0]===t.width&&e[1]===t.height)return!0;return!1},r=(e,t,i)=>n(this,void 0,void 0,(function*(){const r={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let o=null;try{o=yield navigator.mediaDevices.getUserMedia(r)}catch(r){return null}if(!o)return null;const n=o.getVideoTracks();let s=null;try{const e=n[0].getSettings();s={width:e.width,height:e.height}}catch(r){const e=document.createElement("video");e.srcObject=o,s={width:e.videoWidth,height:e.videoHeight},e.srcObject=null}return n.forEach((e=>{e.stop()})),s}));if(!this._bOpen){const o=this.videoSettings.video.deviceId;if(!o)return null;if(t=o.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:o.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!t)return null;let n=this.mapCameraResolutions.get(t);if(n&&!e)return this.mapCameraResolutions.get(t);this.mapCameraResolutions.set(t,[]),n=this.mapCameraResolutions.get(t);for(let e of this.predefinedResolutions){const o=yield r(t,e.width,e.height);o&&!i(t,o)&&n.push([o.width,o.height])}return n}if(this._currentCamera){t=this._currentCamera.deviceId;let r=this.mapCameraResolutions.get(t);if(r&&!e)return this.mapCameraResolutions.get(t);this.mapCameraResolutions.set(t,[]),r=this.mapCameraResolutions.get(t);const o=this.getConstraints();for(let e of this.predefinedResolutions){yield this._videoTrack.applyConstraints({width:{ideal:e.width},height:{ideal:e.height}});const o=this._videoTrack.getSettings(),n={width:o.width,height:o.height};i(t,n)||r.push([n.width,n.height])}return yield this._videoTrack.applyConstraints(o),r}return null}))}on(e,t){if(!this.mapCameraEvents.has(e))throw new Error(`Event '${e}' is not exists.`);const i=this.mapCameraEvents.get(e);i.includes(t)||i.push(t)}off(e,t){if(!this.mapCameraEvents.has(e))throw new Error(`Event '${e}' is not exists.`);const i=this.mapCameraEvents.get(e),r=i.indexOf(t);-1!==r&&i.splice(r,1)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen?this.play():Promise.resolve()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getSettings()}getConstraints(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getConstraints()}applyConstraints(e){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return yield this._videoTrack.applyConstraints(e)}))}turnOnTorch(){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return yield this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}))}turnOffTorch(){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return yield this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}))}setColorTemperature(e){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let t=this.getCapabilities().colorTemperature;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{colorTemperature:e}]})}))}setExposureCompensation(e){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let t=this.getCapabilities().exposureCompensation;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}))}setZoom(e){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");let t=this.getCapabilities().zoom;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{zoom:e}]})}))}setFrameRate(e){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let t=this.getCapabilities().frameRate;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}))}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(e,t){return n(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");const i=this.getCapabilities().focusMode,r=this.getCapabilities().focusDistance;if(!i||!i.includes(e)||!r)throw Error("Not supported.");return t?(t<r.min?t=r.min:t>r.max&&(t=r.max),yield this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:t}]})):yield this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}))}getFocus(){const e=this.getCameraSettings().focusMode;return"continuous"===e?{mode:e}:{mode:e,distance:this.getCameraSettings().focusDistance}}getFrameSize(e,t,i,r){if(!e||!t)return null;let o,n,s,a,d=e,l=t;const h={regionLeft:0,regionTop:0,regionRight:d,regionBottom:l,regionMeasuredByPercentage:!1};i?(i.regionMeasuredByPercentage?(h.regionLeft=i.regionLeft*d/100,h.regionTop=i.regionTop*l/100,h.regionRight=i.regionRight*d/100,h.regionBottom=i.regionBottom*l/100):(h.regionLeft=i.regionLeft,h.regionTop=i.regionTop,h.regionRight=i.regionRight,h.regionBottom=i.regionBottom),o=h.regionLeft,n=h.regionTop,d=Math.round(h.regionRight-h.regionLeft),l=Math.round(h.regionBottom-h.regionTop)):(o=0,n=0);const c=Math.max(d,l);if(r&&r>0&&c>r){const e=r/c;d>l?(s=r,a=Math.round(l*e)):(s=Math.round(d*e),a=r)}else s=d,a=l;return s<=0||a<=0?null:{sx:o,sy:n,sWidth:d,sHeight:l,dWidth:s,dHeight:a}}getFrame(){if(this.singleFrameMode)throw Error("'getFrame()' is unavailable in singleFrameMode.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoFrame(this._scanRegion)}_getVideoFrame(e,t){if(this.bDestroyed)throw Error("The 'CameraEnhancer' instance has been destroyed.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getVideoFrame()' is unavailable in singleFrameMode.");const i=Date.now();a._onLog&&a._onLog("DCE: _getVideoFrame(region?) START: "+i);const r=this._video.videoWidth,o=this._video.videoHeight;if(0===r||0===o)return null;const n=this.getFrameSize(r,o,e,this.maxCvsSideLength);if(!n)return null;let s,d;s=r!==n.sWidth||o!==n.sHeight,d=n.sWidth!==n.dWidth||n.sHeight!==n.dHeight;const l=(()=>!(!this._bWebGLSupported||d))(),h={data:null,region:e?JSON.parse(JSON.stringify(e)):null,sx:n.sx,sy:n.sy,width:n.dWidth,height:n.dHeight,colorMode:null,timeSpent:null,timeStamp:null,isCropped:s,toCanvas:this.toCanvas,_bUseWebGL:null},c=this._getImageData(this._video,r,o,n,t,{targetColorMode:this.frameColorMode,bUseWebGL:l});if(!c)return null;const _=Date.now();return a._onLog&&a._onLog("DCE: _getVideoFrame(region?) END: "+_),h.data=c.data,h.colorMode=c.colorMode,h._bUseWebGL=c._bUseWebGL,h.timeSpent=_-i,h.timeStamp=_,h}_getImageData(e,t,i,r,o,n){if(this.bDestroyed)throw Error("The 'CameraEnhancer' instance has been destroyed.");if(!t||!i)return null;a._onLog&&a._onLog("DCE: _getImageData() START: "+Date.now());const{sx:s,sy:d,sWidth:l,sHeight:h,dWidth:c,dHeight:_}=r;let g;if(g=n&&n.targetColorMode?n.targetColorMode.toLowerCase():"rgba",n&&n.bUseWebGL){this.videoGlCvs||(this.videoGlCvs=document.createElement("canvas"));const l=this.videoGlCvs;l.width==t&&l.height==i||(l.width=t,l.height=i,this.videoGl&&this.videoGl.viewport(0,0,t,i));const h=this.videoGl||l.getContext("webgl",{antialias:!1})||l.getContext("experimental-webgl",{antialias:!1});if(!h){this.videoGl=null,this._bWebGLSupported=!1;let s=null;return n?(s=JSON.parse(JSON.stringify(n)),s.bUseWebGL=!1):s={bUseWebGL:!1},this._getImageData(e,t,i,r,o,s)}if(h.enable(h.SCISSOR_TEST),h.scissor(s,d,c,_),!this.videoGl||g!==this.currentFSColorMode){this.videoGl=h;const e=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),{position:t,indices:i}},t=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},i=(e,t,i)=>{const o=r(e,e.VERTEX_SHADER,t),n=r(e,e.FRAGMENT_SHADER,i),s=e.createProgram();return e.attachShader(s,o),e.attachShader(s,n),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(alert("Unable to initialize the shader program: "+e.getProgramInfoLog(s)),null)},r=(e,t,i)=>{const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(r)),e.deleteShader(r),null)},o="\n                  attribute mediump vec2 aVertexPosition;\n                  varying mediump vec2 vDirection;\n          \n                  void main( void )\n                  {\n                      gl_Position = vec4(aVertexPosition, 1.0, 1.0) * 2.0;\n                      vDirection = aVertexPosition;\n                  }\n                ";let n;n=["rgba","rbga","grba","gbra","brga","bgra"].includes(g)?g.slice(0,3):"rgb";const s=i(h,o,`\n                    precision mediump float;\n\n                    varying mediump vec2 vDirection;\n                    uniform sampler2D uSampler;\n                    uniform lowp float uColorFactor;\n            \n                    void main(void)\n                    {\n                        vec4 sample = texture2D(uSampler, vec2(vDirection.x * 0.5 + 0.5, vDirection.y * 0.5 + 0.5));\n                        lowp float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                        gl_FragColor = vec4(sample.${n} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                    }\n                `);this.webglProgramInfo={program:s,attribLocations:{vertexPosition:h.getAttribLocation(s,"aVertexPosition")},uniformLocations:{uSampler:h.getUniformLocation(s,"uSampler"),uColorFactor:h.getUniformLocation(s,"uColorFactor")}},this.webglBuffers=e(h),this.webglTexture=t(h),this.currentFSColorMode=g}const u=(e,t,i)=>{const r=e.RGBA,o=e.RGBA,n=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,r,o,n,i)},f=(e,t,i,r)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indices),e.useProgram(t.program);{const r=2,o=e.FLOAT,n=!1,s=0,a=0;e.bindBuffer(e.ARRAY_BUFFER,i.position),e.vertexAttribPointer(t.attribLocations.vertexPosition,r,o,n,s,a),e.enableVertexAttribArray(t.attribLocations.vertexPosition)}e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,"grey"===g||"grey32"===g?1:0);const o=e.UNSIGNED_SHORT;e.drawElements(e.TRIANGLES,6,o,0)};let m;if(u(h,this.webglTexture,e),f(h,this.webglProgramInfo,this.webglBuffers,this.webglTexture),o){if(o.length<c*_*4)return null;m=o}else this.ifReuseArrayBufferView||"grey"===g?(this.glImgData&&this.glImgData.length===c*_*4||(this.glImgData=new Uint8Array(c*_*4)),m=this.glImgData):m=new Uint8Array(c*_*4);if(h.readPixels(s,d,c,_,h.RGBA,h.UNSIGNED_BYTE,m),h.disable(h.SCISSOR_TEST),255!==m[3]){a._onLog&&a._onLog("DCE: WebGL draw frame incorrectly."),this.forceLoseContext(),this._bWebGLSupported=!1;let s=null;return n?(s=JSON.parse(JSON.stringify(n)),s.bUseWebGL=!1):s={bUseWebGL:!1},this._getImageData(e,t,i,r,o,s)}if("grey"===g){let e=a._onLog?Date.now():0;if(m=new Uint8Array(new Uint32Array(m.buffer)),o){if(o.length<m.length)return null;o.set(m)}a._onLog&&a._onLog("DCE: Extract grey cost: "+(Date.now()-e))}return a._onLog&&a._onLog("DCE: _getImageData END: "+Date.now()),{data:m,colorMode:g,_bUseWebGL:!0}}{this.canvas||(this.canvas=document.createElement("canvas"));const t=this.canvas;t.width===c&&t.height===_||(t.width=c,t.height=_),t.ctx2d||(t.ctx2d=t.getContext("2d"));const i=t.ctx2d;i.drawImage(e,s,d,l,h,0,0,c,_);let r=i.getImageData(0,0,t.width,t.height).data;if(["rbga","grba","gbra","brga","bgra"].includes(g)){const e=g.indexOf("r"),t=g.indexOf("g"),i=g.indexOf("b");let o=0;1===e||2===e?o=e:2===t&&(o=t);for(let n=0;n<r.length;n+=4){let s;o&&(s=r[n+o]),r[n+e]=r[n],r[n+t]=1===o?s:r[n+1],r[n+i]=2===o?s:r[n+2]}}else if("grey"===g||"grey32"===g)for(let e=0;e<r.length;e+=4){const t=.21*r[e]+.71*r[e+1]+.07*r[e+2];r[e]=t,r[e+1]=t,r[e+2]=t}if(r="grey"===g?new Uint8Array(new Uint32Array(r.buffer)):new Uint8Array(r.buffer),o){if(o.length<r.length)return null;o.set(r)}return a._onLog&&a._onLog("DCE: _getVideoFrame(region?) END: "+Date.now()),{data:r,colorMode:g,_bUseWebGL:!1}}}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.bDestroyed)return void this.stopFetchingLoop();if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();if(this._video.paused)return a._onLog&&a._onLog("DCE: Video is paused. Ask in 1s."),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),void(this._frameLoopTimeoutId=setTimeout((()=>{this._fetchingLoop(!0)}),1e3));const t=()=>{a._onLog&&a._onLog("DCE: start fetching a frame: "+Date.now());const e=this.getCurrentRegion();let t=this._getVideoFrame(e);if(!t)return void(a._onLog&&a._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(t),a._onLog&&a._onLog("DCE: finish fetching a frame: "+Date.now());const i=this.mapCameraEvents.get("frameAddedToBuffer");for(let e of i)setTimeout(e,0)},i=()=>{this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout((()=>{this.bDestroyed?this.stopFetchingLoop():this._bOpen&&this.isFetchingLoopStarted()?this._video.paused?this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId):(a._onLog&&a._onLog("DCE: second timeout executes: "+Date.now()),t(),i()):this.stopFetchingLoop()}),this.refreshInterval))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(t(),this.refreshInterval>0&&i()):this.refreshInterval>0?(t(),i()):0===this.refreshInterval?t():this.refreshInterval),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout((()=>{this._fetchingLoop(!0)}),this.loopInterval)}startFetchingLoop(){if(this.bDestroyed)throw Error("The DCE instance has been destroyed.");if(this._assertOpen(),this.singleFrameMode)throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");if(this._video.paused)throw Error("The video is paused.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,a._onLog&&a._onLog("start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(a._onLog&&a._onLog("stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.shift()):null}forceLoseContext(){if(!this.videoGl)return;const e=this.videoGl;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this.webglTexture=null,this.webglProgramInfo=null,this.webglBuffers=null,this.videoGl=null,this.videoGlCvs=null}dispose(e){this.close(!0),this.forceLoseContext(),this.setViewDecorator(null,null);for(let e of this._arrScanRegionOverlays)e&&e.remove();e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null}}function d(e,t,i,r){return new(i||(i=Promise))((function(o,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function a(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((r=r.apply(e,t||[])).next())}))}var l,h,c,_;a._jsVersion="2.3.1",a._jsEditVersion="20220321",a._version="JS "+a._jsVersion+"."+a._jsEditVersion,a.browserInfo=function(){if(!s){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(s)return{browser:"ssr",version:0,OS:"ssr"}}(),a._hasEngineResourceLoaded=!1,a._engineResourcePath=(()=>{if(!s&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),a._defaultUIElementURL="@engineResourcePath/dce.ui.html",function(e){e[e.IPF_Binary=0]="IPF_Binary",e[e.IPF_BinaryInverted=1]="IPF_BinaryInverted",e[e.IPF_GrayScaled=2]="IPF_GrayScaled",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888"}(l||(l={})),function(e){e[e.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",e[e.DBR_SUCCESS=0]="DBR_SUCCESS",e[e.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",e[e.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",e[e.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",e[e.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",e[e.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",e[e.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",e[e.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",e[e.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",e[e.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",e[e.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",e[e.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",e[e.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",e[e.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",e[e.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",e[e.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",e[e.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",e[e.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",e[e.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",e[e.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",e[e.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",e[e.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",e[e.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",e[e.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",e[e.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",e[e.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",e[e.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",e[e.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",e[e.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",e[e.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",e[e.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",e[e.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",e[e.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",e[e.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",e[e.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",e[e.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",e[e.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",e[e.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",e[e.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",e[e.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",e[e.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",e[e.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",e[e.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",e[e.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",e[e.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",e[e.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",e[e.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",e[e.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",e[e.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",e[e.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",e[e.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",e[e.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",e[e.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",e[e.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",e[e.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",e[e.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",e[e.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",e[e.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",e[e.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",e[e.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",e[e.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(h||(h={})),function(e){e[e.IMRDT_IMAGE=1]="IMRDT_IMAGE",e[e.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",e[e.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",e[e.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",e[e.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",e[e.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(c||(c={})),function(e){e[e.BF_ALL=4265607167]="BF_ALL",e[e.BF_ONED=3147775]="BF_ONED",e[e.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",e[e.BF_CODE_39=1]="BF_CODE_39",e[e.BF_CODE_128=2]="BF_CODE_128",e[e.BF_CODE_93=4]="BF_CODE_93",e[e.BF_CODABAR=8]="BF_CODABAR",e[e.BF_ITF=16]="BF_ITF",e[e.BF_EAN_13=32]="BF_EAN_13",e[e.BF_EAN_8=64]="BF_EAN_8",e[e.BF_UPC_A=128]="BF_UPC_A",e[e.BF_UPC_E=256]="BF_UPC_E",e[e.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",e[e.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",e[e.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",e[e.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",e[e.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",e[e.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",e[e.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",e[e.BF_PATCHCODE=262144]="BF_PATCHCODE",e[e.BF_PDF417=33554432]="BF_PDF417",e[e.BF_QR_CODE=67108864]="BF_QR_CODE",e[e.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",e[e.BF_AZTEC=268435456]="BF_AZTEC",e[e.BF_MAXICODE=536870912]="BF_MAXICODE",e[e.BF_MICRO_QR=1073741824]="BF_MICRO_QR",e[e.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",e[e.BF_GS1_COMPOSITE=2147483648]="BF_GS1_COMPOSITE",e[e.BF_MSI_CODE=1048576]="BF_MSI_CODE",e[e.BF_CODE_11=2097152]="BF_CODE_11",e[e.BF_NULL=0]="BF_NULL"}(_||(_={})),"object"==typeof i.g&&i.g.process&&i.g.process.release&&i.g.process.release.name;const g="undefined"==typeof self,u=g?{}:self;class f{constructor(){this._canvasMaxWH="iPhone"==f.browserInfo.OS||"Android"==f.browserInfo.OS?2048:4096,this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.bFilterRegionInJs=!0,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0}static get version(){return this._version}static get license(){return this._license}static set license(e){if("unload"!=this._loadWasmStatus)throw new Error("`license` is not allowed to change after `createInstance` or `loadWasm` is called.");f._license=e}static get productKeys(){return this._license}static set productKeys(e){f.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){f.license=e}static get organizationID(){return this._license}static set organizationID(e){f.license=e}static set sessionPassword(e){if("unload"!=this._loadWasmStatus)throw new Error("`sessionPassword` is not allowed to change after `createInstance` or `loadWasm` is called.");f._sessionPassword=e}static get sessionPassword(){return this._sessionPassword}static detectEnvironment(){return d(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!("undefined"==typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e&&(e="./"),g)f._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,f._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(f._engineResourcePath+="/")}static get licenseServer(){return this._licenseServer}static set licenseServer(e){if("unload"!=this._loadWasmStatus)throw new Error("`licenseServer` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e)f._licenseServer=[];else{e instanceof Array||(e=[e]);for(let t=0;t<e.length;++t){if(!g){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}f._licenseServer=e}}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){if("unload"!=this._loadWasmStatus)throw new Error("`deviceFriendlyName` is not allowed to change after `createInstance` or `loadWasm` is called.");f._deviceFriendlyName=e||""}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if("unload"!=this._loadWasmStatus)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");f.__bUseFullFeature=e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e}get region(){return this._region}static isWasmLoaded(){return"loadSuccess"==this._loadWasmStatus}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static loadWasm(){return d(this,void 0,void 0,(function*(){switch(f._loadWasmStatus){case"unload":{let e,t=f._license,i=JSON.parse(JSON.stringify(f._licenseServer)),r=f._sessionPassword,o=null,n=null,s=0;if(t.startsWith("t")||t.startsWith("f"))s=0;else if(0===t.length||t.startsWith("P")||t.startsWith("L")||t.startsWith("Y")||t.startsWith("A"))s=1;else{s=2;const e=t.indexOf(":");if(-1!=e&&(t=t.substring(e+1)),t.startsWith("DLS2")){let e=t.substring(4);e=atob(e);const s=JSON.parse(e);if(s.handshakeCode?t=s.handshakeCode:s.organizationID&&(t=s.organizationID),"number"==typeof t&&(t=JSON.stringify(t)),t||(t=""),0===i.length){let e=[];s.mainServerURL&&(e[0]=s.mainServerURL),s.standbyServerURL&&(e[1]=s.standbyServerURL),f.licenseServer=e,i=f.licenseServer}!r&&s.sessionPassword&&(r=s.sessionPassword),s.chargeWay&&(n=s.chargeWay),s.limitedLicenseModules&&(o=s.limitedLicenseModules)}}if(s&&(u.crypto||(e="Please upgrade your browser to support online key."),u.crypto.subtle||(e="Require https to use online key in this browser.")),e){if(1!==s)throw new Error(e);s=0,console.warn(e),f._lastErrorCode=h.DMERR_FAILED_TO_REACH_LTS,f._lastErrorString=e}1===s&&(t="",console.warn("Applying for a public trial license ...")),f._loadWasmStatus="loading";let a=f.engineResourcePath+f._workerName;f.engineResourcePath.startsWith(location.origin)||(a=yield fetch(a).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),f._dbrWorker=new Worker(a),f._dbrWorker.onerror=e=>{f._loadWasmStatus="loadFail";let t=new Error(e.message);f._loadWasmErr=t;for(let e of f._loadWasmCallbackArr)e(t);f._loadWasmCallbackArr=[]},f._dbrWorker.onmessage=e=>d(this,void 0,void 0,(function*(){let t=e.data?e.data:e;switch(t.type){case"log":f._onLog&&f._onLog(t.message);break;case"load":{t.message&&(t.message=t.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let e=!1;if(1===s&&(e=!0),t.success){f._loadWasmStatus="loadSuccess",f._version=t.version+"(JS "+f._jsVersion+"."+f._jsEditVersion+")",f._onLog&&f._onLog("load dbr worker success");for(let e of f._loadWasmCallbackArr)e();f._loadWasmCallbackArr=[],f._dbrWorker.onerror=null,t.message&&console.warn(t.message)}else{let i=new Error(t.message);i.stack=t.stack+"\n"+i.stack,f._loadWasmStatus="loadFail",f._loadWasmErr=i;for(let e of f._loadWasmCallbackArr)e(i);f._loadWasmCallbackArr=[],e||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(e=!0)}e&&f.showDialog(t.success?"warn":"error",t.message);break}case"task":{let e=t.id,i=t.body;try{f._taskCallbackMap.get(e)(i),f._taskCallbackMap.delete(e)}catch(t){throw f._taskCallbackMap.delete(e),t}break}default:f._onLog&&f._onLog(e)}})),f._dbrWorker.postMessage({type:"loadWasm",bd:f._bWasmDebug,engineResourcePath:f.engineResourcePath,version:f._jsVersion,brtk:!!s,bptk:1===s,lcs:t,dm:location.origin.startsWith("http")?location.origin:"https://localhost",bUseFullFeature:f._bUseFullFeature,browserInfo:f.browserInfo,deviceFriendlyName:f.deviceFriendlyName,ls:i,sp:r,lm:o,cw:n})}case"loading":yield new Promise(((e,t)=>{f._loadWasmCallbackArr.push((i=>{i?t(i):e()}))}));break;case"loadSuccess":break;case"loadFail":throw f._loadWasmErr;default:throw new Error("Unexpected status")}}))}static showDialog(e,t){return d(this,void 0,void 0,(function*(){if(!f._bNeverShowDialog)try{let i=yield fetch(f.engineResourcePath+"dls.license.dialog.html");if(!i.ok)throw Error("Get license dialog fail. Network Error: "+i.statusText);let r=yield i.text();if(!r.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=r;let n=[];for(let e=0;e<o.childElementCount;++e){let t=o.children[e];t instanceof HTMLStyleElement&&(n.push(t),document.head.append(t))}let s=1==o.childElementCount?o.children[0]:o;s.remove();let a,d,l,h,c,_=[s],g=s.children;for(let e of g)_.push(e);for(let e=0;e<_.length;++e)for(let t of _[e].children)_.push(t);for(let i of _)if(!a&&i.classList.contains("dls-license-mask"))a=i,i.addEventListener("click",(e=>{if(i==e.target){s.remove();for(let e of n)e.remove()}}));else if(!d&&i.classList.contains("dls-license-icon-close"))d=i,i.addEventListener("click",(()=>{s.remove();for(let e of n)e.remove()}));else if(!l&&i.classList.contains("dls-license-icon-error"))l=i,"error"!=e&&i.remove();else if(!h&&i.classList.contains("dls-license-icon-warn"))h=i,"warn"!=e&&i.remove();else if(!c&&i.classList.contains("dls-license-msg-content")){c=i;let e=t;for(;e;){let t=e.indexOf("["),r=e.indexOf("]",t),o=e.indexOf("(",r),n=e.indexOf(")",o);if(-1==t||-1==r||-1==o||-1==n){i.appendChild(new Text(e));break}t>0&&i.appendChild(new Text(e.substring(0,t)));let s=document.createElement("a"),a=e.substring(t+1,r);s.innerText=a;let d=e.substring(o+1,n);s.setAttribute("href",d),s.setAttribute("target","_blank"),i.appendChild(s),e=e.substring(n+1)}}document.body.appendChild(s)}catch(e){f._onLog&&f._onLog(e.message||e)}}))}static createInstanceInWorker(e=!1){return d(this,void 0,void 0,(function*(){return yield f.loadWasm(),yield new Promise(((t,i)=>{let r=f._nextTaskID++;f._taskCallbackMap.set(r,(e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),f._dbrWorker.postMessage({type:"createInstance",id:r,bScanner:e})}))}))}static createInstance(){return d(this,void 0,void 0,(function*(){let e=new f;return e._instanceID=yield f.createInstanceInWorker(),e}))}decode(e){return d(this,void 0,void 0,(function*(){f._onLog&&f._onLog("decode(source: any)"),f._onLog&&(this._timeStartDecode=Date.now());{let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?yield this._decode_Blob(e,t):e instanceof ArrayBuffer?yield this._decode_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?yield this._decode_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?yield this._decode_Image(e,t):e instanceof HTMLCanvasElement?yield this._decode_Canvas(e,t):e instanceof HTMLVideoElement?yield this._decode_Video(e,t):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e,t):yield this._decode_Url(e,t):e&&"object"==typeof e?yield this._decode_DCEFrame(e,t):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}))}decodeBase64String(e){return d(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,t)}))}decodeUrl(e){return d(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,t)}))}_decodeBuffer_Uint8Array(e,t,i,r,o,n){return d(this,void 0,void 0,(function*(){return yield new Promise(((s,a)=>{let d=f._nextTaskID++;f._taskCallbackMap.set(d,(e=>{if(e.success){let t,i=f._onLog?Date.now():0;f._onLog&&f._onLog("worker return result: "+i),this._lastInnerDecodeDuration=e.duration;try{t=this._handleRetJsonString(e.decodeReturn)}catch(e){return a(e)}if(f._onLog){let e=Date.now();f._onLog("DBR time get result: "+i),f._onLog("Handle image cost: "+(this._timeEnterInnerDBR-this._timeStartDecode)),f._onLog("DBR worker decode image cost: "+(i-this._timeEnterInnerDBR)),f._onLog("DBR worker handle results: "+(e-i)),f._onLog("Total decode image cost: "+(e-this._timeStartDecode))}return s(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}})),this._timeEnterInnerDBR=Date.now(),f._onLog&&f._onLog("Send buffer to worker:"+this._timeEnterInnerDBR),f._dbrWorker.postMessage({type:"decodeBuffer",id:d,instanceID:this._instanceID,body:{buffer:e,width:t,height:i,stride:r,format:o,config:n}},[e.buffer]),f._onLog&&n&&n._timeEndGettingFrame&&f._onLog("decode image delay: "+(this._timeEnterInnerDBR-n._timeEndGettingFrame))}))}))}_decodeBuffer_Blob(e,t,i,r,o,n){return d(this,void 0,void 0,(function*(){f._onLog&&f._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const s=e.arrayBuffer?yield e.arrayBuffer():yield new Promise(((t,i)=>{let r=new FileReader;r.readAsArrayBuffer(e),r.onload=()=>{t(r.result)},r.onerror=()=>{i(r.error)}}));return yield this._decodeBuffer_Uint8Array(new Uint8Array(s),t,i,r,o,n)}))}decodeBuffer(e,t,i,r,o,n){return d(this,void 0,void 0,(function*(){let s;return f._onLog&&f._onLog("decodeBuffer(buffer,width,height,stride,format)"),f._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?s=yield this._decodeBuffer_Uint8Array(e,t,i,r,o,n):e instanceof ArrayBuffer?s=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,r,o,n):e instanceof Blob&&(s=yield this._decodeBuffer_Blob(e,t,i,r,o,n)),s}))}_decodeFileInMemory_Uint8Array(e){return d(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{let r=f._nextTaskID++;f._taskCallbackMap.set(r,(e=>{if(e.success){let r;this._lastInnerDecodeDuration=e.duration;try{r=this._handleRetJsonString(e.decodeReturn)}catch(e){return i(e)}return t(r)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),f._dbrWorker.postMessage({type:"decodeFileInMemory",id:r,instanceID:this._instanceID,body:{bytes:e}})}))}))}getRuntimeSettings(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(i=>{if(i.success){let t=JSON.parse(i.results);return null!=this.userDefinedRegion&&(t.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(t)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),f._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:this._instanceID})}))}))}updateRuntimeSettings(e){return d(this,void 0,void 0,(function*(){let t;if("string"==typeof e)if("speed"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=3,t.expectedBarcodesCount=0,t.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=5,t.expectedBarcodesCount=512,t.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region}else t=JSON.parse(e);else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(e)),t.region instanceof Array){let e=t.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!f._bUseFullFeature){if(0!=(t.barcodeFormatIds&~(_.BF_ONED|_.BF_QR_CODE|_.BF_PDF417|_.BF_DATAMATRIX))||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let e=t.region;if(e instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(e)),(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null,t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return yield new Promise(((e,i)=>{let r=f._nextTaskID++;f._taskCallbackMap.set(r,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){i(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}})),f._dbrWorker.postMessage({type:"updateRuntimeSettings",id:r,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})}))}))}resetRuntimeSettings(){return d(this,void 0,void 0,(function*(){return this.userDefinedRegion=null,this.region=null,yield new Promise(((e,t)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),f._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:this._instanceID})}))}))}outputRuntimeSettingsToString(){return d(this,void 0,void 0,(function*(){if(!f._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return yield new Promise(((e,t)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),f._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:i,instanceID:this._instanceID})}))}))}initRuntimeSettingsWithString(e){return d(this,void 0,void 0,(function*(){if(!f._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e)e=e;else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return yield new Promise(((t,i)=>{let r=f._nextTaskID++;f._taskCallbackMap.set(r,(e=>{if(e.success){try{this._handleRetJsonString(e.initReturn)}catch(e){i(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),f._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:r,instanceID:this._instanceID,body:{settings:e}})}))}))}_decode_Blob(e,t){return d(this,void 0,void 0,(function*(){f._onLog&&f._onLog("_decode_Blob(blob: Blob)");let i=null,r=null;if("undefined"!=typeof createImageBitmap)try{i=yield createImageBitmap(e)}catch(e){}i||(r=yield function(e){return new Promise(((t,i)=>{let r=URL.createObjectURL(e),o=new Image;o.dbrObjUrl=r,o.src=r,o.onload=()=>{t(o)},o.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let o=yield this._decode_Image(i||r,t);return i&&i.close(),o}))}_decode_ArrayBuffer(e,t){return d(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),t)}))}_decode_Uint8Array(e,t){return d(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),t)}))}_decode_Image(e,t){return d(this,void 0,void 0,(function*(){f._onLog&&f._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),t=t||{};let i,r,o,n,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,a=e instanceof HTMLImageElement?e.naturalHeight:e.height,d=t.region;if(d){let e,t,o,n;d.regionMeasuredByPercentage?(e=d.regionLeft*s/100,t=d.regionTop*a/100,o=d.regionRight*s/100,n=d.regionBottom*a/100):(e=d.regionLeft,t=d.regionTop,o=d.regionRight,n=d.regionBottom),i=e,r=t,s=Math.round(o-e),a=Math.round(n-t)}else i=0,r=0;const l=Math.max(s,a);if(l>this._canvasMaxWH){const e=this._canvasMaxWH/l;s>a?(o=this._canvasMaxWH,n=Math.round(a*e)):(o=Math.round(s*e),n=this._canvasMaxWH)}else o=s,n=a;let h,c;h=document.createElement("canvas"),h.width=o,h.height=n,h.getContext("2d").drawImage(e,i,r,s,a,0,0,o,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),d?(c=JSON.parse(JSON.stringify(t)),delete c.region):c=t;let _=yield this._decode_Canvas(h,c);return f.fixResultLocationWhenFilterRegionInJs(d,_,i,r,s,a,o,n),_}))}_decode_Canvas(e,t){return d(this,void 0,void 0,(function*(){if(f._onLog&&f._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let i=(e.dbrCtx2d||e.getContext("2d")).getImageData(0,0,e.width,e.height).data;return yield this._decodeBuffer_Uint8Array(i,e.width,e.height,4*e.width,l.IPF_ABGR_8888,t)}))}_decode_Video(e,t){return d(this,void 0,void 0,(function*(){if(f._onLog&&f._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";t=t||{};let i,r,o,n,s=e.videoWidth,a=e.videoHeight,d=t.region;if(d){let e,t,o,n;d.regionMeasuredByPercentage?(e=d.regionLeft*s/100,t=d.regionTop*a/100,o=d.regionRight*s/100,n=d.regionBottom*a/100):(e=d.regionLeft,t=d.regionTop,o=d.regionRight,n=d.regionBottom),i=e,r=t,s=Math.round(o-e),a=Math.round(n-t)}else i=0,r=0;const l=Math.max(s,a);if(l>this._canvasMaxWH){const e=this._canvasMaxWH/l;s>a?(o=this._canvasMaxWH,n=Math.round(a*e)):(o=Math.round(s*e),n=this._canvasMaxWH)}else o=s,n=a;let h,c=null;c=document.createElement("canvas"),c.width=o,c.height=n,(c.dbrCtx2d=c.getContext("2d")).drawImage(e,i,r,s,a,0,0,o,n),d?(h=JSON.parse(JSON.stringify(t)),delete h.region):h=t;let _=yield this._decode_Canvas(c,t);return d&&f.fixResultLocationWhenFilterRegionInJs(d,_,i,r,s,a,o,n),_}))}_decode_DCEFrame(e,t){return d(this,void 0,void 0,(function*(){if(f._onLog&&f._onLog("_decode_DCEFrame(dceFrame)"),!e)return null;let t;if(this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,data:new Uint8Array(e.data),toCanvas:e.toCanvas}),"grey"===e.colorMode){let{data:i,width:r,height:o,timeStamp:n}=e,s={timeStamp:n};t=yield this._decodeBuffer_Uint8Array(i,r,o,r,l.IPF_GrayScaled,s)}else if("rgba"===e.colorMode){let{data:i,width:r,height:o,timeStamp:n}=e,s={timeStamp:n};t=yield this._decodeBuffer_Uint8Array(i,r,o,4*r,l.IPF_ABGR_8888,s)}else{if("bgra"!==e.colorMode)throw new Error(`Color mode '${e.colorMode}' is not supported.`);{let{data:i,width:r,height:o,timeStamp:n}=e,s={timeStamp:n};t=yield this._decodeBuffer_Uint8Array(i,r,o,4*r,l.IPF_ARGB_8888,s)}}return t}))}_decode_Base64(e,t){return d(this,void 0,void 0,(function*(){if(f._onLog&&f._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");"data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1));{let i=atob(e),r=i.length,o=new Uint8Array(r);for(;r--;)o[r]=i.charCodeAt(r);return yield this._decode_Blob(new Blob([o]),t)}}))}_decode_Url(e,t){return d(this,void 0,void 0,(function*(){if(f._onLog&&f._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");e=e;{let i=yield new Promise(((t,i)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.send(),r.onloadend=()=>d(this,void 0,void 0,(function*(){t(r.response)})),r.onerror=()=>{i(new Error("Network Error: "+r.statusText))}}));return yield this._decode_Blob(i,t)}}))}_decode_FilePath(e,t){return d(this,void 0,void 0,(function*(){throw f._onLog&&f._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")}))}static fixResultLocationWhenFilterRegionInJs(e,t,i,r,o,n,s,a){if(e&&t.length>0)for(let e of t){let t=e.localizationResult;2==t.resultCoordinateType&&(t.x1*=.01*s,t.x2*=.01*s,t.x3*=.01*s,t.x4*=.01*s,t.y1*=.01*a,t.y2*=.01*a,t.y3*=.01*a,t.y4*=.01*a);let d=s/o,l=a/n;t.x1=t.x1/d+i,t.x2=t.x2/d+i,t.x3=t.x3/d+i,t.x4=t.x4/d+i,t.y1=t.y1/l+r,t.y2=t.y2/l+r,t.y3=t.y3/l+r,t.y4=t.y4/l+r,2==t.resultCoordinateType&&(t.x1*=100/o,t.x2*=100/o,t.x3*=100/o,t.x4*=100/o,t.y1*=100/n,t.y2*=100/n,t.y3*=100/n,t.y4*=100/n)}}static BarcodeReaderException(e,t){let i,r=h.DBR_UNKNOWN;return"number"==typeof e?(r=e,i=new Error(t)):i=new Error(e),i.code=r,i}_handleRetJsonString(e){let t=h;if(e.textResults){for(let t=0;t<e.textResults.length;t++){let i=e.textResults[t];try{let t=i.barcodeText,r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);try{i.barcodeText=decodeURIComponent(escape(r))}catch(e){i.barcodeText=r}}catch(e){i.barcodeText=""}if(null!=i.exception){f._setWarnnedEx.has(i.exception)||(f._setWarnnedEx.add(i.exception),console.warn(i.exception));let e={};i.exception.split(";").forEach((t=>{let i=t.indexOf(":");e[t.substring(0,i)]=t.substring(i+1)})),i.exception=e}}return e.decodeRecords?this.decodeRecords=e.decodeRecords:this.decodeRecords={},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!f._setWarnnedEx.has(e.description)&&(f._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==t.DBR_SUCCESS)return e.data;throw f.BarcodeReaderException(e.exception,e.description)}setModeArgument(e,t,i,r){return d(this,void 0,void 0,(function*(){return yield new Promise(((o,n)=>{let s=f._nextTaskID++;f._taskCallbackMap.set(s,(e=>{if(e.success){try{this._handleRetJsonString(e.setReturn)}catch(e){return n(e)}return o()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}})),f._dbrWorker.postMessage({type:"setModeArgument",id:s,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i,argumentValue:r}})}))}))}getModeArgument(e,t,i){return d(this,void 0,void 0,(function*(){return yield new Promise(((r,o)=>{let n=f._nextTaskID++;f._taskCallbackMap.set(n,(e=>{if(e.success){let t;try{t=this._handleRetJsonString(e.getReturn)}catch(e){return o(e)}return r(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)}})),f._dbrWorker.postMessage({type:"getModeArgument",id:n,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i}})}))}))}getIntermediateResults(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),f._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:this._instanceID})}))}))}getIntermediateCanvas(){return d(this,void 0,void 0,(function*(){let e=yield this.getIntermediateResults(),t=[];for(let i of e)if(i.dataType==c.IMRDT_IMAGE)for(let e of i.results){const i=e.bytes;let r;switch(f._onLog&&f._onLog(" "+i.length+" "+i.byteLength+" "+e.width+" "+e.height+" "+e.stride+" "+e.format),e.format){case l.IPF_ABGR_8888:r=new Uint8ClampedArray(i);break;case l.IPF_RGB_888:{const e=i.length/3;r=new Uint8ClampedArray(4*e);for(let t=0;t<e;++t)r[4*t]=i[3*t+2],r[4*t+1]=i[3*t+1],r[4*t+2]=i[3*t],r[4*t+3]=255;break}case l.IPF_GrayScaled:{const e=i.length;r=new Uint8ClampedArray(4*e);for(let t=0;t<e;t++)r[4*t]=r[4*t+1]=r[4*t+2]=i[t],r[4*t+3]=255;break}case l.IPF_Binary:case l.IPF_BinaryInverted:{e.width=8*e.stride,e.height=i.length/e.stride;const t=i.length;r=new Uint8ClampedArray(8*t*4);for(let e=0;e<t;e++){let t=i[e];for(let i=0;i<8;++i)r[4*(8*e+i)]=r[4*(8*e+i)+1]=r[4*(8*e+i)+2]=(128&t)/128*255,r[4*(8*e+i)+3]=255,t<<=1}break}default:console.warn("unknow intermediate image",e)}if(!r)continue;let o=new ImageData(r,e.width,e.height),n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(o,0,0),t.push(n)}return t}))}destroyContext(){if(f._onLog&&f._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0;let e=f._nextTaskID++;f._taskCallbackMap.set(e,(e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}})),f._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}f._jsVersion="9.0.0",f._jsEditVersion="20220322",f._version="loading...(JS "+f._jsVersion+"."+f._jsEditVersion+")",f._license=!g&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",f._sessionPassword=!g&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",f.browserInfo=function(){if(!g){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(g)return{browser:"ssr",version:0,OS:"ssr"}}(),f._workerName="dbr-"+f._jsVersion+".worker.js",f._engineResourcePath=(()=>{if(!g&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),f._licenseServer=[],f._deviceFriendlyName="",f._isShowRelDecodeTimeInResults=!1,f._bWasmDebug=!1,f._bNeverShowDialog=!1,f.__bUseFullFeature=!0,f._nextTaskID=0,f._taskCallbackMap=new Map,f._loadWasmStatus="unload",f._loadWasmCallbackArr=[],f._lastErrorCode=0,f._lastErrorString="",f._setWarnnedEx=new Set,f._loadWasmErr=null,"object"==typeof i.g&&i.g.process&&i.g.process.release&&i.g.process.release.name;class m extends f{constructor(){super(),this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this.resultsOverlay=null,this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundOnSuccessfullRead=new Audio("data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.barcodeFillStyle="rgba(254,180,32,0.3)",this.barcodeStrokeStyle="rgba(254,180,32,0.9)",this.barcodeLineWidth=1,this.beingLazyDrawRegionsults=!1,this.dce=null,this._onCameraSelChange=()=>{},this._onResolutionSelChange=()=>{},this._onCloseBtnClick=()=>{},this._onPlayed=null}static get defaultUIElementURL(){var e;return null===(e=m._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",f.engineResourcePath)}static set defaultUIElementURL(e){m._defaultUIElementURL=e}getUIElement(){return this.dce.getUIElement()}setUIElement(e){return d(this,void 0,void 0,(function*(){yield this.dce.setUIElement(e)}))}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){this.dce.singleFrameMode=e,e?(this.dce.ifShowScanRegionLaser=!1,(()=>{d(this,void 0,void 0,(function*(){let e=yield this.getScanSettings();e.oneDTrustFrameCount=1,yield this.updateScanSettings(e)}))})()):this.dce.ifShowScanRegionLaser=!0}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}get soundOnSuccessfullRead(){return this._soundOnSuccessfullRead}set soundOnSuccessfullRead(e){e instanceof HTMLAudioElement?this._soundOnSuccessfullRead=e:this._soundOnSuccessfullRead=new Audio(e)}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({regionMaskFillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({regionMaskStrokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({regionMaskLineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.singleFrameMode||(this.beingLazyDrawRegionsults=!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.frameColorMode=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}createDCEInstance(){return d(this,void 0,void 0,(function*(){this.dce||(f._onLog&&f._onLog("createDCEInstance()"),a.defaultUIElementURL=null,this.dce=yield a.createInstance(),this.dce.refreshInterval=200,this.dce.frameColorMode="grey",this.dce.maxCvsSideLength="iPhone"==m.browserInfo.OS||"Android"==m.browserInfo.OS?2048:4096,this.dce.on("cameraChange",(()=>{this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("resolutionChange",(()=>{this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("cameraClose",(()=>{this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1})),this.dce.on("singleFrameAcquired",(e=>d(this,void 0,void 0,(function*(){if(!e)return;if(!e.data)return;const t=yield this._decode_DCEFrame(e);yield this.clearMapDecodeRecord();for(let e of t)delete e.bUnduplicated;if(this._drawResults(t),this.onFrameRead&&this.isOpen()&&!this._bPauseScan&&this.onFrameRead(t),this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let e of t)this.onUniqueRead(e.barcodeText,e)})))))}))}static createInstance(e){return d(this,void 0,void 0,(function*(){let t=new m;yield t.createDCEInstance(),t._instanceID=yield m.createInstanceInWorker(!0),"string"==typeof e&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return yield t.setUIElement(m.defaultUIElementURL),t.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),t.singleFrameMode||(yield t.updateRuntimeSettings("single")),t}))}decodeCurrentFrame(e){return d(this,void 0,void 0,(function*(){this._assertOpen();let t=null;e&&e.region&&(t=e.region);let i=this.dce._getVideoFrame(t);return this._decode_DCEFrame(i)}))}clearMapDecodeRecord(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),f._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:i,instanceID:this._instanceID})}))}))}static isRegionNormalPreset(e){return 0==e.regionLeft&&0==e.regionTop&&0==e.regionRight&&0==e.regionBottom&&0==e.regionMeasuredByPercentage}updateRuntimeSettings(e){return d(this,void 0,void 0,(function*(){let t;if("string"==typeof e)if("speed"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region||(t.region=e.region)}else if("balance"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region||(t.region=e.region),t.deblurLevel=3,t.expectedBarcodesCount=512,t.localizationModes=[2,16,0,0,0,0,0,0],t.timeout=1e5}else if("coverage"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region||(t.region=e.region),t.deblurLevel=5,t.expectedBarcodesCount=512,t.scaleDownThreshold=1e5,t.localizationModes=[2,16,4,8,0,0,0,0],t.timeout=1e5}else if("single"==e){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,m.isRegionNormalPreset(e.region)?t.region=null:t.region=e.region,t.expectedBarcodesCount=1,t.localizationModes=[16,2,0,0,0,0,0,0],t.barcodeZoneMinDistanceToImageBorders=0}else t=JSON.parse(e);else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(e)),t.region instanceof Array){let i=e.region;[i.regionLeft,i.regionTop,i.regionLeft,i.regionBottom,i.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:i.regionLeft||0,regionTop:i.regionTop||0,regionRight:i.regionRight||0,regionBottom:i.regionBottom||0,regionMeasuredByPercentage:i.regionMeasuredByPercentage||0})}}if(!f._bUseFullFeature){if(0!=(t.barcodeFormatIds&~(_.BF_ONED|_.BF_QR_CODE|_.BF_PDF417|_.BF_DATAMATRIX))||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let e=t.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(e)):this.userDefinedRegion=null,e instanceof Array)if(e.length){for(let t=0;t<e.length;++t){let i=e[t];i&&((i.regionLeft||i.regionTop||i.regionRight||i.regionBottom||i.regionMeasuredByPercentage)&&(i.regionLeft||i.regionTop||100!=i.regionRight||100!=i.regionBottom||!i.regionMeasuredByPercentage)||(e[t]=null))}this.region=e}else this.region=null;else e&&(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null;this.bFilterRegionInJs&&(t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}yield new Promise(((e,i)=>{let r=f._nextTaskID++;f._taskCallbackMap.set(r,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){i(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}})),f._dbrWorker.postMessage({type:"updateRuntimeSettings",id:r,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})})),"single"==e&&(yield this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","0"),yield this.setModeArgument("LocalizationModes",0,"ScanDirection","2"),yield this.setModeArgument("BinarizationModes",0,"BlockSizeX","71"),yield this.setModeArgument("BinarizationModes",0,"BlockSizeY","71"))}))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}getAllCameras(){return d(this,void 0,void 0,(function*(){return this.dce.getAllCameras()}))}getCurrentCamera(){return d(this,void 0,void 0,(function*(){return this.dce.getSelectedCamera()}))}setCurrentCamera(e){return d(this,void 0,void 0,(function*(){return this.dce.selectCamera(e)}))}getResolution(){return this.dce.getResolution()}setResolution(e,t){return d(this,void 0,void 0,(function*(){return this.dce.setResolution(e,t)}))}getScanSettings(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(i=>{if(i.success){let t=i.results;return t.intervalTime=this.intervalTime,t.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,t.soundOnSuccessfullRead=this.soundOnSuccessfullRead.src,t.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,t.vibrateDuration=this.vibrateDuration,e(t)}{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}})),f._dbrWorker.postMessage({type:"getScanSettings",id:i,instanceID:this._instanceID})}))}))}updateScanSettings(e){return d(this,void 0,void 0,(function*(){if(!e)return;const t=JSON.parse(JSON.stringify(e));return t.hasOwnProperty("intervalTime")&&(this.intervalTime=t.intervalTime,delete t.intervalTime),t.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=t.whenToPlaySoundforSuccessfulRead,delete t.whenToPlaySoundforSuccessfulRead),t.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundOnSuccessfullRead.src=t.soundOnSuccessfullRead,delete t.soundOnSuccessfullRead),t.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=t.whenToVibrateforSuccessfulRead,delete t.whenToVibrateforSuccessfulRead),t.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=t.vibrateDuration,delete t.vibrateDuration),yield new Promise(((e,i)=>{let r=f._nextTaskID++;f._taskCallbackMap.set(r,(t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack+="\n"+t.stack,i(e)}})),m._dbrWorker.postMessage({type:"updateScanSettings",id:r,instanceID:this._instanceID,body:{settings:t}})}))}))}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}stop(){this.dce.stop(),this.dce.hideScanRegionLaser(),this.dce.hideViewDecorator(),this.dce.hideScanRegionOverlays(),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}play(e,t,i){return d(this,void 0,void 0,(function*(){return this.dce.play(e,t,i)}))}pauseScan(){this._assertOpen(),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}applyConstraints(e){return d(this,void 0,void 0,(function*(){return this.dce.applyConstraints(e)}))}turnOnTorch(){return d(this,void 0,void 0,(function*(){return this.dce.turnOnTorch()}))}turnOffTorch(){return d(this,void 0,void 0,(function*(){return this.dce.turnOffTorch()}))}setColorTemperature(e){return d(this,void 0,void 0,(function*(){return this.dce.setColorTemperature(e)}))}setExposureCompensation(e){return d(this,void 0,void 0,(function*(){return this.dce.setExposureCompensation(e)}))}setZoom(e){return d(this,void 0,void 0,(function*(){return this.dce.setZoom(e)}))}setFrameRate(e){return d(this,void 0,void 0,(function*(){return this.dce.setFrameRate(e)}))}getFrameRate(){return this.dce.getFrameRate()}setFocus(e,t){return d(this,void 0,void 0,(function*(){return this.dce.setFocus(e,t)}))}getFocus(){return this.dce.getFocus()}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let i of e)t.push(this._cloneDecodeResults(i));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}_loopReadVideo(){return d(this,void 0,void 0,(function*(){if(this.bDestroyed)return void this.dce.stopFetchingLoop();if(!this.isOpen())return this.dce.stopFetchingLoop(),void(yield this.clearMapDecodeRecord());if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return f._onLog&&f._onLog("Video or scan is paused. Ask in 1s."),this.dce.stopFetchingLoop(),yield this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));this.dce.ifShowScanRegionLaser=!0,f._onLog&&f._onLog("======= once read ======="),f._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(()=>d(this,void 0,void 0,(function*(){return e._bUseWebGL||"grey"!==e.colorMode||(this.dce.frameColorMode="rgba"),this._decode_DCEFrame(e)})))().then((e=>{f._onLog&&f._onLog(e);let t=this.array_decodeFrameTimeCost,i=this.array_getFrameTimeCost,r=this._indexCurrentDecodingFrame;if((()=>{if(this.region instanceof Array){for(t[r]&&t[r]instanceof Array||(t[r]=[]);t[r].length>=5;)t[r].shift();t[r].push(this._lastInnerDecodeDuration)}else{for(;t.length>=5;)t.shift();t.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=(()=>{let e=0;if(this.region instanceof Array){let o=0,n=0;o=r+1>=this.region.length?0:r+1,n=o+1>=this.region.length?0:o+1,e=t[o]&&t[o].length&&i[n]&&i[n].length?Math.min(...t[o])-Math.max(...i[n]):0}else if(i&&i.length){let r=Math.min(...t),o=Math.max(...i);r&&o&&(e=r-o)}else e=0;return e>0?e:0})()+this.intervalTime,this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead)t=!0;else if("unique"===this.bPlaySoundOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}t&&(this.soundOnSuccessfullRead.currentTime=0,this.soundOnSuccessfullRead.play().catch((e=>{console.warn("Autoplay not allowed. User interaction required: "+(e.message||e))})))}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead)t=!0;else if("unique"===this.bVibrateOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}if(t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onFrameRead){let t=this._cloneDecodeResults(e);for(let e of t)delete e.bUnduplicated;this.onFrameRead(t)}if(this.onUniqueRead)for(let t of e)t.bUnduplicated&&this.onUniqueRead(t.barcodeText,this._cloneDecodeResults(t));this._drawResults(e)}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce.stopFetchingLoop(),f._onLog&&f._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}))}_getVideoFrame(){let e=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,e||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;const t=this.dce.getFrameFromBuffer();return(e=>{let t=e.timeSpent,i=this.array_getFrameTimeCost;if(this.region instanceof Array){let e=this._indexCurrentDecodingFrame;for(i[e]&&i[e]instanceof Array||(i[e]=[]);i[e].length>=5;)i[e].shift();i[e].push(t)}else{for(;i.length>=5;)i.shift();i.push(t)}})(t),t}_drawResults(e){if(!this.dce)return;this.resultsOverlay||(this.resultsOverlay=this.dce.addScanRegionOverlayCanvas());const t=this.resultsOverlay.getContext("2d");if(t.clearRect(0,0,this.resultsOverlay.width,this.resultsOverlay.height),e){t.globalCompositeOperation="destination-over",t.fillStyle=this.barcodeFillStyle,t.strokeStyle=this.barcodeStrokeStyle,t.lineWidth=this.barcodeLineWidth;for(let i of e){let e=i.localizationResult;t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineTo(e.x3,e.y3),t.lineTo(e.x4,e.y4),t.fill(),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineTo(e.x3,e.y3),t.lineTo(e.x4,e.y4),t.closePath(),t.stroke()}}}open(){return d(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}openVideo(){return d(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}close(){this.dce.close(),this._bPauseScan=!0}show(){return d(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}showVideo(){return d(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}hide(){this.dce.close(!0),this._bPauseScan=!0}destroyContext(){this.close(),this.bDestroyed||super.destroyContext()}}var R,v,S,E,p,I,y,A,T,D,C,M,L,O,b,w,F,N,B,P,V,k,U,x,G,W,H;m._defaultUIElementURL="@engineResourcePath/dbr.ui.html",function(e){e[e.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",e[e.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",e[e.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",e[e.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",e[e.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",e[e.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",e[e.BICM_SKIP=0]="BICM_SKIP",e[e.BICM_REV=2147483648]="BICM_REV"}(R||(R={})),function(e){e[e.BCM_AUTO=1]="BCM_AUTO",e[e.BCM_GENERAL=2]="BCM_GENERAL",e[e.BCM_SKIP=0]="BCM_SKIP",e[e.BCM_REV=2147483648]="BCM_REV"}(v||(v={})),function(e){e[e.BF2_NULL=0]="BF2_NULL",e[e.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",e[e.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",e[e.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",e[e.BF2_POSTNET=2097152]="BF2_POSTNET",e[e.BF2_PLANET=4194304]="BF2_PLANET",e[e.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",e[e.BF2_RM4SCC=16777216]="BF2_RM4SCC",e[e.BF2_DOTCODE=2]="BF2_DOTCODE",e[e.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",e[e.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",e[e.BF2_PHARMACODE=12]="BF2_PHARMACODE"}(S||(S={})),function(e){e[e.BM_AUTO=1]="BM_AUTO",e[e.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",e[e.BM_SKIP=0]="BM_SKIP",e[e.BM_THRESHOLD=4]="BM_THRESHOLD",e[e.BM_REV=2147483648]="BM_REV"}(E||(E={})),function(e){e[e.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(p||(p={})),function(e){e[e.CFM_GENERAL=1]="CFM_GENERAL"}(I||(I={})),function(e){e[e.CCM_AUTO=1]="CCM_AUTO",e[e.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",e[e.CCM_SKIP=0]="CCM_SKIP",e[e.CCM_REV=2147483648]="CCM_REV"}(y||(y={})),function(e){e[e.CICM_GENERAL=1]="CICM_GENERAL",e[e.CICM_SKIP=0]="CICM_SKIP",e[e.CICM_REV=2147483648]="CICM_REV"}(A||(A={})),function(e){e[e.CM_IGNORE=1]="CM_IGNORE",e[e.CM_OVERWRITE=2]="CM_OVERWRITE"}(T||(T={})),function(e){e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(D||(D={})),function(e){e[e.DRM_AUTO=1]="DRM_AUTO",e[e.DRM_GENERAL=2]="DRM_GENERAL",e[e.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",e[e.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",e[e.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",e[e.DRM_SKIP=0]="DRM_SKIP",e[e.DRM_REV=2147483648]="DRM_REV"}(C||(C={})),function(e){e[e.DPMCRM_AUTO=1]="DPMCRM_AUTO",e[e.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",e[e.DPMCRM_SKIP=0]="DPMCRM_SKIP",e[e.DPMCRM_REV=2147483648]="DPMCRM_REV"}(M||(M={})),function(e){e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_REV=2147483648]="GTM_REV"}(L||(L={})),function(e){e[e.IPM_AUTO=1]="IPM_AUTO",e[e.IPM_GENERAL=2]="IPM_GENERAL",e[e.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",e[e.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",e[e.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",e[e.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",e[e.IPM_SKIP=0]="IPM_SKIP",e[e.IPM_REV=2147483648]="IPM_REV"}(O||(O={})),function(e){e[e.IRSM_MEMORY=1]="IRSM_MEMORY",e[e.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",e[e.IRSM_BOTH=4]="IRSM_BOTH"}(b||(b={})),function(e){e[e.IRT_NO_RESULT=0]="IRT_NO_RESULT",e[e.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",e[e.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",e[e.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",e[e.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",e[e.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",e[e.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",e[e.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",e[e.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",e[e.IRT_CONTOUR=256]="IRT_CONTOUR",e[e.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",e[e.IRT_FORM=1024]="IRT_FORM",e[e.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",e[e.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",e[e.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(w||(w={})),function(e){e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=2147483648]="LM_REV"}(F||(F={})),function(e){e[e.PDFRM_RASTER=1]="PDFRM_RASTER",e[e.PDFRM_AUTO=2]="PDFRM_AUTO",e[e.PDFRM_VECTOR=4]="PDFRM_VECTOR",e[e.PDFRM_REV=2147483648]="PDFRM_REV"}(N||(N={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(B||(B={})),function(e){e[e.RPM_AUTO=1]="RPM_AUTO",e[e.RPM_GENERAL=2]="RPM_GENERAL",e[e.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",e[e.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",e[e.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",e[e.RPM_SKIP=0]="RPM_SKIP",e[e.RPM_REV=2147483648]="RPM_REV"}(P||(P={})),function(e){e[e.RCT_PIXEL=1]="RCT_PIXEL",e[e.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(V||(V={})),function(e){e[e.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",e[e.RT_RAW_TEXT=1]="RT_RAW_TEXT",e[e.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",e[e.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(k||(k={})),function(e){e[e.SUM_AUTO=1]="SUM_AUTO",e[e.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",e[e.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",e[e.SUM_SKIP=0]="SUM_SKIP",e[e.SUM_REV=2147483648]="SUM_REV"}(U||(U={})),function(e){e[e.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",e[e.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",e[e.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",e[e.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",e[e.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",e[e.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(x||(x={})),function(e){e[e.TFM_AUTO=1]="TFM_AUTO",e[e.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",e[e.TFM_SKIP=0]="TFM_SKIP",e[e.TFM_REV=2147483648]="TFM_REV"}(G||(G={})),function(e){e[e.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",e[e.TROM_POSITION=2]="TROM_POSITION",e[e.TROM_FORMAT=4]="TROM_FORMAT",e[e.TROM_SKIP=0]="TROM_SKIP",e[e.TROM_REV=2147483648]="TROM_REV"}(W||(W={})),function(e){e[e.TDM_AUTO=1]="TDM_AUTO",e[e.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",e[e.TDM_SKIP=0]="TDM_SKIP",e[e.TDM_REV=2147483648]="TDM_REV"}(H||(H={})),f.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.0.0/dist/",a.defaultUIElementURL="https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@2.3.1/dist/dce.ui.html";class J extends r.Uw{constructor(){super(...arguments),this.reader=null,this.enhancer=null,this.decoding=!1}async toggleTorch(e){var t,i;if(this.enhancer)try{e.on?null===(t=this.enhancer)||void 0===t||t.turnOnTorch():null===(i=this.enhancer)||void 0===i||i.turnOffTorch()}catch(e){throw new Error("Torch unsupported")}}async stopScan(){var e;try{this.stopDecoding(),null===(e=this.enhancer)||void 0===e||e.close(!0)}catch(e){throw e}}async pauseScan(){var e;try{this.stopDecoding(),null===(e=this.enhancer)||void 0===e||e.pause()}catch(e){throw e}}async resumeScan(){var e;try{await(null===(e=this.enhancer)||void 0===e?void 0:e.resume()),this.startDecoding()}catch(e){throw e}}async destroy(){var e,t;this.stopDecoding(),null===(e=this.enhancer)||void 0===e||e.dispose(!0),null===(t=this.reader)||void 0===t||t.destroyContext(),this.enhancer=null,this.reader=null}async initialize(e){return null===this.reader?(e&&e.license&&(f.license=e.license),this.enhancer=await a.createInstance(),this.reader=await m.createInstance(),await this.reader.updateRuntimeSettings("balance"),this.enhancer.on("played",(e=>{this.notifyListeners("onPlayed",{resolution:e.width+"x"+e.height})})),await this.enhancer.setUIElement("https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@2.3.1/dist/dce.ui.html"),this.enhancer.getUIElement().getElementsByClassName("dce-btn-close")[0].remove(),this.enhancer.getUIElement().getElementsByClassName("dce-sel-camera")[0].remove(),this.enhancer.getUIElement().getElementsByClassName("dce-sel-resolution")[0].remove(),this.enhancer.getUIElement().getElementsByClassName("dce-msg-poweredby")[0].remove()):console.log("Scanner already initialized."),{success:!0}}async captureAndDecode(){if(null==this.enhancer||null==this.reader)return;if(0==this.enhancer.isOpen())return;if(1==this.decoding)return;let e=this.enhancer.getFrame();if(e){this.decoding=!0;let i=await this.reader.decode(e);this.decoding=!1;let r=[];for(let t=0;t<i.length;t++){let o,n=i[t],s=0,a=0;1==e.isCropped&&(s=e.sx,a=e.sy),o={barcodeText:n.barcodeText,barcodeFormat:n.barcodeFormatString,barcodeBytesBase64:this.arrayBufferToBase64(n.barcodeBytes),x1:n.localizationResult.x1+s,y1:n.localizationResult.y1+a,x2:n.localizationResult.x2+s,y2:n.localizationResult.y2+a,x3:n.localizationResult.x3+s,y3:n.localizationResult.y3+a,x4:n.localizationResult.x4+s,y4:n.localizationResult.y4+a},r.push(o)}var t={results:r};this.notifyListeners("onFrameRead",t)}}async setScanRegion(e){var t;return null===(t=this.enhancer)||void 0===t||t.setScanRegion({regionLeft:e.left,regionTop:e.top,regionRight:e.right,regionBottom:e.bottom,regionMeasuredByPercentage:e.measuredByPercentage}),{success:!0}}async initRuntimeSettingsWithString(e){var t;e.template&&(await(null===(t=this.reader)||void 0===t?void 0:t.initRuntimeSettingsWithString(e.template)),console.log("Using template"))}async startScan(){var e;await(null===(e=this.enhancer)||void 0===e?void 0:e.open(!0)),this.startDecoding()}startDecoding(){this.interval&&clearInterval(this.interval),this.decoding=!1,this.interval=setInterval(this.captureAndDecode.bind(this),100)}stopDecoding(){this.interval&&clearInterval(this.interval),this.decoding=!1}arrayBufferToBase64(e){for(var t="",i=new Uint8Array(e),r=i.byteLength,o=0;o<r;o++)t+=String.fromCharCode(i[o]);return window.btoa(t)}async getAllCameras(){if(this.enhancer){let e=await this.enhancer.getAllCameras(),t=[];return e.forEach((e=>{t.push(e.label)})),{cameras:t}}return{message:"not initialized"}}async selectCamera(e){var t;if(this.enhancer){let i=await this.enhancer.getAllCameras();for(let r=0;r<i.length;r++){const o=i[r];if(o.label===e.cameraID)return await(null===(t=this.enhancer)||void 0===t?void 0:t.selectCamera(o)),{success:!0}}return{message:"not found"}}return{message:"not initialized"}}async getSelectedCamera(){return this.enhancer?{selectedCamera:this.enhancer.getSelectedCamera().label}:{message:"not initialized"}}async getResolution(){if(this.enhancer){let e=this.enhancer.getResolution();return{resolution:e[0]+"x"+e[1]}}return{message:"not initialized"}}async setResolution(e){if(this.enhancer){let t=e.resolution,i=1280,r=720;return t==o.F.RESOLUTION_480P?(i=640,r=480):t==o.F.RESOLUTION_720P?(i=1280,r=720):t==o.F.RESOLUTION_1080P?(i=1920,r=1080):t==o.F.RESOLUTION_2K?(i=2560,r=1440):t==o.F.RESOLUTION_4K&&(i=3840,r=2160),await this.enhancer.setResolution(i,r),{success:!0}}return{message:"not initialized"}}async setZoom(e){return this.enhancer?(await this.enhancer.setZoom(e.factor),{success:!0}):{message:"not initialized"}}setFocus(e){throw new Error("Method not implemented.")}}}}]);
//# sourceMappingURL=621.3e048aac.chunk.js.map