import{W as dt}from"./index-DRDlNxNC.js";/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.0.32
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */var Me,X,oe;typeof SuppressedError=="function"&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(Me||(Me={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(X||(X={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12"}(oe||(oe={}));const ee=(e,t)=>{let s=e.split("."),r=t.split(".");for(let i=0;i<s.length&&i<r.length;++i){let a=s[i],n=r[i];if(a===n)continue;let o=parseInt(s[i]),E=parseInt(r[i]);return o===E||Number.isNaN(o)&&Number.isNaN(E)?a<n?-1:1:o<E||Number.isNaN(o)&&Number.isInteger(E)?-1:1}return s.length===r.length?0:s.length<r.length?-1:1},Ee=typeof self>"u",ne=(()=>{if(!Ee&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),ae=e=>{if(e==null&&(e="./"),!Ee){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};let $,w,ie,_e,p;typeof navigator<"u"&&($=navigator,w=$.userAgent,ie=$.platform,_e=$.mediaDevices),function(){if(!Ee){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:$.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ie,search:"Win"},Mac:{str:ie},Linux:{str:ie}};let s="unknownBrowser",r=0,i="unknownOS";for(let a in e){const n=e[a]||{};let o=n.str||w,E=n.search||a,_=n.verStr||w,c=n.verSearch||a;if(c instanceof Array||(c=[c]),o.indexOf(E)!=-1){s=a;for(let I of c){let l=_.indexOf(I);if(l!=-1){r=parseFloat(_.substring(l+I.length+1));break}}break}}for(let a in t){const n=t[a]||{};let o=n.str||w,E=n.search||a;if(o.indexOf(E)!=-1){i=a;break}}i=="Linux"&&w.indexOf("Windows NT")!=-1&&(i="HarmonyOS"),p={browser:s,version:r,OS:i}}Ee&&(p={browser:"ssr",version:0,OS:"ssr"})}();const ut=typeof WebAssembly<"u"&&w&&!(/Safari/.test(w)&&!/Chrome/.test(w)&&/\(.+\s11_2_([2-6]).*\)/.test(w)),Tt=!(typeof Worker>"u"),it=!(!_e||!_e.getUserMedia),Ct=async()=>{let e=!1;if(it)try{(await _e.getUserMedia({video:!0})).getTracks().forEach(t=>{t.stop()}),e=!0}catch{}return e};p.browser==="Chrome"&&p.version>66||p.browser==="Safari"&&p.version>13||p.browser==="OPR"&&p.version>43||p.browser==="Edge"&&p.version;const Fe=e=>e&&typeof e=="object"&&typeof e.then=="function";let At=class extends Promise{constructor(t){let s,r;super((i,a)=>{s=i,r=a}),this._s="pending",this.resolve=i=>{this.isPending&&(Fe(i)?this.task=i:(this._s="fulfilled",s(i)))},this.reject=i=>{this.isPending&&(this._s="rejected",r(i))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let s;this._task=t,Fe(t)?s=t:typeof t=="function"&&(s=new Promise(t)),s&&(async()=>{try{const r=await s;t===this._task&&this.resolve(r)}catch(r){t===this._task&&this.reject(r)}})()}get isEmpty(){return this._task==null}};const ce={},Ie=e=>{let t=ce[e],s=!1;return t?t.isEmpty?t.task=()=>{}:s=!0:t=ce[e]=new At(()=>{}),{p:t,justWait:s}};let d,rt=0;const h=()=>rt++,T={};let k;const Dt=e=>{k=e,d&&d.postMessage({type:"setBLog",body:{value:!!e}})};let fe=!1;const ht=e=>{fe=e,d&&d.postMessage({type:"setBDebug",body:{value:!!e}})},Y={},P={},Ce=e=>e==="std"?ae(ne+"../../dynamsoft-capture-vision-std@1.0.0/dist/"):e==="dip"?ae(ne+"../../dynamsoft-image-processing@2.0.30/dist/"):e==="dcm"?ae(ne+"../../dynamsoft-label-recognizer-data@1.0.0/dist/"):void 0,C={std:{version:"1.0.0",path:Ce("std")},core:{version:"3.0.32",path:ne},dip:{version:"2.0.30",path:Ce("dip")},dcm:Ce("dcm")},J=new Proxy(C,{get(e,t,s){let r=Reflect.get(e,t,s);return r&&r.path&&(r=r.path),r}}),q={core:{js:!0,wasm:!0},dip:{wasm:!0}},B=async e=>{e instanceof Array||(e=e?[e]:[]),e=e.map(o=>o.toLowerCase()).filter(o=>o!="core"&&o!="std");for(let o of e)if(!q[o]&&o!=="dedicator")throw Error("Module '"+o+"' not existed.");e.some(o=>["dbr","dlr","ddn"].includes(o))&&(e.unshift("dip"),e=[...new Set(e)]);let t=!1;const s=[];{const{p:o,justWait:E}=Ie("core");E?await o:(s.push(o),t=!0)}const r={};for(let o of e){const{p:E,justWait:_}=Ie(o);_?await E:s.push(E),r[o]=q[o]}if(s.length==0)return;const i={};for(let o in J){if(o=="rootDirectory")continue;let E=J[o];J.rootDirectory&&(E=J.rootDirectory+"/"+E),i[o]=ae(E)}const a={engineResourcePaths:i,autoResources:r,names:e};if(t){a.needLoadCore=!0;let o=i.core+v._workerName;i.rootDirectory&&(o=i.rootDirectory+o),o.startsWith(location.origin)||(o=await fetch(o).then(E=>E.blob()).then(E=>URL.createObjectURL(E))),d=new Worker(o),d.onerror=E=>{let _=new Error(E.message);for(let c of s)c.reject(_)},d.addEventListener("message",E=>{let _=E.data?E.data:E;switch(_.type){case"log":k&&k(_.message);break;case"task":{let c=_.id,I=_.body;try{T[c](I),delete T[c]}catch(l){throw delete T[c],l}break}case"event":{let c=_.id,I=_.body;try{T[c](I)}catch(l){throw l}break}default:console.log(E)}}),a.bLog=!!k,a.bd=fe,a.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}let n=rt++;return T[n]=o=>{if(o.success){Object.assign(Y,o.versions),JSON.stringify(o.versions)!=="{}"&&(v._versions=o.versions);for(let E of s)E.resolve(void 0)}else{const E=Error(o.message);o.stack&&(E.stack=o.stack);for(let _ of s)_.reject(E)}},d.postMessage({type:"loadWasm",body:a,id:n}),s[0]};class v{static get engineResourcePaths(){return J}static set engineResourcePaths(t){Object.assign(C,t)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get onLog(){return k}static set onLog(t){Dt(t)}static get _bDebug(){return fe}static set _bDebug(t){ht(t)}static isModuleLoaded(t){return t=(t=t||"core").toLowerCase(),!!ce[t]&&ce[t].isFulfilled}static async loadWasm(t){return await B(t)}static async detectEnvironment(){return await(async()=>({wasm:ut,worker:Tt,getUserMedia:it,camera:await Ct(),browser:p.browser,version:p.version,OS:p.OS}))()}static async getModuleVersion(){return await new Promise((t,s)=>{let r=h();T[r]=async i=>{if(i.success)return t(i.versions);{let a=new Error(i.message);return a.stack=i.stack+`
`+a.stack,s(a)}},d.postMessage({type:"getModuleVersion",id:r})})}static getVersion(){const t=Y.core&&Y.core.worker,s=Y.core&&Y.core.wasm;return`3.0.32(Worker: ${t||"Not Loaded"}, Wasm: ${s||"Not Loaded"})`}static enableLogging(){}static disableLogging(){}static async cfd(t){return await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s();{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cfd",id:i,body:{count:t}})})}}var U,ye,Ue,Be,we,Pe,be,Ge,ke,Ve,xe;v._bSupportDce4Module=-1,v._bSupportIRTModule=-1,v._versions=null,v._workerName="core.worker.js",v.browserInfo=p,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(U||(U={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(ye||(ye={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",e[e.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",e[e.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",e[e.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",e[e.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",e[e.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",e[e.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",e[e.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",e[e.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",e[e.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",e[e.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",e[e.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",e[e.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",e[e.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",e[e.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",e[e.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",e[e.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",e[e.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",e[e.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",e[e.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",e[e.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",e[e.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",e[e.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",e[e.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Ue||(Ue={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV"}(Be||(Be={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV"}(we||(we={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(Pe||(Pe={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(be||(be={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(Ge||(Ge={})),function(e){e[e.IRUT_NULL=0]="IRUT_NULL",e[e.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",e[e.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",e[e.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",e[e.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",e[e.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",e[e.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",e[e.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",e[e.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",e[e.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",e[e.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",e[e.IRUT_CONTOURS=1024]="IRUT_CONTOURS",e[e.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",e[e.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",e[e.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",e[e.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",e[e.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",e[e.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",e[e.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",e[e.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",e[e.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",e[e.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",e[e.IRUT_CORNERS=2097152]="IRUT_CORNERS",e[e.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",e[e.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",e[e.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",e[e.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",e[e.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",e[e.IRUT_ALL=134217727]="IRUT_ALL"}(ke||(ke={})),function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(Ve||(Ve={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(xe||(xe={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.0.31"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */const He=e=>e&&typeof e=="object"&&typeof e.then=="function";let j=class extends Promise{constructor(t){let s,r;super((i,a)=>{s=i,r=a}),this._s="pending",this.resolve=i=>{this.isPending&&(He(i)?this.task=i:(this._s="fulfilled",s(i)))},this.reject=i=>{this.isPending&&(this._s="rejected",r(i))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let s;this._task=t,He(t)?s=t:typeof t=="function"&&(s=new Promise(t)),s&&(async()=>{try{const r=await s;t===this._task&&this.resolve(r)}catch(r){t===this._task&&this.reject(r)}})()}get isEmpty(){return this._task==null}},gt=class{constructor(){this.intermediateResultReceiverSet=new Set}addResultReceiver(t){if(typeof t!="object")throw new Error("Invalid receiver.");this.intermediateResultReceiverSet.add(t)}removeResultReceiver(t){this.intermediateResultReceiverSet.delete(t)}};var St={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1};const nt=typeof self>"u",pe=(()=>{if(!nt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),at=e=>{if(e==null&&(e="./"),!nt){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var Ae;C.cvr==null&&(C.cvr=pe),q.cvr={js:!0,wasm:!0},P.cvr={};const De="1.0.0";C.std.version&&ee(C.std.version,De)<0&&(C.std.version=De,C.std.path=at(pe+`../../dynamsoft-capture-vision-std@${De}/dist/`));const he="2.0.30";C.dip.version&&ee(C.dip.version,he)<0&&(C.dip.version=he,C.dip.path=at(pe+`../../dynamsoft-image-processing@${he}/dist/`));var le,Ye,Oe,G;async function je(e,t){return await new Promise((s,r)=>{let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType=t,i.send(),i.onloadend=async()=>{s(i.response)},i.onerror=()=>{r(new Error("Network Error: "+i.statusText))}})}`${(Ae=Y.cvr)===null||Ae===void 0?void 0:Ae.worker}`,function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(le||(le={})),function(e){e[e.IRUT_NULL=0]="IRUT_NULL",e[e.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",e[e.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",e[e.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",e[e.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",e[e.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",e[e.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",e[e.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",e[e.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",e[e.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",e[e.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",e[e.IRUT_CONTOURS=1024]="IRUT_CONTOURS",e[e.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",e[e.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",e[e.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",e[e.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",e[e.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",e[e.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",e[e.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",e[e.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",e[e.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",e[e.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",e[e.IRUT_CORNERS=2097152]="IRUT_CORNERS",e[e.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",e[e.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",e[e.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",e[e.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",e[e.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",e[e.IRUT_ALL=134217727]="IRUT_ALL"}(Ye||(Ye={})),function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Oe||(Oe={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12"}(G||(G={}));const Q=Oe;function Xe(e){const t={barcodeResultItems:[],textLineResultItems:[],quadsResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return e.items.forEach(s=>{s.type===Q.CRIT_BARCODE?t.barcodeResultItems.push(s):s.type===Q.CRIT_TEXT_LINE?t.textLineResultItems.push(s):s.type===Q.CRIT_DETECTED_QUAD?t.quadsResultItems.push(s):s.type===Q.CRIT_NORMALIZED_IMAGE?t.normalizedImageResultItems.push(s):s.type===Q.CRIT_PARSED_RESULT&&t.parsedResultItems.push(s)}),t}function mt(e){let t,s=e.bytes;if(!(s&&s instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===G.IPF_BGR_888){const r=s.length/3;t=new Uint8ClampedArray(4*r);for(let i=0;i<r;++i)t[4*i]=s[3*i],t[4*i+1]=s[3*i+1],t[4*i+2]=s[3*i+2],t[4*i+3]=255}else if(Number(e.format)===G.IPF_RGB_888){const r=s.length/3;t=new Uint8ClampedArray(4*r);for(let i=0;i<r;++i)t[4*i]=s[3*i+2],t[4*i+1]=s[3*i+1],t[4*i+2]=s[3*i],t[4*i+3]=255}else if(Number(e.format)===G.IPF_GRAYSCALED){const r=s.length;t=new Uint8ClampedArray(4*r);for(let i=0;i<r;i++)t[4*i]=t[4*i+1]=t[4*i+2]=s[i],t[4*i+3]=255}else if(Number(e.format)===G.IPF_BINARY_8){const r=s.length,i=e.width,a=e.height,n=e.stride;t=new Uint8ClampedArray(i*a*4);for(let o=0;o<r;o++){let E=s[o],_=o%n,c=Math.floor(o/n);for(let I=0;I<8;I++){let l=_+I,D=4*(c*i+l);if(l>=i)break;t[D]=t[D+1]=t[D+2]=(128&E)/128*255,t[D+3]=255,E<<=1}}}else if(Number(e.format)===G.IPF_ABGR_8888){const r=s.length/4;t=new Uint8ClampedArray(s.length);for(let i=0;i<r;++i)t[4*i]=s[4*i],t[4*i+1]=s[4*i+1],t[4*i+2]=s[4*i+2],t[4*i+3]=s[4*i+3]}else if(Number(e.format)===G.IPF_ARGB_8888){const r=s.length/4;t=new Uint8ClampedArray(s.length);for(let i=0;i<r;++i)t[4*i]=s[4*i],t[4*i+1]=s[4*i+1],t[4*i+2]=s[4*i+2],t[4*i+3]=s[4*i+3]}return new ImageData(t,e.width,e.height)}function Ot(e,t){let s=e;s.toCanvas=()=>Ne(t),s.toImage=r=>function(i,a){const n=Ne(a);let o=new Image,E=n.toDataURL(i);return o.src=E,o}(r,t),s.toBlob=r=>Ze(r,t),s.saveToFile=async(r,i)=>{if(!r)return null;if(typeof r!="string")throw new TypeError("FileName must be of type string.");return async function(a,n,o){return await new Promise(async(E,_)=>{try{const c=n.split(".");let I=c[c.length-1];const l=await Ze(`image/${I}`,a);c.length<=1&&(I="png");const D=new File([l],n,{type:`image/${I}`});if(o){const g=URL.createObjectURL(D),R=document.createElement("a");R.href=g,R.download=n,R.click()}return E(D)}catch{return _()}})}(t,r,i)}}function Ne(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t}async function Ze(e,t){const s=Ne(t);return new Promise((r,i)=>{s.toBlob(a=>r(a),e)})}const Nt=typeof BigInt=="function";class u{constructor(){this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(v.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=St,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get maxCvsSideLength(){return this._maxCvsSideLength}set maxCvsSideLength(t){this._maxCvsSideLength=t}get isa(){return this._isa}set isa(t){this._isa=t}get disposed(){return this.bDestroyed}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}static async createInstance(){if(!P.license)throw Error("Module `license` is not existed.");await P.license.dynamsoft(),await B(["dip","cvr"]);const t=new u,s=new j;let r=h();return T[r]=async i=>{var a;if(i.success)t._instanceID=i.instanceID,t._currentSettings=await t.outputSettings("*"),`${(a=Y.cvr)===null||a===void 0?void 0:a.worker}${i.version}`,v.bSupportDce4Module===0&&(t._intermediateResultManager=t.getIntermediateResultManager(!0)),s.resolve(t);else{const n=Error(i.message);i.stack&&(n.stack=i.stack),s.reject(n)}},d.postMessage({type:"cvr_createInstance",id:r}),s}async _singleFrameModeCallback(t){this.isa.getCameraView().setScanLaserVisible(!0);for(let n of this._resultReceiverSet)this._bNeedOutputOriginalImage&&n.onOriginalImageResultReceived&&n.onOriginalImageResultReceived({imageData:t});const s={bytes:new Uint8Array(t.bytes),width:t.width,height:t.height,stride:t.stride,format:t.format,tag:t.tag},r=await this.capture(s,this._templateName,!0);r.originalImageTag=t.tag;for(let n of this._resultReceiverSet)n.isDce&&n.onCapturedResultReceived(r,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const i={originalImageHashId:r.originalImageHashId,originalImageTag:r.originalImageTag,errorCode:r.errorCode,errorString:r.errorString},a=Xe(r);for(let n of this._resultReceiverSet)if(n.onDecodedBarcodesReceived&&a.barcodeResultItems.length&&n.onDecodedBarcodesReceived(Object.assign(Object.assign({},i),{barcodeResultItems:a.barcodeResultItems})),n.onRecognizedTextLinesReceived&&a.textLineResultItems.length&&n.onRecognizedTextLinesReceived(Object.assign(Object.assign({},i),{textLineResultItems:a.textLineResultItems})),n.onDetectedQuadsReceived&&a.quadsResultItems.length&&n.onDetectedQuadsReceived(Object.assign(Object.assign({},i),{quadsResultItems:a.quadsResultItems})),n.onNormalizedImagesReceived&&a.normalizedImageResultItems.length&&n.onNormalizedImagesReceived(Object.assign(Object.assign({},i),{normalizedImageResultItems:a.normalizedImageResultItems})),n.onParsedResultsReceived&&a.parsedResultItems.length&&n.onParsedResultsReceived(Object.assign(Object.assign({},i),{parsedResultItems:a.parsedResultItems})),n.onCapturedResultReceived&&!n.isDce){if(this._bNeedOutputOriginalImage){const o=r.items.findIndex(E=>E.type===1);o!==-1&&(r.items[o].imageData=t)}n.onCapturedResultReceived(r)}}setInput(t){if(this._checkIsDisposed(),t){if(this.isa=t,t.isCameraEnhancer){this._intermediateResultManager&&(this.isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this.isa._intermediateResultReceiver));const s=this.isa.getCameraView();if(s){const r=s._capturedResultReceiver;r.isDce=!0,this._resultReceiverSet.add(r)}}}else this.isa=null}getInput(){return this._isa}addImageSourceStateListener(t){if(this._checkIsDisposed(),typeof t!="object")return console.warn("Invalid ISA state listener.");t&&Object.keys(t)&&this._isaStateListenerSet.add(t)}removeImageSourceStateListener(t){return this._checkIsDisposed(),this._isaStateListenerSet.delete(t)}addResultReceiver(t){if(this._checkIsDisposed(),typeof t!="object")throw new Error("Invalid receiver.");t&&Object.keys(t).length&&(this._resultReceiverSet.add(t),this._setCrrRegistry())}removeResultReceiver(t){this._checkIsDisposed(),this._resultReceiverSet.delete(t),this._setCrrRegistry()}async _setCrrRegistry(){const t={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let i of this._resultReceiverSet)i.isDce||(t.onCapturedResultReceived=!!i.onCapturedResultReceived,t.onDecodedBarcodesReceived=!!i.onDecodedBarcodesReceived,t.onRecognizedTextLinesReceived=!!i.onRecognizedTextLinesReceived,t.onDetectedQuadsReceived=!!i.onDetectedQuadsReceived,t.onNormalizedImagesReceived=!!i.onNormalizedImagesReceived,t.onParsedResultsReceived=!!i.onParsedResultsReceived);const s=new j;let r=h();return T[r]=async i=>{if(i.success)s.resolve();else{let a=new Error(i.message);a.stack=i.stack+`
`+a.stack,s.reject()}},d.postMessage({type:"cvr_setCrrRegistry",id:r,instanceID:this._instanceID,body:{receiver:JSON.stringify(t)}}),s}async addResultFilter(t){if(this._checkIsDisposed(),typeof t!="object")return console.warn("Invalid filter.");if(t&&Object.keys(t)){this._resultFilterSet.add(t),this._handleFilterSwitch();for(let s of this._resultFilterSet)await this._enableResultCrossVerification(s.verificationEnabled),await this._enableResultDeduplication(s.duplicateFilterEnabled),await this._setDuplicateForgetTime(s.duplicateForgetTime)}}async removeResultFilter(t){this._checkIsDisposed(),this._resultFilterSet.delete(t),this._handleFilterSwitch();for(let s of this._resultFilterSet)await this._enableResultCrossVerification(s.verificationEnabled),await this._enableResultDeduplication(s.duplicateFilterEnabled),await this._setDuplicateForgetTime(s.duplicateForgetTime)}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let t of this._resultFilterSet)t.isResultCrossVerificationEnabled(U.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),t.isResultCrossVerificationEnabled(U.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),t.isResultCrossVerificationEnabled(U.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),t.isResultCrossVerificationEnabled(U.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}async startCapturing(t="Default"){if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this.isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const s=await this.containsTask(t);return await B(s),this.isa.isCameraEnhancer&&(s.includes("ddn")?this.isa.setPixelFormat(oe.IPF_ABGR_8888):this.isa.setPixelFormat(oe.IPF_GRAYSCALED)),this.isa.singleFrameMode!==void 0&&this.isa.singleFrameMode!=="disabled"?(this._templateName=t,void this.isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind)):(this.isa.getColourChannelUsageType()===X.CCUT_AUTO&&this.isa.setColourChannelUsageType(s.includes("ddn")?X.CCUT_FULL_CHANNEL:X.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new j((r,i)=>{if(this.disposed)return;let a=h();T[a]=async n=>{if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!n.success){let o=new Error(n.message);return o.stack=n.stack+`
`+o.stack,i(o)}for(let o of this._resultFilterSet)await this.addResultFilter(o);this._bPauseScan=!1,this._bNeedOutputOriginalImage=n.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&this.isa.startFetching(),this._loopReadVideo(t),r()},0),this.isa.isCameraEnhancer&&this.isa.getCameraView().setScanLaserVisible(!0)}},d.postMessage({type:"cvr_startCapturing",id:a,instanceID:this._instanceID,body:{templateName:t}})}),await this._promiseStartScan))}stopCapturing(){this._checkIsDisposed(),this.isa&&(this.isa.isCameraEnhancer&&(this.isa.getCameraView().setScanLaserVisible(!1),this.isa.singleFrameMode!==void 0&&this.isa.singleFrameMode!=="disabled")?this.isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this.isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this.isa.setColourChannelUsageType(X.CCUT_AUTO)))}async _clearVerifyList(){let t=h();const s=new j;return T[t]=async r=>{if(r.success)return s.resolve();{let i=new Error(r.message);return i.stack=r.stack+`
`+i.stack,s.reject(i)}},d.postMessage({type:"cvr_clearVerifyList",id:t,instanceID:this._instanceID}),s}async _getIntermediateResult(){this._checkIsDisposed();let t=h();const s=new j;return T[t]=async r=>{if(r.success)s.resolve(r.result);else{let i=new Error(r.message);i.stack=r.stack+`
`+i.stack,s.reject(i)}},d.postMessage({type:"cvr_getIntermediateResult",id:t,instanceID:this._instanceID}),s}async containsTask(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s(JSON.parse(a.tasks));{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_containsTask",id:i,instanceID:this._instanceID,body:{templateName:t}})})}async _loopReadVideo(t){if(this.disposed||this._bPauseScan)return;if(this.isa.isBufferEmpty()){if(this.isa.hasNextImageToFetch())for(let i of this._isaStateListenerSet)i.onImageSourceStateReceived&&i.onImageSourceStateReceived(le.ISS_BUFFER_EMPTY);else if(!this.isa.hasNextImageToFetch())for(let i of this._isaStateListenerSet)i.onImageSourceStateReceived&&i.onImageSourceStateReceived(le.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||this.isa.isBufferEmpty())try{this.isa.isBufferEmpty()&&u._onLog&&u._onLog("buffer is empty so fetch image"),u._onLog&&u._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=this.isa.fetchImage(),u._onLog&&u._onLog(`DCE: finish fetching a frame: ${Date.now()}`),this.isa.setImageFetchInterval(this._averageTime)}catch{return void this._reRunCurrnetFunc(t)}else if(this.isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this.isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(t);if(!this._dsImage)return void this._reRunCurrnetFunc(t);for(let i of this._resultReceiverSet)this._bNeedOutputOriginalImage&&i.onOriginalImageResultReceived&&i.onOriginalImageResultReceived({imageData:this._dsImage});const s=Date.now();let r=null;this._captureDsimage(this._dsImage,t,!0).then(async i=>{if(u._onLog&&u._onLog("no js handle time: "+(Date.now()-s)),r=i,this._bPauseScan)return void this._reRunCurrnetFunc(t);const a=Date.now(),n=r.intermediateResult;if(n){if(n.taskSet)for(let c of n.taskSet.intermediateResultUnits)c.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let c of this._intermediateResultReceiverSet){if(n.taskSet&&c.onTaskResultsReceived&&c.onTaskResultsReceived({intermediateResultUnits:n.taskSet.intermediateResultUnits},n.taskSet.info),n.sectionSet)for(let I in n.sectionSet){for(let l of n.sectionSet[I].asStage)c[I]&&c[I](l.result,l.info);for(let l of n.sectionSet[I].asSection)c[I]&&c[I](l.result,l.info)}if(n.stageSet)for(let I in n.stageSet)for(let l of n.stageSet[I])c[I]&&c[I](l.result,l.info)}}r.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let c of this._resultReceiverSet)if(c.isDce){const I=Date.now();if(c.onCapturedResultReceived(r,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),u._onLog){const l=Date.now()-I;l>10&&u._onLog(`draw result time: ${l}`)}}for(let c of this._resultFilterSet)c.onDecodedBarcodesReceived(r.items),c.onRecognizedTextLinesReceived(r.items),c.onDetectedQuadsReceived(r.items),c.onNormalizedImagesReceived(r.items);const o=Xe(r),E={originalImageHashId:r.originalImageHashId,originalImageTag:r.originalImageTag,errorCode:r.errorCode,errorString:r.errorString};for(let c of this._resultReceiverSet)c.onDecodedBarcodesReceived&&o.barcodeResultItems.length&&c.onDecodedBarcodesReceived(Object.assign(Object.assign({},E),{barcodeResultItems:o.barcodeResultItems.filter(I=>!I.isFilter)})),c.onRecognizedTextLinesReceived&&o.textLineResultItems.length&&c.onRecognizedTextLinesReceived(Object.assign(Object.assign({},E),{textLineResultItems:o.textLineResultItems.filter(I=>!I.isFilter)})),c.onDetectedQuadsReceived&&o.quadsResultItems.length&&c.onDetectedQuadsReceived(Object.assign(Object.assign({},E),{quadsResultItems:o.quadsResultItems.filter(I=>!I.isFilter)})),c.onNormalizedImagesReceived&&o.normalizedImageResultItems.length&&c.onNormalizedImagesReceived(Object.assign(Object.assign({},E),{normalizedImageResultItems:o.normalizedImageResultItems.filter(I=>!I.isFilter)})),c.onParsedResultsReceived&&o.parsedResultItems.length&&c.onParsedResultsReceived(Object.assign(Object.assign({},E),{parsedResultItems:o.parsedResultItems.filter(I=>!I.isFilter)})),c.onCapturedResultReceived&&!c.isDce&&(r.items=r.items.filter(I=>!I.isFilter),c.onCapturedResultReceived(r));if(u._onLog){const c=Date.now()-a;c>10&&u._onLog(`callback dispatch time: ${c}`)}const _=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-s),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,u._onLog&&(u._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),u._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),u._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),u._onLog(`averageTime: ${this._averageTime}`))),u._onLog){const c=Date.now()-_;c>10&&u._onLog(`fetch image calculate time: ${c}`)}u._onLog&&u._onLog(`time finish decode: ${Date.now()}`),u._onLog&&u._onLog("main time: "+(Date.now()-s)),u._onLog&&u._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,0))}).catch(i=>{this.isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.isa.startFetching(),this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,1e3)),i.message!=="platform error"&&setTimeout(()=>{throw i},0)}).finally(()=>{r&&r.intermediateResult&&delete r.intermediateResult})}_reRunCurrnetFunc(t){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},0)}async capture(t,s="Default",r=!1){this._checkIsDisposed();const i=await this.containsTask(s);let a;if(await B(i),(n=t)&&typeof n=="object"&&!Array.isArray(n)&&"bytes"in n&&"width"in n&&"height"in n&&"stride"in n&&"format"in n)a=await this._captureDsimage(t,s,r);else if(typeof t=="string")a=t.substring(0,11)=="data:image/"?await this._captureBase64(t,s,r):await this._captureUrl(t,s,r);else if(t instanceof Blob)a=await this._captureBlob(t,s,r);else if(t instanceof HTMLImageElement)a=await this._captureImage(t,s,r);else if(t instanceof HTMLCanvasElement)a=await this._captureCanvas(t,s,r);else if(t instanceof HTMLVideoElement)a=await this._captureVideo(t,s,r);else{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||t instanceof Uint8ClampedArray))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'Uint8Array', 'ArrayBuffer', 'Uint8ClampedArray', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");a=await this._captureBlob(new Blob([new Uint8Array(t)],{type:"image/png"}),s,r)}var n;const o=await this._getIntermediateResult();if(o)for(let E of this._intermediateResultReceiverSet){if(o.taskSet&&E.onTaskResultsReceived&&E.onTaskResultsReceived({intermediateResultUnits:o.taskSet.intermediateResultUnits},o.taskSet.info),o.sectionSet)for(let _ in o.sectionSet){for(let c of o.sectionSet[_].asStage)E[_]&&E[_](c.result,c.info);for(let c of o.sectionSet[_].asSection)E[_]&&E[_](c.result,c.info)}if(o.stageSet)for(let _ in o.stageSet)for(let c of o.stageSet[_])E[_]&&E[_](c.result,c.info)}return a}async _captureDsimage(t,s,r=!1){return await this._captureInWorker(t,s,r)}async _captureUrl(t,s,r=!1){let i=await je(t,"blob");return await this._captureBlob(i,s,r)}async _captureBase64(t,s,r=!1){t=t.substring(t.indexOf(",")+1);let i=atob(t),a=i.length,n=new Uint8Array(a);for(;a--;)n[a]=i.charCodeAt(a);return await this._captureBlob(new Blob([n]),s,r)}async _captureBlob(t,s,r=!1){let i=null,a=null;if(typeof createImageBitmap<"u")try{i=await createImageBitmap(t)}catch{}i||(a=await async function(o){return await new Promise((E,_)=>{let c=URL.createObjectURL(o),I=new Image;I.src=c,I.onload=()=>{URL.revokeObjectURL(I.dbrObjUrl),E(I)},I.onerror=l=>{_(new Error("Can't convert blob to image : "+(l instanceof Event?l.type:l)))}})}(t));let n=await this._captureImage(i||a,s,r);return i&&i.close(),n}async _captureImage(t,s,r=!1){let i,a,n=t instanceof HTMLImageElement?t.naturalWidth:t.width,o=t instanceof HTMLImageElement?t.naturalHeight:t.height,E=Math.max(n,o);if(E>this.maxCvsSideLength){let c=this.maxCvsSideLength/E;i=Math.round(n*c),a=Math.round(o*c)}else i=n,a=o;this._canvas||(this._canvas=document.createElement("canvas"));const _=this._canvas;return _.width===i&&_.height===a||(_.width=i,_.height=a),_.ctx2d||(_.ctx2d=_.getContext("2d",{willReadFrequently:!0})),_.ctx2d.drawImage(t,0,0,n,o,0,0,i,a),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),await this._captureCanvas(_,s,r)}async _captureCanvas(t,s,r=!1){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";if([t.width,t.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=t.ctx2d||t.getContext("2d",{willReadFrequently:!0}),a={bytes:Uint8Array.from(i.getImageData(0,0,t.width,t.height).data),width:t.width,height:t.height,stride:4*t.width,format:10};return await this._captureInWorker(a,s,r)}async _captureVideo(t,s,r=!1){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";let i,a,n=t.videoWidth,o=t.videoHeight,E=Math.max(n,o);if(E>this._maxCvsSideLength){let c=this._maxCvsSideLength/E;i=Math.round(n*c),a=Math.round(o*c)}else i=n,a=o;this._canvas||(this._canvas=document.createElement("canvas"));const _=this._canvas;return _.width===i&&_.height===a||(_.width=i,_.height=a),_.ctx2d||(_.ctx2d=_.getContext("2d",{willReadFrequently:!0})),_.ctx2d.drawImage(t,0,0,n,o,0,0,i,a),await this._captureCanvas(_,s,r)}async _captureInWorker(t,s,r=!1){const{bytes:i,width:a,height:n,stride:o,format:E}=t;let _=h();const c=new j;return T[_]=async I=>{var l;if(!I.success){let D=new Error(I.message);return D.stack=I.stack+`
`+D.stack,c.reject(D)}{const D=Date.now();u._onLog&&(u._onLog(`get result time from worker: ${D}`),u._onLog("worker to main time consume: "+(D-I.workerReturnMsgTime)));try{const g=I.captureResult;t.bytes=I.bytes;for(let R=0;R<g.items.length;R++)if(g.items[R].type===U.CRIT_NORMALIZED_IMAGE){const M=mt(g.items[R].imageData);Ot(g.items[R],M)}else g.items[R].type===U.CRIT_ORIGINAL_IMAGE?g.items[R].imageData=t:g.items[R].type===U.CRIT_PARSED_RESULT&&((l=P.dcp)===null||l===void 0||l.handleParsedResultItem(g.items[R]));return c.resolve(g)}catch(g){return c.reject(g)}}},u._onLog&&u._onLog(`send buffer to worker: ${Date.now()}`),d.postMessage({type:"cvr_capture",id:_,instanceID:this._instanceID,body:{bytes:i,width:a,height:n,stride:o,format:E,templateName:s||"",bScanner:r}},[i.buffer]),c}async initSettings(t){return this._checkIsDisposed(),t&&["string","object"].includes(typeof t)?(typeof t=="string"&&(/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(t)&&(t=await je(t,"text")),this._currentSettings=JSON.parse(t)),typeof t=="object"&&(this._currentSettings=t,t=JSON.stringify(t)),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success){const n=JSON.parse(a.response);if(n.exception!==0){let _=new Error(n.description?n.description:"Init Settings Failed.");return _.errorCode=n.exception,r(_)}let o=[],E=JSON.parse(t).CaptureVisionTemplates;for(let _=0;_<E.length;_++){let c=await this.containsTask(E[_].Name);o=o.concat(c)}return await B([...new Set(o)]),this._bNeedOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,s(n)}{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_initSettings",id:i,instanceID:this._instanceID,body:{settings:t}})})):console.error("Invalid template.")}async outputSettings(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success){const n=JSON.parse(a.settings);if(n.errorCode!==0){let o=new Error(n.errorString);return o.errorCode=n.errorCode,r(o)}return delete n.errorCode,delete n.errorString,s(n)}{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_outputSettings",id:i,instanceID:this._instanceID,body:{templateName:t||"Default"}})})}async outputSettingsToFile(t,s,r){const i=await this.outputSettings(t),a=new Blob([JSON.stringify(i,null,2,function(n,o){return o instanceof Array?JSON.stringify(o):o},2)],{type:"application/json"});if(r){const n=document.createElement("a");n.href=URL.createObjectURL(a),s.endsWith(".json")&&(s=s.replace(".json","")),n.download=`${s}.json`,n.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(n.href)},500)},n.click()}return a}async getSimplifiedSettings(t="Default"){this._checkIsDisposed();const s=await this.containsTask(t);return await B(s),await new Promise((r,i)=>{let a=h();T[a]=async n=>{if(n.success){const o=JSON.parse(n.settings,(E,_)=>Nt&&E==="barcodeFormatIds"?BigInt(_):_);if(o.minImageCaptureInterval=this._minImageCaptureInterval,o.code!==0){let E=new Error(o.codeString);return E.errorCode=o.errorCode,i(E)}return delete o.code,delete o.codeString,r(o)}{let o=new Error(n.message);return o.stack=n.stack+`
`+o.stack,i(o)}},d.postMessage({type:"cvr_getSimplifiedSettings",id:a,instanceID:this._instanceID,body:{templateName:t}})})}async updateSettings(t,s){this._checkIsDisposed();const r=await this.containsTask(t);return await B(r),await new Promise((i,a)=>{let n=h();T[n]=async o=>{if(o.success){const E=JSON.parse(o.response);if(s.minImageCaptureInterval&&s.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=s.minImageCaptureInterval),this._bNeedOutputOriginalImage=o.bNeedOutputOriginalImage,E.exception!==0){let _=new Error(E.description?E.description:"Update Settings Failed.");return _.errorCode=E.exception,a(_)}return this._currentSettings=await this.outputSettings("*"),i(E)}{let E=new Error(o.message);return E.stack=o.stack+`
`+E.stack,a(E)}},d.postMessage({type:"cvr_updateSettings",id:n,instanceID:this._instanceID,body:{settings:s,templateName:t}})})}async resetSettings(){return this._checkIsDisposed(),await new Promise((t,s)=>{let r=h();T[r]=async i=>{if(i.success){const a=JSON.parse(i.response);if(a.exception!==0){let n=new Error(a.description?a.description:"Reset Settings Failed.");return n.errorCode=a.exception,s(n)}return this._currentSettings=await this.outputSettings("*"),t(a)}{let a=new Error(i.message);return a.stack=i.stack+`
`+a.stack,s(a)}},d.postMessage({type:"cvr_resetSettings",id:r,instanceID:this._instanceID})})}getIntermediateResultManager(t){if(this._checkIsDisposed(),!t&&v.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new gt,this._intermediateResultManager.addResultReceiver=async s=>{if(typeof s!="object")throw new Error("Invalid receiver.");return this._intermediateResultReceiverSet.add(s),this._handleIntermediateResultReceiver(),await(async()=>await new Promise((r,i)=>{let a=h();T[a]=async n=>{if(n.success)return r();{let o=new Error(n.message);return o.stack=n.stack+`
`+o.stack,i(o)}},d.postMessage({type:"cvr_setIrrRegistry",id:a,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})}))()},this._intermediateResultManager.removeResultReceiver=async s=>(this._intermediateResultReceiverSet.delete(s),this._handleIntermediateResultReceiver(),await new Promise((r,i)=>{let a=h();T[a]=async n=>{if(n.success)return r();{let o=new Error(n.message);return o.stack=n.stack+`
`+o.stack,i(o)}},d.postMessage({type:"cvr_setIrrRegistry",id:a,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})})),this._intermediateResultManager.getOriginalImage=async s=>this._dsImage),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let t in this._irrRegistryState)this._irrRegistryState[t]=!1;for(let t of this._intermediateResultReceiverSet)if(t.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let s in t)this._irrRegistryState[s]||(this._irrRegistryState[s]=!!t[s])}async _enableResultCrossVerification(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s(a.result);{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_enableResultCrossVerification",id:i,instanceID:this._instanceID,body:{verificationEnabled:t}})})}async _enableResultDeduplication(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s(a.result);{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_enableResultDeduplication",id:i,instanceID:this._instanceID,body:{duplicateFilterEnabled:t}})})}async _setDuplicateForgetTime(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s(a.result);{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_setDuplicateForgetTime",id:i,instanceID:this._instanceID,body:{duplicateForgetTime:t}})})}async _getDuplicateForgetTime(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s(a.time);{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_getDuplicateForgetTime",id:i,instanceID:this._instanceID,body:{type:t}})})}async parseRequiredResources(t){return this._checkIsDisposed(),await new Promise((s,r)=>{let i=h();T[i]=async a=>{if(a.success)return s(JSON.parse(a.resources));{let n=new Error(a.message);return n.stack=a.stack+`
`+n.stack,r(n)}},d.postMessage({type:"cvr_parseRequiredResources",id:i,instanceID:this._instanceID,body:{templateName:t}})})}async _setThresholdValue(t,s,r){return await new Promise((i,a)=>{let n=h();T[n]=async o=>{if(o.success)return i();{let E=new Error(o.message);return E.stack=o.stack+`
`+E.stack,a(E)}},d.postMessage({type:"cvr_setThresholdValue",id:n,instanceID:this._instanceID,body:{threshold:t,leftLimit:s,rightLimit:r}})})}contains(t,s){return function(r,i){let a=i.x,n=i.y,o=r[0].x,E=r[0].y,_=r[1].x,c=r[1].y,I=r[2].x,l=r[2].y,D=r[3].x,g=r[3].y,R=L(a,n,o,E,_,c),M=L(a,n,_,c,I,l),F=L(a,n,I,l,D,g),O=L(a,n,D,g,o,E);function L(b,N,f,W,te,x){return(b-f)*(x-W)-(N-W)*(te-f)}return R>=0&&M>=0&&F>=0&&O>=0||R<=0&&M<=0&&F<=0&&O<=0}(t,s)}async dispose(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this.isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let t=h();T[t]=s=>{if(!s.success){let r=new Error(s.message);throw r.stack=s.stack+`
`+r.stack,r}},d.postMessage({type:"cvr_dispose",id:t,instanceID:this._instanceID})}}/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.0.40
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const V=typeof self>"u",We=V?{}:self,$e=(()=>{if(!V&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),Qe=e=>e&&typeof e=="object"&&typeof e.then=="function",Re=" is not allowed to change after `createInstance` or `loadWasm` is called.",Lt=!V&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",ze=(e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`license`"+Re);s._license=t};!V&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const ot=e=>{if(e==null)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!V){let s=document.createElement("a");s.href=e[t],e[t]=s.href}e[t].endsWith("/")||(e[t]+="/")}}return e},Ke=(e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`licenseServer`"+Re);s._licenseServer=ot(t)},Je=(e,t)=>{const s=e;if(!s._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Re);s._deviceFriendlyName=t||""};let z,K,re,ge,y,Le,Z;typeof navigator<"u"&&(z=navigator,K=z.userAgent,re=z.platform,ge=z.mediaDevices),function(){if(!V){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:z.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:re,search:"Win"},Mac:{str:re},Linux:{str:re}};let s="unknownBrowser",r=0,i="unknownOS";for(let a in e){const n=e[a]||{};let o=n.str||K,E=n.search||a,_=n.verStr||K,c=n.verSearch||a;if(c instanceof Array||(c=[c]),o.indexOf(E)!=-1){s=a;for(let I of c){let l=_.indexOf(I);if(l!=-1){r=parseFloat(_.substring(l+I.length+1));break}}break}}for(let a in t){const n=t[a]||{};let o=n.str||K,E=n.search||a;if(o.indexOf(E)!=-1){i=a;break}}i=="Linux"&&K.indexOf("Windows NT")!=-1&&(i="HarmonyOS"),y={browser:s,version:r,OS:i}}V&&(y={browser:"ssr",version:0,OS:"ssr"})}(),ge&&ge.getUserMedia,y.browser==="Chrome"&&y.version>66||y.browser==="Safari"&&y.version>13||y.browser==="OPR"&&y.version>43||y.browser==="Edge"&&y.version;const Et=async()=>{await B("license");const{p:e,justWait:t}=Ie("dynamsoft_inited");if(t)return e;try{let{lt:s,l:r,ls:i,sp:a,rmk:n,cv:o}=((_,c=!1)=>{const I=_;if(I._pLoad.isEmpty){let l,D,g,R=I._license||"",M=JSON.parse(JSON.stringify(I._licenseServer)),F=I._sessionPassword,O=0;if(R.startsWith("t")||R.startsWith("f"))O=0;else if(R.length===0||R.startsWith("P")||R.startsWith("L")||R.startsWith("Y")||R.startsWith("A"))O=1;else{O=2;const L=R.indexOf(":");L!=-1&&(R=R.substring(L+1));const b=R.indexOf("?");if(b!=-1&&(D=R.substring(b+1),R=R.substring(0,b)),R.startsWith("DLC2"))O=0;else{if(R.startsWith("DLS2")){let N;try{let f=R.substring(4);f=atob(f),N=JSON.parse(f)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(R=N.handshakeCode?N.handshakeCode:N.organizationID?N.organizationID:"",typeof R=="number"&&(R=JSON.stringify(R)),M.length===0){let f=[];N.mainServerURL&&(f[0]=N.mainServerURL),N.standbyServerURL&&(f[1]=N.standbyServerURL),M=ot(f)}!F&&N.sessionPassword&&(F=N.sessionPassword),l=N.remark}(R==="200001"||R.startsWith("200001-"))&&(M&&M.length||(R="")),R||(O=1)}}if(O&&(c||(We.crypto||(g="Please upgrade your browser to support online key."),We.crypto.subtle||(g="Require https to use online key in this browser."))),g){if(O!==1)throw new Error(g);O=0,console.warn(g),I._lastErrorCode=-1,I._lastErrorString=g}return O===1&&(R="",console.warn("Applying for a public trial license ...")),{lt:O,l:R,ls:M,sp:F,rmk:l,cv:D}}throw new Error("Can't preprocess license again"+Re)})(S);S._pLoad.task=e;let E=h();return T[E]=_=>{if(_.message&&S._onAuthMessage){let I=S._onAuthMessage(_.message);I!=null&&(_.message=I)}let c=!1;if(s===1&&(c=!0),_.success?(k&&k("init license success"),_.message&&console.warn(_.message),v._bSupportIRTModule=_.bSupportIRTModule,v._bSupportDce4Module=_.bSupportDce4Module,S.bPassValidation=!0):(Z=Error(_.message),_.stack&&(Z.stack=_.stack),c||_.ltsErrorCode==111&&_.message.toLowerCase().indexOf("trial license")!=-1&&(c=!0)),c){let I=C.license;C.rootDirectory&&(I=C.rootDirectory+"/"+I),I=(l=>{if(l==null&&(l="./"),!V){let D=document.createElement("a");D.href=l,l=D.href}return l.endsWith("/")||(l+="/"),l})(I),(async(l,D,g)=>{if(!l._bNeverShowDialog)try{let R=await fetch(l.engineResourcePath+"dls.license.dialog.html");if(!R.ok)throw Error("Get license dialog fail. Network Error: "+R.statusText);let M=await R.text();if(!M.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let F=document.createElement("div");F.innerHTML=M;let O=[];for(let A=0;A<F.childElementCount;++A){let m=F.children[A];m instanceof HTMLStyleElement&&(O.push(m),document.head.append(m))}let L=F.childElementCount==1?F.children[0]:F;L.remove();let b,N,f,W,te,x=[L],It=L.children;for(let A of It)x.push(A);for(let A=0;A<x.length;++A)for(let m of x[A].children)x.push(m);for(let A of x)if(!b&&A.classList.contains("dls-license-mask"))b=A,A.addEventListener("click",m=>{if(A==m.target){L.remove();for(let H of O)H.remove()}});else if(!N&&A.classList.contains("dls-license-icon-close"))N=A,A.addEventListener("click",()=>{L.remove();for(let m of O)m.remove()});else if(!f&&A.classList.contains("dls-license-icon-error"))f=A,D!="error"&&A.remove();else if(!W&&A.classList.contains("dls-license-icon-warn"))W=A,D!="warn"&&A.remove();else if(!te&&A.classList.contains("dls-license-msg-content")){te=A;let m=g;for(;m;){let H=m.indexOf("["),de=m.indexOf("]",H),ue=m.indexOf("(",de),Te=m.indexOf(")",ue);if(H==-1||de==-1||ue==-1||Te==-1){A.appendChild(new Text(m));break}H>0&&A.appendChild(new Text(m.substring(0,H)));let se=document.createElement("a"),lt=m.substring(H+1,de);se.innerText=lt;let Rt=m.substring(ue+1,Te);se.setAttribute("href",Rt),se.setAttribute("target","_blank"),A.appendChild(se),m=m.substring(Te+1)}}document.body.appendChild(L)}catch(R){l._onLog&&l._onLog(R.message||R)}})({_bNeverShowDialog:S._bNeverShowDialog,engineResourcePath:I,_onLog:k},_.success?"warn":"error",_.message)}_.success?e.resolve(void 0):e.reject(Z)},r&&(r.startsWith("t")||r.startsWith("f"))&&(Le=r),d.postMessage({type:"dynamsoft",body:{v:"3.0.40",brtk:!!s,bptk:s===1,l:r,os:y,fn:S.deviceFriendlyName,ls:i,sp:a,rmk:n,cv:o},id:E}),S.bCallInitLicense=!0,e}catch(s){throw Z=s,e.reject(s),s}};P.license={},P.license.dynamsoft=Et,P.license.getAR=async()=>{if(Z)throw Z;return d?new Promise((e,t)=>{let s=h();T[s]=async r=>{if(r.success)if(delete r.success,Le&&(r.pk=Le),Object.keys(r).length){if(r.lem){let i=Error(r.lem);i.ltsErrorCode=r.lec,delete r.lem,delete r.lec,r.ae=i}e(r)}else e(null);else{let i=Error(r.message);r.stack&&(i.stack=r.stack),t(i)}},d.postMessage({type:"getAR",id:s})}):null};class S{static setLicenseServer(t){Ke(S,t)}static get license(){return this._license}static set license(t){ze(S,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){Ke(S,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){Je(S,t)}static initLicense(t,s){if(ze(S,t),S.bCallInitLicense=!0,s)return(async()=>{try{await Et()}catch(r){return{isSuccess:!1,error:r.message||r}}return{isSuccess:!0,error:"Successful."}})()}static setDeviceFriendlyName(t){Je(S,t)}static getDeviceFriendlyName(){return S._deviceFriendlyName}static getDeviceUUID(){return(async()=>{const{p:t,justWait:s}=Ie("license_uuid");if(s)return t;await B();let r=h();return T[r]=i=>{if(i.success)t.resolve(i.uuid);else{const a=Error(i.message);i.stack&&(a.stack=i.stack),t.reject(a)}},d.postMessage({type:"getDeviceUUID",id:r}),t})()}}if(S._pLoad=new class extends Promise{constructor(e){let t,s;super((r,i)=>{t=r,s=i}),this._s="pending",this.resolve=r=>{this.isPending&&(Qe(r)?this.task=r:(this._s="fulfilled",t(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",s(r))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let t;this._task=e,Qe(e)?t=e:typeof e=="function"&&(t=new Promise(e)),t&&(async()=>{try{const s=await t;e===this._task&&this.resolve(s)}catch(s){e===this._task&&this.reject(s)}})()}get isEmpty(){return this._task==null}},S.bPassValidation=!1,S.bCallInitLicense=!1,S._license=Lt,S._licenseServer=[],S._deviceFriendlyName="",C.license==null&&(C.license=$e),q.license={wasm:!0},P.license.LicenseManager=S,C.std.version&&ee(C.std.version,"1.0.0")<0){const e="1.0.0";C.std.version=e,C.std.path=$e+`../../dynamsoft-capture-vision-std@${e}/dist/`}/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.0.20
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const _t=typeof self>"u",ve=(()=>{if(!_t&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),ct=e=>{if(e==null&&(e="./"),!_t){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};C.dbr==null&&(C.dbr=ve),q.dbr={js:!1,wasm:!0},P.dbr={};const Se="1.0.0";C.std.version&&ee(C.std.version,Se)<0&&(C.std.version=Se,C.std.path=ct(ve+`../../dynamsoft-capture-vision-std@${Se}/dist/`));const me="2.0.30";C.dip.version&&ee(C.dip.version,me)<0&&(C.dip.version=me,C.dip.path=ct(ve+`../../dynamsoft-image-processing@${me}/dist/`));typeof BigInt=="function"&&(BigInt(0),BigInt(18446744073709552e3),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552));var qe,et,tt,st;(function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(qe||(qe={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(et||(et={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP"}(tt||(tt={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP"}(st||(st={}));class Ft extends dt{constructor(){super(...arguments),this.engineResourcePaths={core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.0.30/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.0.20/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.0.30/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.0.20/dist/",std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.0.0/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.0.30/dist/"}}async initLicense(t){try{let s=await S.initLicense(t.license);if(s&&!s.isSuccess&&s.error)throw s.error}catch(s){throw console.log(s),s}return{success:!0}}decodeBitmap(t){throw new Error("Method not implemented.")}async initialize(){try{v.engineResourcePaths=this.engineResourcePaths,await v.loadWasm(["cvr","dbr"]),this.cvr=await u.createInstance()}catch(t){throw t}return{success:!0}}async setEngineResourcePaths(t){this.engineResourcePaths=t.paths}async initRuntimeSettingsFromString(t){if(this.cvr)await this.cvr.initSettings(t.template);else throw new Error("DBR not initialized.")}async decode(t){var s;let r=[];if(this.cvr)if(this.cvr){let i=(s=t.template)!==null&&s!==void 0?s:"ReadBarcodes_Balance",a=await this.cvr.capture(t.source,i),n=[];for(let o=0;o<a.items.length;o++){const E=a.items[o];n.push(E)}for(let o=0;o<n.length;o++){const E=n[o],_={barcodeText:E.text,barcodeFormat:E.formatString,barcodeBytesBase64:this.arrayBufferToBase64(E.bytes),x1:E.location.points[0].x,y1:E.location.points[0].y,x2:E.location.points[1].x,y2:E.location.points[1].y,x3:E.location.points[2].x,y3:E.location.points[2].y,x4:E.location.points[3].x,y4:E.location.points[3].y};r.push(_)}}else throw new Error("DBR not initialized.");return{results:r}}arrayBufferToBase64(t){for(var s="",r=new Uint8Array(t),i=r.byteLength,a=0;a<i;a++)s+=String.fromCharCode(r[a]);return window.btoa(s)}}export{Ft as DBRWeb};
