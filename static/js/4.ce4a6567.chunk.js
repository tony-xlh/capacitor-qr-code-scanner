/*! For license information please see 4.ce4a6567.chunk.js.LICENSE.txt */
(this["webpackJsonpqr-code-scanner"]=this["webpackJsonpqr-code-scanner"]||[]).push([[4],{34:function(e,t,n){"use strict";n.r(t),n.d(t,"DBRWeb",(function(){return I}));var r=n(0),i=n.n(r),a=n(1),o=n(10),s=n(13),c=n(14),u=n(15),d=n(3),_=n(12),l=n(17),h=n(5);function f(e,t,n){return f="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(h.a)(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},f(e,t,n||e)}var g,v,m,E=n(16);function p(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(E.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}g="object"==typeof window?window:global,v=function(e,t,n,i,a){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t,n){var i,a,d,g;n.r(t),n.d(t,"DBR",(function(){return Z})),n.d(t,"BarcodeReader",(function(){return R})),n.d(t,"BarcodeScanner",(function(){return z})),n.d(t,"EnumBarcodeColourMode",(function(){return I})),n.d(t,"EnumBarcodeComplementMode",(function(){return A})),n.d(t,"EnumBarcodeFormat",(function(){return g})),n.d(t,"EnumBarcodeFormat_2",(function(){return b})),n.d(t,"EnumBinarizationMode",(function(){return S})),n.d(t,"EnumClarityCalculationMethod",(function(){return T})),n.d(t,"EnumClarityFilterMode",(function(){return D})),n.d(t,"EnumColourClusteringMode",(function(){return y})),n.d(t,"EnumColourConversionMode",(function(){return M})),n.d(t,"EnumConflictMode",(function(){return C})),n.d(t,"EnumDeblurMode",(function(){return k})),n.d(t,"EnumDeformationResistingMode",(function(){return L})),n.d(t,"EnumDPMCodeReadingMode",(function(){return O})),n.d(t,"EnumErrorCode",(function(){return a})),n.d(t,"EnumGrayscaleTransformationMode",(function(){return x})),n.d(t,"EnumImagePixelFormat",(function(){return i})),n.d(t,"EnumImagePreprocessingMode",(function(){return B})),n.d(t,"EnumIMResultDataType",(function(){return d})),n.d(t,"EnumIntermediateResultSavingMode",(function(){return w})),n.d(t,"EnumIntermediateResultType",(function(){return N})),n.d(t,"EnumLocalizationMode",(function(){return F})),n.d(t,"EnumPDFReadingMode",(function(){return P})),n.d(t,"EnumQRCodeErrorCorrectionLevel",(function(){return G})),n.d(t,"EnumRegionPredetectionMode",(function(){return U})),n.d(t,"EnumResultCoordinateType",(function(){return V})),n.d(t,"EnumResultType",(function(){return W})),n.d(t,"EnumScaleUpMode",(function(){return H})),n.d(t,"EnumTerminatePhase",(function(){return K})),n.d(t,"EnumTextFilterMode",(function(){return j})),n.d(t,"EnumTextResultOrderMode",(function(){return J})),n.d(t,"EnumTextureDetectionMode",(function(){return Y})),function(e){e[e.IPF_Binary=0]="IPF_Binary",e[e.IPF_BinaryInverted=1]="IPF_BinaryInverted",e[e.IPF_GrayScaled=2]="IPF_GrayScaled",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888"}(i||(i={})),function(e){e[e.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",e[e.DBR_SUCCESS=0]="DBR_SUCCESS",e[e.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",e[e.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",e[e.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",e[e.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",e[e.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",e[e.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",e[e.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",e[e.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",e[e.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",e[e.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",e[e.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",e[e.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",e[e.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",e[e.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",e[e.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",e[e.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",e[e.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",e[e.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",e[e.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",e[e.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",e[e.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",e[e.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",e[e.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",e[e.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",e[e.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",e[e.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",e[e.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",e[e.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",e[e.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",e[e.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",e[e.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",e[e.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",e[e.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",e[e.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",e[e.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",e[e.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",e[e.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",e[e.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",e[e.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",e[e.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",e[e.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",e[e.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",e[e.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",e[e.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",e[e.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",e[e.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",e[e.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",e[e.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",e[e.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",e[e.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",e[e.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",e[e.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",e[e.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",e[e.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",e[e.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",e[e.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",e[e.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",e[e.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",e[e.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",e[e.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(a||(a={})),function(e){e[e.IMRDT_IMAGE=1]="IMRDT_IMAGE",e[e.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",e[e.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",e[e.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",e[e.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",e[e.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(d||(d={})),function(e){e[e.BF_ALL=-31457281]="BF_ALL",e[e.BF_ONED=1050623]="BF_ONED",e[e.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",e[e.BF_CODE_39=1]="BF_CODE_39",e[e.BF_CODE_128=2]="BF_CODE_128",e[e.BF_CODE_93=4]="BF_CODE_93",e[e.BF_CODABAR=8]="BF_CODABAR",e[e.BF_ITF=16]="BF_ITF",e[e.BF_EAN_13=32]="BF_EAN_13",e[e.BF_EAN_8=64]="BF_EAN_8",e[e.BF_UPC_A=128]="BF_UPC_A",e[e.BF_UPC_E=256]="BF_UPC_E",e[e.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",e[e.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",e[e.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",e[e.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",e[e.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",e[e.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",e[e.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",e[e.BF_PATCHCODE=262144]="BF_PATCHCODE",e[e.BF_PDF417=33554432]="BF_PDF417",e[e.BF_QR_CODE=67108864]="BF_QR_CODE",e[e.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",e[e.BF_AZTEC=268435456]="BF_AZTEC",e[e.BF_MAXICODE=536870912]="BF_MAXICODE",e[e.BF_MICRO_QR=1073741824]="BF_MICRO_QR",e[e.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",e[e.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",e[e.BF_MSI_CODE=1048576]="BF_MSI_CODE",e[e.BF_NULL=0]="BF_NULL"}(g||(g={}));var v=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))},m="undefined"==typeof self,E=m?{}:self,R=function(){function e(){Object(o.a)(this,e),this._canvasMaxWH="iPhone"==e.browserInfo.OS||"Android"==e.browserInfo.OS?2048:4096,this._instanceID=void 0,this.bSaveOriCanvas=!1,this.oriCanvas=null,this._1dMinConfidence=30,this.maxVideoCvsLength=3,this.videoCvses=[],this.videoGlCvs=null,this.videoGl=null,this.glImgData=null,this.bFilterRegionInJs=!0,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this._bUseWebgl=!0,this.decodeRecords={},this.bDestroyed=!1,this._setWarnnedEx=new Set,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0}return Object(s.a)(e,[{key:"ifSaveOriginalImageInACanvas",get:function(){return this.bSaveOriCanvas},set:function(e){this.bSaveOriCanvas=e}},{key:"getOriginalImageInACanvas",value:function(){return this.oriCanvas}},{key:"region",get:function(){return this._region},set:function(e){this._region=e}},{key:"isContextDestroyed",value:function(){return this.bDestroyed}},{key:"lastErrorCode",get:function(){return this._lastErrorCode}},{key:"lastErrorString",get:function(){return this._lastErrorString}},{key:"decode",value:function(t){return v(this,void 0,void 0,r.mark((function n(){var i;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e._onLog&&e._onLog("decode(source: any)"),e._onLog&&(this._timeStartDecode=Date.now()),n.next=39;break;case 4:n.t0=n.sent,n.next=38;break;case 7:if(!(t instanceof Uint8Array)){n.next=13;break}return n.next=10,this._decodeFileInMemory_Uint8Array(t);case 10:n.t1=n.sent,n.next=37;break;case 13:if(!("string"==typeof t||t instanceof String)){n.next=33;break}if("data:image/"!=t.substring(0,11)){n.next=20;break}return n.next=17,this._decode_Base64(t);case 17:n.t3=n.sent,n.next=30;break;case 20:if("http"!=t.substring(0,4)){n.next=26;break}return n.next=23,this._decode_Url(t);case 23:n.t4=n.sent,n.next=29;break;case 26:return n.next=28,this._decode_FilePath(t);case 28:n.t4=n.sent;case 29:n.t3=n.t4;case 30:n.t2=n.t3,n.next=36;break;case 33:return n.next=35,Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Buffer', 'Uint8Array', 'String(base64 with image mime)' or 'String(url)'."));case 35:n.t2=n.sent;case 36:n.t1=n.t2;case 37:n.t0=n.t1;case 38:return n.abrupt("return",n.t0);case 39:if(i={},!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),!(t instanceof Blob)){n.next=47;break}return n.next=44,this._decode_Blob(t,i);case 44:n.t5=n.sent,n.next=99;break;case 47:if(!(t instanceof ArrayBuffer)){n.next=53;break}return n.next=50,this._decode_ArrayBuffer(t,i);case 50:n.t6=n.sent,n.next=98;break;case 53:if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray)){n.next=59;break}return n.next=56,this._decode_Uint8Array(t,i);case 56:n.t7=n.sent,n.next=97;break;case 59:if(!(t instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)){n.next=65;break}return n.next=62,this._decode_Image(t,i);case 62:n.t8=n.sent,n.next=96;break;case 65:if(!(t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)){n.next=71;break}return n.next=68,this._decode_Canvas(t,i);case 68:n.t9=n.sent,n.next=95;break;case 71:if(!(t instanceof HTMLVideoElement)){n.next=77;break}return n.next=74,this._decode_Video(t,i);case 74:n.t10=n.sent,n.next=94;break;case 77:if(!("string"==typeof t||t instanceof String)){n.next=90;break}if("data:image/"!=t.substring(0,11)){n.next=84;break}return n.next=81,this._decode_Base64(t,i);case 81:n.t12=n.sent,n.next=87;break;case 84:return n.next=86,this._decode_Url(t,i);case 86:n.t12=n.sent;case 87:n.t11=n.t12,n.next=93;break;case 90:return n.next=92,Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."));case 92:n.t11=n.sent;case 93:n.t10=n.t11;case 94:n.t9=n.t10;case 95:n.t8=n.t9;case 96:n.t7=n.t8;case 97:n.t6=n.t7;case 98:n.t5=n.t6;case 99:return n.abrupt("return",n.t5);case 100:case"end":return n.stop()}}),n,this)})))}},{key:"decodeBase64String",value:function(e){return v(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.abrupt("return",(!this.region||this.region instanceof Array||(n.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,n)));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"decodeUrl",value:function(e){return v(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.abrupt("return",(!this.region||this.region instanceof Array||(n.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,n)));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"_decodeBuffer_Uint8Array",value:function(t,n,i,a,o,s){return v(this,void 0,void 0,r.mark((function c(){var u=this;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,new Promise((function(r,c){var d=e._nextTaskID++;e._taskCallbackMap.set(d,(function(t){if(t.success){var n,i=e._onLog?Date.now():0;e._onLog&&e._onLog("worker return result: "+i),u._lastInnerDecodeDuration=t.duration;try{n=u._handleRetJsonString(t.decodeReturn);for(var a=0;a<n.length;++a){var o=n[a];try{o.barcodeFormat&(g.BF_ONED|g.BF_GS1_DATABAR)&&o.results[0].confidence<u._1dMinConfidence&&(n.splice(a,1),--a)}catch(t){}}}catch(t){return c(t)}if(e._onLog){var s=Date.now();e._onLog("DBR time get result: "+i),e._onLog("Handle image cost: "+(u._timeEnterInnerDBR-u._timeStartDecode)),e._onLog("DBR worker decode image cost: "+(i-u._timeEnterInnerDBR)),e._onLog("DBR worker handle results: "+(s-i)),e._onLog("Total decode image cost: "+(s-u._timeStartDecode))}return r(n)}var d=new Error(t.message);return d.stack=t.stack+"\n"+d.stack,c(d)})),u._timeEnterInnerDBR=Date.now(),e._onLog&&e._onLog("Send buffer to worker:"+Date.now()),e._dbrWorker.postMessage({type:"decodeBuffer",id:d,instanceID:u._instanceID,body:{buffer:t,width:n,height:i,stride:a,format:o,config:s}},[t.buffer]),e._onLog&&s&&s._timeEndGettingFrame&&e._onLog("decode image delay: "+(u._timeEnterInnerDBR-s._timeEndGettingFrame))}));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),c)})))}},{key:"_decodeBuffer_Blob",value:function(t,n,i,a,o,s){return v(this,void 0,void 0,r.mark((function c(){var u=this;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e._onLog&&e._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)"),r.next=3,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(){e(r.result)},r.onerror=function(){n(r.error)}})).then((function(e){return u._decodeBuffer_Uint8Array(new Uint8Array(e),n,i,a,o,s)}));case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),c)})))}},{key:"decodeBuffer",value:function(t,n,i,a,o,s){return v(this,void 0,void 0,r.mark((function c(){var u;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e._onLog&&e._onLog("decodeBuffer(buffer,width,height,stride,format)"),e._onLog&&(this._timeStartDecode=Date.now()),r.next=16;break;case 6:u=r.sent,r.next=14;break;case 9:if(r.t0=t instanceof Buffer,!r.t0){r.next=14;break}return r.next=13,this._decodeBuffer_Uint8Array(new Uint8Array(t),n,i,a,o,s);case 13:u=r.sent;case 14:r.next=33;break;case 16:if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray)){r.next=22;break}return r.next=19,this._decodeBuffer_Uint8Array(t,n,i,a,o,s);case 19:u=r.sent,r.next=33;break;case 22:if(!(t instanceof ArrayBuffer)){r.next=28;break}return r.next=25,this._decodeBuffer_Uint8Array(new Uint8Array(t),n,i,a,o,s);case 25:u=r.sent,r.next=33;break;case 28:if(r.t1=t instanceof Blob,!r.t1){r.next=33;break}return r.next=32,this._decodeBuffer_Blob(t,n,i,a,o,s);case 32:u=r.sent;case 33:return r.abrupt("return",u);case 34:case"end":return r.stop()}}),c,this)})))}},{key:"_decodeFileInMemory_Uint8Array",value:function(t){return v(this,void 0,void 0,r.mark((function n(){var i=this;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(n,r){var a=e._nextTaskID++;e._taskCallbackMap.set(a,(function(e){if(e.success){var t;i._lastInnerDecodeDuration=e.duration;try{t=i._handleRetJsonString(e.decodeReturn)}catch(e){return r(e)}return n(t)}var a=new Error(e.message);return a.stack=e.stack+"\n"+a.stack,r(a)})),e._dbrWorker.postMessage({type:"decodeFileInMemory",id:a,instanceID:i._instanceID,body:{bytes:t}})}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))}},{key:"getRuntimeSettings",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success){var i=JSON.parse(e.results);return null!=n.userDefinedRegion&&(i.region=JSON.parse(JSON.stringify(n.userDefinedRegion))),t(i)}var a=new Error(e.message);return a.stack=e.stack+"\n"+a.stack,r(a)})),e._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:n._instanceID})}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}},{key:"updateRuntimeSettings",value:function(t){return v(this,void 0,void 0,r.mark((function n(){var i,a,o,s,c,u,d=this;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!("string"==typeof t||t instanceof String)){n.next=52;break}if("speed"!=t){n.next=18;break}return n.next=4,this.getRuntimeSettings();case 4:return a=n.sent,n.next=7,this.resetRuntimeSettings();case 7:return n.next=9,this.getRuntimeSettings();case 9:(i=n.sent).barcodeFormatIds=a.barcodeFormatIds,i.barcodeFormatIds_2=a.barcodeFormatIds_2,i.region=a.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0],n.next=50;break;case 18:if("balance"!=t){n.next=35;break}return n.next=21,this.getRuntimeSettings();case 21:return o=n.sent,n.next=24,this.resetRuntimeSettings();case 24:return n.next=26,this.getRuntimeSettings();case 26:(i=n.sent).barcodeFormatIds=o.barcodeFormatIds,i.barcodeFormatIds_2=o.barcodeFormatIds_2,i.region=o.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0],n.next=50;break;case 35:if("coverage"!=t){n.next=49;break}return n.next=38,this.getRuntimeSettings();case 38:return s=n.sent,n.next=41,this.resetRuntimeSettings();case 41:return n.next=43,this.getRuntimeSettings();case 43:(i=n.sent).barcodeFormatIds=s.barcodeFormatIds,i.barcodeFormatIds_2=s.barcodeFormatIds_2,i.region=s.region,n.next=50;break;case 49:i=JSON.parse(t);case 50:n.next=55;break;case 52:if("object"==typeof t){n.next=54;break}throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");case 54:(i=JSON.parse(JSON.stringify(t))).region instanceof Array&&[(c=i.region).regionLeft,c.regionTop,c.regionLeft,c.regionBottom,c.regionMeasuredByPercentage].some((function(e){return void 0!==e}))&&(i.region={regionLeft:c.regionLeft||0,regionTop:c.regionTop||0,regionRight:c.regionRight||0,regionBottom:c.regionBottom||0,regionMeasuredByPercentage:c.regionMeasuredByPercentage||0});case 55:if(e._bUseFullFeature){n.next=60;break}if(0==(i.barcodeFormatIds&~(g.BF_ONED|g.BF_QR_CODE|g.BF_PDF417|g.BF_DATAMATRIX))&&0==i.barcodeFormatIds_2){n.next=58;break}throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");case 58:if(0==i.intermediateResultTypes){n.next=60;break}throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.");case 60:if(!this.bFilterRegionInJs){n.next=68;break}if(!((u=i.region)instanceof Array)){n.next=65;break}throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");case 65:this.userDefinedRegion=JSON.parse(JSON.stringify(u)),(u.regionLeft||u.regionTop||u.regionRight||u.regionBottom||u.regionMeasuredByPercentage)&&(u.regionLeft||u.regionTop||100!=u.regionRight||100!=u.regionBottom||!u.regionMeasuredByPercentage)?this.region=u:this.region=null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0},n.next=69;break;case 68:this.userDefinedRegion=null,this.region=null;case 69:return n.next=71,new Promise((function(t,n){var r=e._nextTaskID++;e._taskCallbackMap.set(r,(function(e){if(e.success){try{d._handleRetJsonString(e.updateReturn)}catch(t){n(t)}return t()}var r=new Error(e.message);return r.stack=e.stack+"\n"+r.stack,n(r)})),e._dbrWorker.postMessage({type:"updateRuntimeSettings",id:r,instanceID:d._instanceID,body:{settings:JSON.stringify(i)}})}));case 71:return n.abrupt("return",n.sent);case 72:case"end":return n.stop()}}),n,this)})))}},{key:"resetRuntimeSettings",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.userDefinedRegion=null,this.region=null,t.next=4,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return t();var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,r(n)})),e._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:n._instanceID})}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"outputSettingsToString",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._bUseFullFeature){t.next=2;break}throw Error("outputSettingsToString() is not supported in the compact version. Please try the full-featured version.");case 2:return t.next=4,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return t(e.results);var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,r(n)})),e._dbrWorker.postMessage({type:"outputSettingsToString",id:i,instanceID:n._instanceID})}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}},{key:"initRuntimeSettingsWithString",value:function(t){return v(this,void 0,void 0,r.mark((function n(){var i=this;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e._bUseFullFeature){n.next=2;break}throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");case 2:if(!("string"==typeof t||t instanceof String)){n.next=6;break}t=t,n.next=9;break;case 6:if("object"==typeof t){n.next=8;break}throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");case 8:t=JSON.stringify(t);case 9:return n.next=11,new Promise((function(n,r){var a=e._nextTaskID++;e._taskCallbackMap.set(a,(function(e){if(e.success){try{i._handleRetJsonString(e.initReturn)}catch(e){r(e)}return n()}var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)})),e._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:a,instanceID:i._instanceID,body:{settings:t}})}));case 11:return n.abrupt("return",n.sent);case 12:case"end":return n.stop()}}),n)})))}},{key:"_decode_Blob",value:function(t,n){return v(this,void 0,void 0,r.mark((function i(){var a,o,s;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Blob(blob: Blob)"),a=null,o=null,"undefined"==typeof createImageBitmap){r.next=11;break}return r.prev=3,r.next=6,createImageBitmap(t);case 6:a=r.sent,r.next=11;break;case 9:r.prev=9,r.t0=r.catch(3);case 11:if(r.t1=a,r.t1){r.next=16;break}return r.next=15,function(e){return new Promise((function(t,n){var r=URL.createObjectURL(e),i=new Image;i.dbrObjUrl=r,i.src=r,i.onload=function(){t(i)},i.onerror=function(e){n(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(t);case 15:o=r.sent;case 16:return r.next=18,this._decode_Image(a||o,n);case 18:return s=r.sent,r.abrupt("return",(a&&a.close(),s));case 20:case"end":return r.stop()}}),i,this,[[3,9]])})))}},{key:"_decode_ArrayBuffer",value:function(e,t){return v(this,void 0,void 0,r.mark((function n(){return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._decode_Blob(new Blob([e]),t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"_decode_Uint8Array",value:function(e,t){return v(this,void 0,void 0,r.mark((function n(){return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._decode_Blob(new Blob([e]),t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"_decode_Image",value:function(t,n){return v(this,void 0,void 0,r.mark((function i(){var a,o,s,c,u,d,_,l,h,f,g,v,m,p,R,I,A,b,S,T,D;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e._onLog&&e._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),n=n||{},s=t instanceof HTMLImageElement?t.naturalWidth:t.width,c=t instanceof HTMLImageElement?t.naturalHeight:t.height,(u=Math.max(s,c))>this._canvasMaxWH?(d=this._canvasMaxWH/u,a=Math.round(s*d),o=Math.round(c*d)):(a=s,o=c),l=0,h=0,f=s,g=c,v=a,m=o,(p=n.region)&&(p.regionMeasuredByPercentage?(R=p.regionLeft*a/100,I=p.regionTop*o/100,A=p.regionRight*a/100,b=p.regionBottom*o/100):(R=p.regionLeft,I=p.regionTop,A=p.regionRight,b=p.regionBottom),v=A-R,f=Math.round(v/a*s),m=b-I,g=Math.round(m/o*c),l=Math.round(R/a*s),h=Math.round(I/o*c)),!this.bSaveOriCanvas&&E.OffscreenCanvas?_=new OffscreenCanvas(v,m):((_=document.createElement("canvas")).width=v,_.height=m),T=_.getContext("2d"),0==l&&0==h&&s==f&&c==g&&s==v&&c==m?T.drawImage(t,0,0):T.drawImage(t,l,h,f,g,0,0,v,m),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),p?delete(S=JSON.parse(JSON.stringify(n))).region:S=n,r.next=10,this._decode_Canvas(_,S);case 10:return D=r.sent,r.abrupt("return",(e.fixResultLocationWhenFilterRegionInJs(p,D,l,h,f,g,v,m),D));case 12:case"end":return r.stop()}}),i,this)})))}},{key:"_decode_Canvas",value:function(t,n){return v(this,void 0,void 0,r.mark((function a(){var o;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),!t.crossOrigin||"anonymous"==t.crossOrigin){r.next=2;break}throw"cors";case 2:return(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=t),o=(t.dbrCtx2d||t.getContext("2d")).getImageData(0,0,t.width,t.height).data,r.next=6,this._decodeBuffer_Uint8Array(o,t.width,t.height,4*t.width,i.IPF_ABGR_8888,n);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),a,this)})))}},{key:"handleVideoFrame",value:function(t,n){if(e._onLog&&e._onLog("handleVideoFrame(video)"),!(t instanceof HTMLVideoElement))throw TypeError("'handleVideoFrame(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";n=n||{};var r,i,a=t.videoWidth,o=t.videoHeight,s=Math.max(a,o);if(s>this._canvasMaxWH){var c=this._canvasMaxWH/s;r=Math.round(a*c),i=Math.round(o*c)}else r=a,i=o;var u,d,_,l,h=0,f=0,g=a,v=o,m=a,R=o,I=n.region;I&&(I.regionMeasuredByPercentage?(u=I.regionLeft*r/100,d=I.regionTop*i/100,_=I.regionRight*r/100,l=I.regionBottom*i/100):(u=I.regionLeft,d=I.regionTop,_=I.regionRight,l=I.regionBottom),m=_-u,g=Math.round(m/r*a),R=l-d,v=Math.round(R/i*o),h=Math.round(u/r*a),f=Math.round(d/i*o));var A=0==h&&0==f&&a==g&&o==v&&a==m&&o==R;if(!this.bSaveOriCanvas&&this._bUseWebgl&&A){this.videoGlCvs||(this.videoGlCvs=E.OffscreenCanvas?new OffscreenCanvas(m,R):document.createElement("canvas"));var b=this.videoGlCvs;b.width==m&&b.height==R||(b.height=R,b.width=m,this.videoGl&&this.videoGl.viewport(0,0,m,R));var S=this.videoGl||b.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0})||b.getContext("experimental-webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0});if(!this.videoGl){this.videoGl=S;var T=S.createShader(S.VERTEX_SHADER);S.shaderSource(T,"\nattribute vec4 a_position;\nattribute vec2 a_uv;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    gl_Position = a_position;\n    v_uv = a_uv;\n}\n"),S.compileShader(T),S.getShaderParameter(T,S.COMPILE_STATUS)||console.error("An error occurred compiling the shaders: "+S.getShaderInfoLog(T));var D=S.createShader(S.FRAGMENT_SHADER);S.shaderSource(D,"\nprecision lowp float;\n\nvarying vec2 v_uv;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n    vec4 sample =  texture2D(u_texture, v_uv);\n    float grey = 0.299 * sample.r + 0.587 * sample.g + 0.114 * sample.b;\n    gl_FragColor = vec4(grey, 0.0, 0.0, 1.0);\n}\n"),S.compileShader(D),S.getShaderParameter(D,S.COMPILE_STATUS)||console.error("An error occurred compiling the shaders: "+S.getShaderInfoLog(D));var y=S.createProgram();S.attachShader(y,T),S.attachShader(y,D),S.linkProgram(y),S.getProgramParameter(y,S.LINK_STATUS)||console.error("Unable to initialize the shader program: "+S.getProgramInfoLog(y)),S.useProgram(y),S.bindBuffer(S.ARRAY_BUFFER,S.createBuffer()),S.bufferData(S.ARRAY_BUFFER,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,-1,1,0]),S.STATIC_DRAW);var M=S.getAttribLocation(y,"a_position");S.enableVertexAttribArray(M),S.vertexAttribPointer(M,2,S.FLOAT,!1,16,0);var C=S.getAttribLocation(y,"a_uv");S.enableVertexAttribArray(C),S.vertexAttribPointer(C,2,S.FLOAT,!1,16,8),S.activeTexture(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,S.createTexture()),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.NEAREST),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.NEAREST),S.uniform1i(S.getUniformLocation(y,"u_texture"),0)}(!this.glImgData||this.glImgData.length<m*R*4)&&(this.glImgData=new Uint8Array(m*R*4)),S.texImage2D(S.TEXTURE_2D,0,S.RGBA,S.RGBA,S.UNSIGNED_BYTE,t);var k=e._onLog?Date.now():0;S.drawArrays(S.TRIANGLE_STRIP,0,4),e._onLog&&e._onLog("Grey cost: "+(Date.now()-k));var L=this.glImgData;S.readPixels(0,0,S.drawingBufferWidth,S.drawingBufferHeight,S.RGBA,S.UNSIGNED_BYTE,L);var O=e._onLog?Date.now():0,x=new Uint8Array(new Uint32Array(L.buffer));return e._onLog&&e._onLog("Extract grey cost: "+(Date.now()-O)),{bUseWebGL:!0,u8Gray:x,dWidth:m,dHeight:R}}var B=null;if(this.bSaveOriCanvas)(B=document.createElement("canvas")).width=m,B.height=R,B.dbrCtx2d=B.getContext("2d");else{var w,N=p(this.videoCvses);try{for(N.s();!(w=N.n()).done;){var F=w.value;if(F.width==m&&F.height==R){B=F;break}}}catch(V){N.e(V)}finally{N.f()}B||(E.OffscreenCanvas?B=new OffscreenCanvas(m,R):((B=document.createElement("canvas")).width=m,B.height=R),B.dbrCtx2d=B.getContext("2d"),this.videoCvses.length>=this.maxVideoCvsLength&&(this.videoCvses=this.videoCvses.slice(1)),this.videoCvses.push(B))}var P,G=B.dbrCtx2d;A?G.drawImage(t,0,0):G.drawImage(t,h,f,g,v,0,0,m,R),I?delete(P=JSON.parse(JSON.stringify(n))).region:P=n;var U=B.dbrCtx2d||B.getContext("2d");return 0===B.width||0===B.height?null:{bUseWebGL:!1,data:U.getImageData(0,0,B.width,B.height).data,cvs:B,config:P,region:I,sx:h,sy:f,sWidth:g,sHeight:v,dWidth:m,dHeight:R}}},{key:"_decode_Video",value:function(t,n){return v(this,void 0,void 0,r.mark((function a(){var o,s,c,u,d,_,l,h,f,g,v,m,E,p,R;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Video(video)"),t instanceof HTMLVideoElement){r.next=2;break}throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");case 2:if(!t.crossOrigin||"anonymous"==t.crossOrigin){r.next=4;break}throw"cors";case 4:if(!(o=this.handleVideoFrame(t,n))||!o.bUseWebGL){r.next=10;break}return s=o.u8Gray,c=o.dWidth,u=o.dHeight,r.next=9,this._decodeBuffer_Uint8Array(s,c,u,c,i.IPF_GrayScaled);case 9:return r.abrupt("return",r.sent);case 10:if(!o||!1!==o.bUseWebGL){r.next=17;break}return d=o.data,_=o.cvs,l=o.config,h=o.region,f=o.sx,g=o.sy,v=o.sWidth,m=o.sHeight,E=o.dWidth,p=o.dHeight,(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=_),r.next=15,this._decodeBuffer_Uint8Array(d,_.width,_.height,4*_.width,i.IPF_ABGR_8888,l);case 15:return R=r.sent,r.abrupt("return",(e.fixResultLocationWhenFilterRegionInJs(h,R,f,g,v,m,E,p),R));case 17:case"end":return r.stop()}}),a,this)})))}},{key:"_decode_Base64",value:function(t,n){return v(this,void 0,void 0,r.mark((function i(){var a,o,s;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Base64(base64Str)"),"string"==typeof t||t instanceof String){r.next=2;break}return r.abrupt("return",Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'String'."));case 2:"data:image/"==t.substring(0,11)&&(t=t.substring(t.indexOf(",")+1)),r.next=7;break;case 6:case 11:return r.abrupt("return",r.sent);case 7:for(a=atob(t),o=a.length,s=new Uint8Array(o);o--;)s[o]=a.charCodeAt(o);return r.next=11,this._decode_Blob(new Blob([s]),n);case 12:case"end":return r.stop()}}),i,this)})))}},{key:"_decode_Url",value:function(t,n){return v(this,void 0,void 0,r.mark((function i(){var a,o,s=this;return r.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e._onLog&&e._onLog("_decode_Url(url)"),"string"==typeof t||t instanceof String){i.next=2;break}throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'String'.");case 2:t=t,i.next=9;break;case 5:return a=i.sent,i.next=8,this._decodeFileInMemory_Uint8Array(a);case 8:case 14:return i.abrupt("return",i.sent);case 9:return i.next=11,new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.send(),i.onloadend=function(){return v(s,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(i.response);case 1:case"end":return t.stop()}}),t)})))},i.onerror=function(){n(new Error("Network Error: "+i.statusText))}}));case 11:return o=i.sent,i.next=14,this._decode_Blob(o,n);case 15:case"end":return i.stop()}}),i,this)})))}},{key:"_decode_FilePath",value:function(t,i){return v(this,void 0,void 0,r.mark((function i(){var a,o;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:throw e._onLog&&e._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.");case 2:if("string"==typeof t||t instanceof String){r.next=4;break}throw TypeError("'_decode_FilePath(path, config)': Type of 'path' should be 'String'.");case 4:return a=n(3),r.next=7,new Promise((function(e,n){a.readFile(t,(function(t,r){t?n(t):e(new Uint8Array(r))}))}));case 7:return o=r.sent,r.next=10,this._decodeFileInMemory_Uint8Array(o);case 10:return r.abrupt("return",r.sent);case 11:case"end":return r.stop()}}),i,this)})))}},{key:"_handleRetJsonString",value:function(t){var n=this,r=a;if(t.textResults){for(var i=0;i<t.textResults.length;i++){var o=t.textResults[i];try{for(var s=o.barcodeText,c="",u=0;u<s.length;u++)c+=String.fromCharCode(s[u]);try{o.barcodeText=decodeURIComponent(escape(c))}catch(t){o.barcodeText=c}}catch(t){o.barcodeText=""}null!=o.exception&&function(){n._setWarnnedEx.has(o.exception)||(n._setWarnnedEx.add(o.exception),console.warn(o.exception));var e={};o.exception.split(";").forEach((function(t){var n=t.indexOf(":");e[t.substring(0,n)]=t.substring(n+1)})),o.exception=e}()}return t.decodeRecords?this.decodeRecords=t.decodeRecords:this.decodeRecords={},this._lastErrorCode=t.exception,this._lastErrorString=t.description,t.textResults}if(t.exception==r.DBR_SUCCESS)return t.data;throw e.BarcodeReaderException(t.exception,t.description)}},{key:"setModeArgument",value:function(t,n,i,a){return v(this,void 0,void 0,r.mark((function o(){var s=this;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,new Promise((function(r,o){var c=e._nextTaskID++;e._taskCallbackMap.set(c,(function(e){if(e.success){try{s._handleRetJsonString(e.setReturn)}catch(e){return o(e)}return r()}var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)})),e._dbrWorker.postMessage({type:"setModeArgument",id:c,instanceID:s._instanceID,body:{modeName:t,index:n,argumentName:i,argumentValue:a}})}));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),o)})))}},{key:"getModeArgument",value:function(t,n,i){return v(this,void 0,void 0,r.mark((function a(){var o=this;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,new Promise((function(r,a){var s=e._nextTaskID++;e._taskCallbackMap.set(s,(function(e){if(e.success){var t;try{t=o._handleRetJsonString(e.getReturn)}catch(e){return a(e)}return r(t)}var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,a(n)})),e._dbrWorker.postMessage({type:"getModeArgument",id:s,instanceID:o._instanceID,body:{modeName:t,index:n,argumentName:i}})}));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),a)})))}},{key:"getIntermediateResults",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return t(e.results);var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,r(n)})),e._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:n._instanceID})}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}},{key:"getIntermediateCanvas",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n,a,o,s,c,u,_,l,h,f,g,v,m,E,R,I,A,b,S,T;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getIntermediateResults();case 2:n=t.sent,a=[],o=p(n),t.prev=5,o.s();case 7:if((s=o.n()).done){t.next=52;break}if((c=s.value).dataType!=d.IMRDT_IMAGE){t.next=50;break}u=p(c.results),t.prev=11,u.s();case 13:if((_=u.n()).done){t.next=42;break}l=_.value,h=l.bytes,f=void 0,t.t0=(e._onLog&&e._onLog(" "+h.length+" "+h.byteLength+" "+l.width+" "+l.height+" "+l.stride+" "+l.format),l.format),t.next=t.t0===i.IPF_ABGR_8888?20:t.t0===i.IPF_RGB_888?22:t.t0===i.IPF_GrayScaled?26:t.t0===i.IPF_Binary||t.t0===i.IPF_BinaryInverted?30:35;break;case 20:return f=new Uint8ClampedArray(h),t.abrupt("break",36);case 22:for(g=h.length/3,f=new Uint8ClampedArray(4*g),v=0;v<g;++v)f[4*v]=h[3*v+2],f[4*v+1]=h[3*v+1],f[4*v+2]=h[3*v],f[4*v+3]=255;return t.abrupt("break",36);case 26:for(m=h.length,f=new Uint8ClampedArray(4*m),E=0;E<m;E++)f[4*E]=f[4*E+1]=f[4*E+2]=h[E],f[4*E+3]=255;return t.abrupt("break",36);case 30:for(l.width=8*l.stride,l.height=h.length/l.stride,R=h.length,f=new Uint8ClampedArray(8*R*4),I=0;I<R;I++)for(A=h[I],b=0;b<8;++b)f[4*(8*I+b)]=f[4*(8*I+b)+1]=f[4*(8*I+b)+2]=(128&A)/128*255,f[4*(8*I+b)+3]=255,A<<=1;return t.abrupt("break",36);case 35:console.warn("unknow intermediate image",l);case 36:if(f){t.next=38;break}return t.abrupt("continue",40);case 38:S=new ImageData(f,l.width,l.height),(T=document.createElement("canvas")).width=l.width,T.height=l.height,T.getContext("2d").putImageData(S,0,0),a.push(T);case 40:t.next=13;break;case 42:t.next=47;break;case 44:t.prev=44,t.t1=t.catch(11),u.e(t.t1);case 47:return t.prev=47,u.f(),t.finish(47);case 50:t.next=7;break;case 52:t.next=57;break;case 54:t.prev=54,t.t2=t.catch(5),o.e(t.t2);case 57:return t.prev=57,o.f(),t.finish(57);case 60:return t.abrupt("return",a);case 61:case"end":return t.stop()}}),t,this,[[5,54,57,60],[11,44,47,50]])})))}},{key:"destroy",value:function(){var t=this;return e._onLog&&e._onLog("destroy()"),this.bDestroyed=!0,new Promise((function(n,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return n();var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)})),e._dbrWorker.postMessage({type:"destroy",id:i,instanceID:t._instanceID})}))}},{key:"destroyContext",value:function(){return this.destroy()}}],[{key:"version",get:function(){return this._version}},{key:"productKeys",get:function(){return this._productKeys},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`productKeys` is not allowed to change after loadWasm is called.");e._productKeys=t}},{key:"handshakeCode",get:function(){return this._productKeys},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`handshakeCode` is not allowed to change after loadWasm is called.");e._productKeys=t}},{key:"organizationID",get:function(){return this._organizationID},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`organizationID` is not allowed to change after loadWasm is called.");"number"==typeof t&&(t=t.toString()),e._organizationID=t}},{key:"sessionPassword",get:function(){return this._sessionPassword},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`sessionPassword` is not allowed to change after loadWasm is called.");e._sessionPassword=t}},{key:"detectEnvironment",value:function(){return v(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!("undefined"==typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS}).getUserMedia){e.next=11;break}return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:!0});case 5:e.sent.getTracks().forEach((function(e){e.stop()})),t.camera=!0,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})))}},{key:"engineResourcePath",get:function(){return this._engineResourcePath},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change after loadWasm is called.");if(null==t&&(t="./"),m)e._engineResourcePath=t;else{var n=document.createElement("a");n.href=t,e._engineResourcePath=n.href}this._engineResourcePath.endsWith("/")||(e._engineResourcePath+="/")}},{key:"licenseServer",get:function(){return this._licenseServer},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`licenseServer` is not allowed to change after loadWasm is called.");if(null==t)e._licenseServer=[];else{t instanceof Array||(t=[t]);for(var n=0;n<t.length;++n){if(!m){var r=document.createElement("a");r.href=t[n],t[n]=r.href}t[n].endsWith("/")||(t[n]+="/")}e._licenseServer=t}}},{key:"deviceFriendlyName",get:function(){return this._deviceFriendlyName},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`deviceFriendlyName` is not allowed to change after loadWasm is called.");e._deviceFriendlyName=t||""}},{key:"_bUseFullFeature",get:function(){return this.__bUseFullFeature},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`_bUseFullFeature` is not allowed to change after loadWasm is called.");e.__bUseFullFeature=t}},{key:"isLoaded",value:function(){return"loadSuccess"==this._loadWasmStatus}},{key:"lastErrorCode",get:function(){return this._lastErrorCode}},{key:"lastErrorString",get:function(){return this._lastErrorString}},{key:"loadWasm",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n,i,o,s,c=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;break;case 2:if(i=this.productKeys,o=(0==i.length||i.startsWith("P")||i.startsWith("L"))&&0==this.organizationID.length,(s=o||i.length>=8&&!i.startsWith("t")&&!i.startsWith("f")&&!i.startsWith("P")&&!i.startsWith("L")||0==i.length&&0!=this.organizationID.length)&&(E.crypto||(n="Please upgrade your browser to support handshake code."),E.crypto.subtle||(n="Require https to use handshake code in this browser.")),!n){t.next=7;break}if(o){t.next=6;break}throw new Error(n);case 6:o=!1,s=!1,console.warn(n),this._lastErrorCode=a.DMERR_FAILED_TO_REACH_LTS,this._lastErrorString=n;case 7:return o&&(i="",console.warn("Automatically apply for a public trial license.")),t.next=10,new Promise((function(t,n){return v(c,void 0,void 0,r.mark((function a(){var c,u=this;return r.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=this._loadWasmStatus,a.next="unload"===a.t0?3:"loading"===a.t0?17:"loadSuccess"===a.t0?19:"loadFail"===a.t0?21:22;break;case 3:if(e._loadWasmStatus="loading",c=this.engineResourcePath+this._workerName,a.t1=this.engineResourcePath.startsWith(location.origin),a.t1){a.next=10;break}return a.next=9,fetch(c).then((function(e){return e.blob()})).then((function(e){return URL.createObjectURL(e)}));case 9:c=a.sent;case 10:a.next=15;break;case 15:e._dbrWorker=new Worker(c);case 16:this._dbrWorker.onerror=function(t){e._loadWasmStatus="loadFail";var n=new Error(t.message);u._loadWasmErr=n;var r,i=p(u._loadWasmCallbackArr);try{for(i.s();!(r=i.n()).done;)(0,r.value)(n)}catch(a){i.e(a)}finally{i.f()}u._loadWasmCallbackArr=[]},this._dbrWorker.onmessage=function(t){return v(u,void 0,void 0,r.mark((function n(){var i,a,s,c,u,d,_,l,h;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=t.data?t.data:t,n.t0=i.type,n.next="log"===n.t0?4:"load"===n.t0?6:"task"===n.t0?11:20;break;case 4:return this._onLog&&this._onLog(i.message),n.abrupt("break",21);case 6:if(i.message&&(i.message=i.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)")),a=!1,o&&(a=!0),i.success){e._loadWasmStatus="loadSuccess",e._version=i.version+"(JS "+this._jsVersion+"."+this._jsEditVersion+")",this._onLog&&this._onLog("load dbr worker success"),s=p(this._loadWasmCallbackArr);try{for(s.s();!(c=s.n()).done;)(0,c.value)()}catch(r){s.e(r)}finally{s.f()}this._loadWasmCallbackArr=[],this._dbrWorker.onerror=null,i.message&&console.warn(i.message)}else{(u=new Error(i.message)).stack=i.stack+"\n"+u.stack,e._loadWasmStatus="loadFail",this._loadWasmErr=u,d=p(this._loadWasmCallbackArr);try{for(d.s();!(_=d.n()).done;)(0,_.value)(u)}catch(r){d.e(r)}finally{d.f()}this._loadWasmCallbackArr=[],a||111==i.ltsErrorCode&&-1!=i.message.toLowerCase().indexOf("trial license")&&(a=!0)}return a&&this.showDialog(i.success?"warn":"error",i.message),n.abrupt("break",21);case 11:l=i.id,h=i.body,n.prev=12,this._taskCallbackMap.get(l)(h),this._taskCallbackMap.delete(l),n.next=19;break;case 16:throw n.prev=16,n.t1=n.catch(12),this._taskCallbackMap.delete(l),n.t1;case 19:return n.abrupt("break",21);case 20:this._onLog&&this._onLog(t);case 21:case"end":return n.stop()}}),n,this,[[12,16]])})))},this._dbrWorker.postMessage({type:"loadWasm",bd:this._bWasmDebug,engineResourcePath:this.engineResourcePath,version:this._jsVersion,brtk:s,bptk:o,pk:i,og:this.organizationID,dm:location.origin.startsWith("http")?location.origin:"https://localhost",bUseFullFeature:this._bUseFullFeature,browserInfo:this.browserInfo,deviceFriendlyName:this.deviceFriendlyName,ls:this.licenseServer,sp:this._sessionPassword,lm:this._limitModules,cw:this._chargeWay});case 17:return this._loadWasmCallbackArr.push((function(e){e?n(e):t()})),a.abrupt("break",22);case 19:return t(),a.abrupt("break",22);case 21:n(this._loadWasmErr);case 22:case"end":return a.stop()}}),a,this)})))}));case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"showDialog",value:function(t,n){return v(this,void 0,void 0,r.mark((function i(){return r.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this._bNeverShowDialog){i.next=8;break}return i.prev=1,i.delegateYield(r.mark((function i(){var a,o,s,c,u,d,_,l,h,f,g,v,m,E,R,I,A,b,S,T,D,y,M,C;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch(e.engineResourcePath+"dls.license.dialog.html");case 2:if((a=r.sent).ok){r.next=5;break}throw Error("Get license dialog fail. Network Error: "+a.statusText);case 5:return r.next=7,a.text();case 7:if((o=r.sent).trim().startsWith("<")){r.next=10;break}throw Error("Get license dialog fail. Can't get valid HTMLElement.");case 10:for((s=document.createElement("div")).innerHTML=o,c=[],u=0;u<s.childElementCount;++u)(d=s.children[u])instanceof HTMLStyleElement&&(c.push(d),document.head.append(d));(_=1==s.childElementCount?s.children[0]:s).remove(),m=[_],E=_.children,R=p(E);try{for(R.s();!(I=R.n()).done;)A=I.value,m.push(A)}catch(i){R.e(i)}finally{R.f()}for(b=0;b<m.length;++b){S=p(m[b].children);try{for(S.s();!(T=S.n()).done;)D=T.value,m.push(D)}catch(i){S.e(i)}finally{S.f()}}for(y=function(){var e=C[M];if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(function(t){if(e==t.target){_.remove();var n,r=p(c);try{for(r.s();!(n=r.n()).done;)n.value.remove()}catch(i){r.e(i)}finally{r.f()}}}));else if(!h&&e.classList.contains("dls-license-icon-close"))h=e,e.addEventListener("click",(function(){_.remove();var e,t=p(c);try{for(t.s();!(e=t.n()).done;)e.value.remove()}catch(i){t.e(i)}finally{t.f()}}));else if(!f&&e.classList.contains("dls-license-icon-error"))f=e,"error"!=t&&e.remove();else if(!g&&e.classList.contains("dls-license-icon-warn"))g=e,"warn"!=t&&e.remove();else if(!v&&e.classList.contains("dls-license-msg-content")){v=e;for(var r=n;r;){var a=r.indexOf("["),o=r.indexOf("]",a),s=r.indexOf("(",o),u=r.indexOf(")",s);if(-1==a||-1==o||-1==s||-1==u){e.appendChild(new Text(r));break}a>0&&e.appendChild(new Text(r.substring(0,a)));var d=document.createElement("a"),m=r.substring(a+1,o);d.innerText=m;var E=r.substring(s+1,u);d.setAttribute("href",E),d.setAttribute("target","_blank"),e.appendChild(d),r=r.substring(u+1)}}},M=0,C=m;M<C.length;M++)y();document.body.appendChild(_);case 23:case"end":return r.stop()}}),i)}))(),"t0",3);case 3:i.next=8;break;case 5:i.prev=5,i.t1=i.catch(1),e._onLog&&e._onLog(i.t1.message||i.t1);case 8:case"end":return i.stop()}}),i,this,[[1,5]])})))}},{key:"createInstanceInWorker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return v(this,void 0,void 0,r.mark((function n(){var i=this;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadWasm();case 2:return n.next=4,new Promise((function(n,r){var a=e._nextTaskID++;i._taskCallbackMap.set(a,(function(e){if(e.success)return n(e.instanceID);var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)})),i._dbrWorker.postMessage({type:"createInstance",id:a,productKeys:"",bScanner:t})}));case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"createInstance",value:function(){return v(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.next=3,this.createInstanceInWorker();case 3:return n._instanceID=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"fixResultLocationWhenFilterRegionInJs",value:function(e,t,n,r,i,a,o,s){if(e&&t.length>0){var c,u=p(t);try{for(u.s();!(c=u.n()).done;){var d=c.value.localizationResult;2==d.resultCoordinateType&&(d.x1*=.01*o,d.x2*=.01*o,d.x3*=.01*o,d.x4*=.01*o,d.y1*=.01*s,d.y2*=.01*s,d.y3*=.01*s,d.y4*=.01*s);var _=o/i,l=s/a;d.x1=d.x1/_+n,d.x2=d.x2/_+n,d.x3=d.x3/_+n,d.x4=d.x4/_+n,d.y1=d.y1/l+r,d.y2=d.y2/l+r,d.y3=d.y3/l+r,d.y4=d.y4/l+r,2==d.resultCoordinateType&&(d.x1*=100/i,d.x2*=100/i,d.x3*=100/i,d.x4*=100/i,d.y1*=100/a,d.y2*=100/a,d.y3*=100/a,d.y4*=100/a)}}catch(h){u.e(h)}finally{u.f()}}}},{key:"BarcodeReaderException",value:function(e,t){var n,r=a.DBR_UNKNOWN;return"number"==typeof e?(r=e,n=new Error(t)):n=new Error(e),n.code=r,n}}]),e}();R._jsVersion="8.6.3",R._jsEditVersion="20210628",R._version="loading...(JS "+R._jsVersion+"."+R._jsEditVersion+")",R._productKeys=m||!document.currentScript?"":document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||"",R._organizationID=m||!document.currentScript?"":document.currentScript.getAttribute("data-organizationID")||"",R._sessionPassword=m||!document.currentScript?"":document.currentScript.getAttribute("data-sessionPassword")||"",R.browserInfo=function(){if(!m){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(m)return{browser:"ssr",version:0,OS:"ssr"};var t=n(4);return{browser:"node",version:process.version.substring(1),OS:t&&t.platform?t.platform()+t.release():"Unknown"}}(),R._workerName="dbr-"+R._jsVersion+".worker.js",R._engineResourcePath=function(){if(!m&&document.currentScript){var e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{var n=e.indexOf("#");-1!=n&&(e=e.substring(0,n))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}(),R._licenseServer=[],R._deviceFriendlyName="",R._isShowRelDecodeTimeInResults=!1,R._bWasmDebug=!1,R._bNeverShowDialog=!1,R.__bUseFullFeature=!0,R._nextTaskID=0,R._taskCallbackMap=new Map,R._loadWasmStatus="unload",R._loadWasmCallbackArr=[],R._lastErrorCode=0,R._lastErrorString="",R._loadWasmErr=null;var I,A,b,S,T,D,y,M,C,k,L,O,x,B,w,N,F,P,G,U,V,W,H,K,j,J,Y,X=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))},Q=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),z=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).styleEls=[],e.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},e._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),e._singleFrameModeIpt=function(){var t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.setAttribute("capture",""),t.addEventListener("change",(function(){return X(Object(l.a)(e),void 0,void 0,r.mark((function e(){var n,i,a,o,s,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.files[0],t.value="",e.next=4,this.decode(n);case 4:i=e.sent,a=p(i);try{for(a.s();!(o=a.n()).done;)delete o.value.bUnduplicated}catch(r){a.e(r)}finally{a.f()}if(this._drawRegionsults(i),this.onFrameRead&&this._isOpen&&!this._bPauseScan&&this.onFrameRead(i),this.onUnduplicatedRead&&this._isOpen&&!this._bPauseScan){s=p(i);try{for(s.s();!(c=s.n()).done;)u=c.value,this.onUnduplicatedRead(u.barcodeText,u)}catch(r){s.e(r)}finally{s.f()}}return e.next=10,this.clearMapDecodeRecord();case 10:case"end":return e.stop()}}),e,this)})))})),t}(),e._clickIptSingleFrameMode=function(){e._singleFrameModeIpt.click()},e.intervalTime=0,e._isOpen=!1,e._bWorkerDecodeBuffer=!1,e._intervalGetVideoFrame=0,e._getVideoFrameMode=4,e.loopGetFrameTimes=1,e._countLoopGetFrame=0,e.queue_handledFrame=[],e.array_getFrameTimeCost=[],e.array_decodeFrameTimeCost=[],e._indexCurrentDecodingFrame=0,e._timeEndGettingFrame=null,e._bPauseScan=!1,e._lastDeviceId=void 0,e._intervalDetectVideoPause=1e3,e._vc_bPlayingVideoBeforeHide=!1,e._ev_documentHideEvent=function(){"visible"===document.visibilityState?e._vc_bPlayingVideoBeforeHide&&("Firefox"==R.browserInfo.browser?e.play():e._video.play(),e._vc_bPlayingVideoBeforeHide=!1):e._video&&!e._video.paused&&(e._vc_bPlayingVideoBeforeHide=!0,e._video.pause())},e._video=null,e._cvsDrawArea=null,e._divScanArea=null,e._divScanLight=null,e._bgLoading=null,e._bgCamera=null,e._selCam=null,e._selRsl=null,e._optGotRsl=null,e._btnClose=null,e._soundOnSuccessfullRead=new Audio("data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),e.bPlaySoundOnSuccessfulRead=!1,e.bVibrateOnSuccessfulRead=!1,e.vibrateDuration=300,e._allCameras=[],e._currentCamera=null,e._videoTrack=null,e.regionMaskFillStyle="rgba(0,0,0,0.5)",e.regionMaskStrokeStyle="rgb(254,142,20)",e.regionMaskLineWidth=2,e.barcodeFillStyle="rgba(254,180,32,0.3)",e.barcodeStrokeStyle="rgba(254,180,32,0.9)",e.barcodeLineWidth=1,e.beingLazyDrawRegionsults=!1,e._indexVideoRegion=0,e._onCameraSelChange=function(){e.play(e._selCam.value).then((function(){e._isOpen||e.stop()}))},e._onResolutionSelChange=function(){var t,n;if(e._selRsl&&-1!=e._selRsl.selectedIndex){var r=e._selRsl.options[e._selRsl.selectedIndex];t=r.getAttribute("data-width"),n=r.getAttribute("data-height")}e.play(void 0,t,n).then((function(){e._isOpen||e.stop()}))},e._onCloseBtnClick=function(){e.hide()},e.iPlayRound=0,e.promisePlay=null,e}return Object(s.a)(n,[{key:"getUIElement",value:function(){return this.UIElement}},{key:"setUIElement",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var n,i,a,o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("string"==typeof e||e instanceof String)){t.next=16;break}if(e.trim().startsWith("<")){t.next=10;break}return t.next=4,fetch(e);case 4:if((n=t.sent).ok){t.next=7;break}throw Error("setUIElement(elementOrUrl): Network Error: "+n.statusText);case 7:return t.next=9,n.text();case 9:e=t.sent;case 10:if(e.trim().startsWith("<")){t.next=12;break}throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");case 12:for((i=document.createElement("div")).innerHTML=e,a=0;a<i.childElementCount;++a)(o=i.children[a])instanceof HTMLStyleElement&&(this.styleEls.push(o),document.head.append(o));(e=1==i.childElementCount?i.children[0]:i).remove();case 16:this.UIElement=e;case 17:case"end":return t.stop()}}),t,this)})))}},{key:"singleFrameMode",get:function(){return this._singleFrameMode},set:function(e){var t=this;if(this._isOpen)throw new Error("`singleFrameMode` is not allowed to change when scanner is open.");this._singleFrameMode=e,this._singleFrameMode&&X(t,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getScanSettings();case 2:return(t=e.sent).oneDTrustFrameCount=1,e.next=6,this.updateScanSettings(t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"_assertOpen",value:function(){if(!this._isOpen)throw Error("The scanner is not open.")}},{key:"soundOnSuccessfullRead",get:function(){return this._soundOnSuccessfullRead},set:function(e){e instanceof HTMLAudioElement?this._soundOnSuccessfullRead=e:this._soundOnSuccessfullRead=new Audio(e)}},{key:"whenToPlaySoundforSuccessfulRead",get:function(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"},set:function(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}},{key:"whenToVibrateforSuccessfulRead",get:function(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"},set:function(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}},{key:"region",get:function(){return this._region},set:function(e){var t=this;this._region=e,this.singleFrameMode||(this.beingLazyDrawRegionsults=!0,setTimeout((function(){t.beingLazyDrawRegionsults&&t._drawRegionsults()}),500))}},{key:"decode",value:function(e){return f(Object(h.a)(n.prototype),"decode",this).call(this,e)}},{key:"decodeBase64String",value:function(e){return f(Object(h.a)(n.prototype),"decodeBase64String",this).call(this,e)}},{key:"decodeUrl",value:function(e){return f(Object(h.a)(n.prototype),"decodeUrl",this).call(this,e)}},{key:"decodeBuffer",value:function(e,t,r,i,a,o){return f(Object(h.a)(n.prototype),"decodeBuffer",this).call(this,e,t,r,i,a,o)}},{key:"decodeCurrentFrame",value:function(e){return X(this,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(this._assertOpen(),this._decode_Video(this._video,e)));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"clearMapDecodeRecord",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=R._nextTaskID++;R._taskCallbackMap.set(r,(function(t){if(t.success)return e();var r=new Error(t.message);return r.stack=t.stack+"\n"+r.stack,n(r)})),R._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:r,instanceID:t._instanceID})}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}},{key:"updateRuntimeSettings",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var i,a,o,s,c,u,d,_,l,h=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("string"==typeof e||e instanceof String)){t.next=72;break}if("speed"!=e){t.next=15;break}return t.next=4,this.getRuntimeSettings();case 4:return a=t.sent,t.next=7,this.resetRuntimeSettings();case 7:return t.next=9,this.getRuntimeSettings();case 9:(i=t.sent).barcodeFormatIds=a.barcodeFormatIds,i.barcodeFormatIds_2=a.barcodeFormatIds_2,n.isRegionSinglePreset(a.region)||(i.region=a.region),t.next=70;break;case 15:if("balance"!=e){t.next=33;break}return t.next=18,this.getRuntimeSettings();case 18:return o=t.sent,t.next=21,this.resetRuntimeSettings();case 21:return t.next=23,this.getRuntimeSettings();case 23:(i=t.sent).barcodeFormatIds=o.barcodeFormatIds,i.barcodeFormatIds_2=o.barcodeFormatIds_2,n.isRegionSinglePreset(o.region)||(i.region=o.region),i.deblurLevel=3,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0],i.timeout=1e5,t.next=70;break;case 33:if("coverage"!=e){t.next=52;break}return t.next=36,this.getRuntimeSettings();case 36:return s=t.sent,t.next=39,this.resetRuntimeSettings();case 39:return t.next=41,this.getRuntimeSettings();case 41:(i=t.sent).barcodeFormatIds=s.barcodeFormatIds,i.barcodeFormatIds_2=s.barcodeFormatIds_2,n.isRegionSinglePreset(s.region)||(i.region=s.region),i.deblurLevel=5,i.expectedBarcodesCount=512,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.timeout=1e5,t.next=70;break;case 52:if("single"!=e){t.next=69;break}return t.next=55,this.getRuntimeSettings();case 55:return c=t.sent,t.next=58,this.resetRuntimeSettings();case 58:return t.next=60,this.getRuntimeSettings();case 60:(i=t.sent).barcodeFormatIds=c.barcodeFormatIds,i.barcodeFormatIds_2=c.barcodeFormatIds_2,n.isRegionNormalPreset(c.region)?i.region=JSON.parse(JSON.stringify(n.singlePresetRegion)):i.region=c.region,i.expectedBarcodesCount=1,i.localizationModes=[16,2,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=0,t.next=70;break;case 69:i=JSON.parse(e);case 70:t.next=75;break;case 72:if("object"==typeof e){t.next=74;break}throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");case 74:(i=JSON.parse(JSON.stringify(e))).region instanceof Array&&[(u=e.region).regionLeft,u.regionTop,u.regionLeft,u.regionBottom,u.regionMeasuredByPercentage].some((function(e){return void 0!==e}))&&(i.region={regionLeft:u.regionLeft||0,regionTop:u.regionTop||0,regionRight:u.regionRight||0,regionBottom:u.regionBottom||0,regionMeasuredByPercentage:u.regionMeasuredByPercentage||0});case 75:if(R._bUseFullFeature){t.next=80;break}if(0==(i.barcodeFormatIds&~(g.BF_ONED|g.BF_QR_CODE|g.BF_PDF417|g.BF_DATAMATRIX))&&0==i.barcodeFormatIds_2){t.next=78;break}throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");case 78:if(0==i.intermediateResultTypes){t.next=80;break}throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.");case 80:if(d=i.region,this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(d)):this.userDefinedRegion=null,d instanceof Array)if(d.length){for(_=0;_<d.length;++_)(l=d[_])&&((l.regionLeft||l.regionTop||l.regionRight||l.regionBottom||l.regionMeasuredByPercentage)&&(l.regionLeft||l.regionTop||100!=l.regionRight||100!=l.regionBottom||!l.regionMeasuredByPercentage)||(d[_]=null));this.region=d}else this.region=null;else(d.regionLeft||d.regionTop||d.regionRight||d.regionBottom||d.regionMeasuredByPercentage)&&(d.regionLeft||d.regionTop||100!=d.regionRight||100!=d.regionBottom||!d.regionMeasuredByPercentage)?this.region=d:this.region=null;return this.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}),t.next=85,new Promise((function(e,t){var n=R._nextTaskID++;R._taskCallbackMap.set(n,(function(n){if(n.success){try{h._handleRetJsonString(n.updateReturn)}catch(e){t(e)}return e()}var r=new Error(n.message);return r.stack=n.stack+"\n"+r.stack,t(r)})),R._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:h._instanceID,body:{settings:JSON.stringify(i)}})}));case 85:if(t.t0="single"==e,!t.t0){t.next=95;break}return t.next=89,this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","0");case 89:return t.next=91,this.setModeArgument("LocalizationModes",0,"ScanDirection","2");case 91:return t.next=93,this.setModeArgument("BinarizationModes",0,"BlockSizeX","71");case 93:return t.next=95,this.setModeArgument("BinarizationModes",0,"BlockSizeY","71");case 95:case"end":return t.stop()}}),t,this)})))}},{key:"_bindUI",value:function(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");var e,t=[this.UIElement],n=p(this.UIElement.children);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r)}}catch(l){n.e(l)}finally{n.f()}for(var i=0;i<t.length;++i){var a,o=p(t[i].children);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.push(s)}}catch(l){o.e(l)}finally{o.f()}}for(var c=null,u=0,d=t;u<d.length;u++){var _=d[u];!this._video&&_.classList.contains("dbrScanner-video")?(this._video=_,this._video.setAttribute("playsinline","true")):!this._cvsDrawArea&&_.classList.contains("dbrScanner-cvs-drawarea")?this._cvsDrawArea=_:!this._divScanArea&&_.classList.contains("dbrScanner-cvs-scanarea")?this._divScanArea=_:!this._divScanLight&&_.classList.contains("dbrScanner-scanlight")?this._divScanLight=_:!this._bgLoading&&_.classList.contains("dbrScanner-bg-loading")?this._bgLoading=_:!this._bgCamera&&_.classList.contains("dbrScanner-bg-camera")?this._bgCamera=_:!this._selCam&&_.classList.contains("dbrScanner-sel-camera")?this._selCam=_:!this._selRsl&&_.classList.contains("dbrScanner-sel-resolution")?(this._selRsl=_,this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920 x 1080</option>','<option data-width="1280" data-height="720">ask 1280 x 720</option>','<option data-width="640" data-height="480">ask 640 x 480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&_.classList.contains("dbrScanner-opt-gotResolution")?this._optGotRsl=_:!this._btnClose&&_.classList.contains("dbrScanner-btn-close")?this._btnClose=_:!this._video&&_.classList.contains("dbrScanner-existingVideo")?(this._video=_,this._video.setAttribute("playsinline","true"),this.singleFrameMode=!1):!c&&_.tagName&&"video"==_.tagName.toLowerCase()&&(c=_)}if(!this._video&&c&&(this._video=c),this.singleFrameMode?(this._video&&(this._video.addEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="pointer",this._video.setAttribute("title","Take a photo")),this._cvsDrawArea&&(this._cvsDrawArea.addEventListener("click",this._clickIptSingleFrameMode),this._cvsDrawArea.style.cursor="pointer",this._cvsDrawArea.setAttribute("title","Take a photo")),this._divScanArea&&(this._divScanArea.addEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="pointer",this._divScanArea.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="")):this._bgLoading&&(this._bgLoading.style.display=""),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),!this._video)throw this._unbindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.");this._isOpen=!0}},{key:"_unbindUI",value:function(){this._clearRegionsults(),this.singleFrameMode?(this._video&&(this._video.removeEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="",this._video.removeAttribute("title")),this._cvsDrawArea&&(this._cvsDrawArea.removeEventListener("click",this._clickIptSingleFrameMode),this._cvsDrawArea.style.cursor="",this._cvsDrawArea.removeAttribute("title")),this._divScanArea&&(this._divScanArea.removeEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="",this._divScanArea.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this._video=null,this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._isOpen=!1}},{key:"_renderSelCameraInfo",value:function(){if(this._selCam&&(this._selCam.innerHTML=""),this._selCam){var e,t,n=p(this._allCameras);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=document.createElement("option");i.value=r.deviceId,i.innerText=r.label,this._selCam.append(i),r.deviceId&&this._currentCamera&&this._currentCamera.deviceId==r.deviceId&&(e=i)}}catch(a){n.e(a)}finally{n.f()}this._selCam.value=e?e.value:""}}},{key:"getAllCameras",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t,n,i,a,o,s,c,u,d,_,l,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:if(t=e.sent,n=[],i=[],this._allCameras){a=p(this._allCameras);try{for(a.s();!(o=a.n()).done;)(s=o.value)._checked&&i.push(s)}catch(r){a.e(r)}finally{a.f()}}for(c=0;c<t.length;c++)if(u=void 0,"videoinput"==(d=t[c]).kind){_=p(i);try{for(_.s();!(l=_.n()).done;)h=l.value,d.deviceId==h.deviceId&&(u=h)}catch(r){_.e(r)}finally{_.f()}u||((u={}).deviceId=d.deviceId,u.label=d.label?d.label:"camera "+c),n.push(u)}return e.abrupt("return",(this._allCameras=n,R._onLog&&R._onLog(JSON.stringify(this._allCameras)),Promise.resolve(n)));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getCurrentCamera",value:function(){return X(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._currentCamera);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"setCurrentCamera",value:function(e){return X(this,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.play(e.deviceId||e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getResolution",value:function(){return this._isOpen?[this._video.videoWidth,this._video.videoHeight]:null}},{key:"setResolution",value:function(e,t){return X(this,void 0,void 0,r.mark((function n(){var i,a;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._isOpen){n.next=7;break}return e instanceof Array?(i=e[0],a=e[1]):(i=e,a=t),n.next=4,this.play(null,i,a);case 4:n.t0=n.sent,n.next=10;break;case 7:return n.next=9,Promise.reject(new Error("The camera is not open."));case 9:n.t0=n.sent;case 10:return n.abrupt("return",n.t0);case 11:case"end":return n.stop()}}),n,this)})))}},{key:"getScanSettings",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=R._nextTaskID++;R._taskCallbackMap.set(r,(function(r){if(r.success){var i=r.results;return i.intervalTime=t.intervalTime,e(i)}var a=new Error(r.message);return a.stack+="\n"+r.stack,n(a)})),R._dbrWorker.postMessage({type:"getScanSettings",id:r,instanceID:t._instanceID})}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}},{key:"updateScanSettings",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var i=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.intervalTime=e.intervalTime,t.next=3,new Promise((function(t,r){var a=R._nextTaskID++;R._taskCallbackMap.set(a,(function(e){if(e.success)return t();var n=new Error(e.message);return n.stack+="\n"+e.stack,r(n)})),n._dbrWorker.postMessage({type:"updateScanSettings",id:a,instanceID:i._instanceID,body:{settings:e}})}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getVideoSettings",value:function(){return JSON.parse(JSON.stringify(this.videoSettings))}},{key:"updateVideoSettings",value:function(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._isOpen?this.play():Promise.resolve()}},{key:"isOpen",value:function(){return this._isOpen}},{key:"_show",value:function(){this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display="")}},{key:"stop",value:function(){this._video&&this._video.srcObject&&(R._onLog&&R._onLog("======stop video========"),this._video.srcObject.getTracks().forEach((function(e){e.stop()})),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this._video.classList.contains("dbrScanner-existingVideo")&&(R._onLog&&R._onLog("======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._divScanLight&&(this._divScanLight.style.display="none"),this._drawRegionsults(),this.queue_handledFrame.length=0,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}},{key:"pause",value:function(){this._video&&this._video.pause(),this._divScanLight&&(this._divScanLight.style.display="none")}},{key:"play",value:function(e,t,n){return X(this,void 0,void 0,r.mark((function i(){var a,o,s=this;return r.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this._assertOpen(),!this._video||!this.videoSrc){i.next=5;break}return i.next=3,new Promise((function(e,t){s._video.onloadedmetadata=function(){return X(s,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._video.onloadedmetadata=null,t.next=3,this._video.play();case 3:e();case 4:case"end":return t.stop()}}),t,this)})))},"string"==typeof s.videoSrc||s.videoSrc instanceof String?s._video.src=s.videoSrc:s._video.srcObject=s.videoSrc,setTimeout((function(){return t(new Error("Failed to play video. Timeout."))}),4e3)}));case 3:return a={width:this._video.videoWidth,height:this._video.videoHeight},i.abrupt("return",(this.onPlayed&&setTimeout((function(){s.onPlayed(a)}),0),a));case 5:if(!this.singleFrameMode){i.next=7;break}return i.abrupt("return",(this._clickIptSingleFrameMode(),{width:0,height:0}));case 7:if(o=++this.iPlayRound,i.t0=this.promisePlay,!i.t0){i.next=13;break}return i.next=12,this.promisePlay;case 12:i.t0=o<this.iPlayRound;case 13:if(!i.t0){i.next=17;break}i.t1={width:this._video.videoWidth,height:this._video.videoHeight},i.next=21;break;case 17:return this.promisePlay=X(s,void 0,void 0,r.mark((function i(){var a,o,s,c,u,d,_,l,h,f,g,v,m,E,I,A,b,S,T,D=this;return r.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,this._video&&this._video.srcObject&&this.stop(),R._onLog&&R._onLog("======before video========"),i.next=5,this.getAllCameras();case 5:return o=function(){if(D.bDestroyed)throw d&&d.getTracks().forEach((function(e){e.stop()})),D._video.srcObject=null,D._videoTrack=null,D._currentCamera=null,new Error("The BarcodeScanner instance has been destroyed.")},"boolean"==typeof(s=JSON.parse(JSON.stringify(this.videoSettings))).video&&(s.video={}),t&&(s.video.width={ideal:t}),n&&(s.video.height={ideal:n}),u=["rear","back","r\xfcck","arri\xe8re","trasera","tr\xe1s","traseira","posteriore","\u540e\u9762","\u5f8c\u9762","\u80cc\u9762","\u540e\u7f6e","\u5f8c\u7f6e","\u80cc\u7f6e","\u0437\u0430\u0434\u043d\u0435\u0439","\u0627\u0644\u062e\u0644\u0641\u064a\u0629","\ud6c4","arka","achterzijde","\u0e2b\u0e25\u0e31\u0e07","baksidan","bagside","sau","bak","tylny","takakamera","belakang","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u03c0\u03af\u03c3\u03c9","spate","h\xe1ts\xf3","zadn\xed","darrere","zadn\xe1","\u0437\u0430\u0434\u043d\u044f","stra\u017enja","belakang","\u092c\u0948\u0915"],_=function(){var e,t=p(D._allCameras);try{var n=function(){var t=e.value,n=t.label.toLowerCase();if(n&&u.some((function(e){return-1!=n.indexOf(e)}))&&/\b0(\b)?/.test(n))return delete s.video.facingMode,s.video.deviceId={ideal:t.deviceId},"break"};for(t.s();!(e=t.n()).done&&"break"!==n(););}catch(r){t.e(r)}finally{t.f()}s.video.deviceId||-1==["Android","HarmonyOS"].indexOf(R.browserInfo.OS)||(delete s.video.facingMode,s.video.deviceId={ideal:D._allCameras[D._allCameras.length-1].deviceId})},e?(delete s.video.facingMode,s.video.deviceId={exact:e},this._lastDeviceId=e):s.video.deviceId||(this._lastDeviceId?(delete s.video.facingMode,s.video.deviceId={exact:this._lastDeviceId}):s.video.facingMode&&((l=s.video.facingMode)instanceof Array&&l.length&&(l=l[0]),"environment"===(l=l.exact||l.ideal||l)&&(c=!!s.video.facingMode,_()))),R._onLog&&R._onLog("======try getUserMedia========"),f=[0,500],g=null,v=null,m=function(e){return X(D,void 0,void 0,r.mark((function t(){var n,i,a;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=p(f),t.prev=1,a=r.mark((function t(){var n,a;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.value,o(),t.t0=n,!t.t0){t.next=6;break}return t.next=6,new Promise((function(e){return setTimeout(e,n)}));case 6:return o(),a=e.video.deviceId,v=a?a.exact||a.ideal||a:null,t.prev=9,R._onLog&&R._onLog("ask "+JSON.stringify(e)),t.next=13,navigator.mediaDevices.getUserMedia(e);case 13:return d=t.sent,t.abrupt("return","break");case 17:t.prev=17,t.t1=t.catch(9),g=t.t1,R._onLog&&R._onLog(t.t1.message||t.t1);case 20:case"end":return t.stop()}}),t,null,[[9,17]])})),n.s();case 4:if((i=n.n()).done){t.next=11;break}return t.delegateYield(a(),"t0",6);case 6:if("break"!==t.t0){t.next=9;break}return t.abrupt("break",11);case 9:t.next=4;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(1),n.e(t.t1);case 16:return t.prev=16,n.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[1,13,16,19]])})))},i.next=15,m(s);case 15:if(d){i.next=20;break}return R._onLog&&R._onLog("======try getUserMedia again========"),"object"==typeof(h=JSON.parse(JSON.stringify(s))).video&&("iPhone"==R.browserInfo.OS?(t>=1280||n>=1280?h.video.width=1280:t>=640||n>=640?h.video.width=640:(t<640||n<640)&&(h.video.width=320),delete h.video.height):c&&!s.video.deviceId?(delete h.video.facingMode,this._allCameras.length&&(h.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):h.video=!0),R._onLog&&R._onLog(h),i.next=20,m(h);case 20:if(i.t0=d,i.t0){i.next=25;break}return f=[1e3,2e3],i.next=25,m(s);case 25:if(i.t1=d,i.t1){i.next=29;break}return i.next=29,m(h);case 29:if(d){i.next=31;break}throw g;case 31:return E=function(){var e,t=d.getVideoTracks();t.length&&(e=D._videoTrack=t[0]);var n=void 0;if(D._video&&e){if(e.label){var r,i=p(D._allCameras);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(e.label==a.label){a._checked=!0,n=a,D._lastDeviceId=a.deviceId;break}}}catch(u){i.e(u)}finally{i.f()}}if(!n&&v){var o,s=p(D._allCameras);try{for(s.s();!(o=s.n()).done;){var c=o.value;if(v==c.deviceId){e.label&&(c._checked=!0,c.label=e.label),n=c,D._lastDeviceId=c.deviceId;break}}}catch(u){s.e(u)}finally{s.f()}}}D._currentCamera=n},i.next=34,this.getAllCameras();case 34:if(o(),!c){i.next=46;break}if(E(),_(),(I=s.video.deviceId)&&(I=I.exact||I.ideal||I),A=null===(a=this._currentCamera)||void 0===a?void 0:a.deviceId,i.t2=!I||A&&I==A,i.t2){i.next=46;break}return d.getTracks().forEach((function(e){e.stop()})),f=[0,500,1e3,2e3],i.next=46,m(s);case 46:return o(),b=function(){return X(D,void 0,void 0,r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R._onLog&&R._onLog("======play video========"),e.next=3,new Promise((function(e,n){t._video.onloadedmetadata=function(){return X(t,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._video.onloadedmetadata=null,t.next=3,this._video.play();case 3:e();case 4:case"end":return t.stop()}}),t,this)})))},t._video.srcObject=d,setTimeout((function(){return n(new Error("Failed to play video. Timeout."))}),4e3)}));case 3:case"end":return e.stop()}}),e)})))},i.next=50,b();case 50:return R._onLog&&R._onLog("======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused"),S="got "+this._video.videoWidth+"x"+this._video.videoHeight,this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=S,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),R._onLog&&R._onLog(S),E(),o(),this._renderSelCameraInfo(),T={width:this._video.videoWidth,height:this._video.videoHeight},i.abrupt("return",(this.onPlayed&&setTimeout((function(){D.onPlayed(T)}),0),this.promisePlay=null,T));case 58:throw i.prev=58,i.t3=i.catch(0),this.promisePlay=null,i.t3;case 61:case"end":return i.stop()}}),i,this,[[0,58]])}))),i.next=20,this.promisePlay;case 20:i.t1=i.sent;case 21:return i.abrupt("return",i.t1);case 22:case"end":return i.stop()}}),i,this)})))}},{key:"pauseScan",value:function(){this._assertOpen(),this._bPauseScan=!0,this._divScanLight&&(this._divScanLight.style.display="none")}},{key:"resumeScan",value:function(){this._assertOpen(),this._bPauseScan=!1}},{key:"getCapabilities",value:function(){return this._assertOpen(),this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}},{key:"getCameraSettings",value:function(){return this._assertOpen(),this._videoTrack.getSettings()}},{key:"getConstraints",value:function(){return this._assertOpen(),this._videoTrack.getConstraints()}},{key:"applyConstraints",value:function(e){return X(this,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),this._videoTrack.applyConstraints){t.next=2;break}throw Error("Not supported.");case 2:return t.next=4,this._videoTrack.applyConstraints(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"turnOnTorch",value:function(){return X(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertOpen(),!this.getCapabilities().torch){e.next=4;break}return e.next=3,this._videoTrack.applyConstraints({advanced:[{torch:!0}]});case 3:return e.abrupt("return",e.sent);case 4:throw Error("Not supported.");case 5:case"end":return e.stop()}}),e,this)})))}},{key:"turnOffTorch",value:function(){return X(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertOpen(),!this.getCapabilities().torch){e.next=4;break}return e.next=3,this._videoTrack.applyConstraints({advanced:[{torch:!1}]});case 3:return e.abrupt("return",e.sent);case 4:throw Error("Not supported.");case 5:case"end":return e.stop()}}),e,this)})))}},{key:"setColorTemperature",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().colorTemperature){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({advanced:[{colorTemperature:e}]});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setExposureCompensation",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().exposureCompensation){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setZoom",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().zoom){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({advanced:[{zoom:e}]});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setFrameRate",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().frameRate){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"_cloneDecodeResults",value:function(e){if(e instanceof Array){var t,n=[],r=p(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(this._cloneDecodeResults(i))}}catch(o){r.e(o)}finally{r.f()}return n}var a=e;return JSON.parse(JSON.stringify(a,(function(e,t){return"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t})))}},{key:"_loopReadVideo",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t,n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(this._isOpen){e.next=6;break}return e.next=5,this.clearMapDecodeRecord();case 5:return e.abrupt("return",void e.sent);case 6:if(!this._video.paused&&!this._bPauseScan){e.next=11;break}return R._onLog&&R._onLog("Video or scan is paused. Ask in 1s."),e.next=10,this.clearMapDecodeRecord();case 10:return e.abrupt("return",void setTimeout((function(){n._loopReadVideo()}),this._intervalDetectVideoPause));case 11:this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display=""),R._onLog&&R._onLog("======= once read ======="),R._onLog&&(this._timeStartDecode=Date.now()),t=this.queue_handledFrame,this._countLoopGetFrame=0,0===t.length?this.loopGetVideoFrame(!0):(this._idGetFrameTimeout&&clearTimeout(this._idGetFrameTimeout),this._idGetFrameTimeout=setTimeout((function(){n._countLoopGetFrame++,n.loopGetVideoFrame(!0)}),this._intervalGetVideoFrame)),this._indexCurrentDecodingFrame=this._indexVideoRegion,this.region&&this.region instanceof Array&&++this._indexVideoRegion>=this.region.length&&(this._indexVideoRegion=0),X(n,void 0,void 0,r.mark((function e(){var n,a,o,s,c,u,d,_,l,h,f,g,v,m,E,p,I,A;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t[0]||!t[0].bUseWebGL){e.next=8;break}return n=t.pop(),a=n.u8Gray,o=n.dWidth,s=n.dHeight,this._bWorkerDecodeBuffer=!0,c={bUseWebGL:!0},!this._timeEndGettingFrame||(c._timeEndGettingFrame=this._timeEndGettingFrame),e.next=7,this._decodeBuffer_Uint8Array(a,o,s,o,i.IPF_GrayScaled,c);case 7:return e.abrupt("return",e.sent);case 8:if(!t[0]||!1!==t[0].bUseWebGL){e.next=15;break}return u=t.pop(),d=u.data,_=u.cvs,l=u.config,h=u.region,f=u.sx,g=u.sy,v=u.sWidth,m=u.sHeight,E=u.dWidth,p=u.dHeight,this._bWorkerDecodeBuffer=!0,l.bUseWebGL=!1,!this._timeEndGettingFrame||(l._timeEndGettingFrame=this._timeEndGettingFrame),(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=_),e.next=13,this._decodeBuffer_Uint8Array(d,_.width,_.height,4*_.width,i.IPF_ABGR_8888,l);case 13:return I=e.sent,e.abrupt("return",(R.fixResultLocationWhenFilterRegionInJs(h,I,f,g,v,m,E,p),I));case 15:return A=new Error("queue_handledFrame is empty."),e.abrupt("return",new Promise((function(e){return e(A)})));case 17:case"end":return e.stop()}}),e,this)}))).then((function(e){if(R._onLog&&R._onLog(e),n._bWorkerDecodeBuffer=!1,n._idGetFrameTimeout2&&clearTimeout(n._idGetFrameTimeout2),4===n._getVideoFrameMode){var t,r,i=n.array_decodeFrameTimeCost,a=n.array_getFrameTimeCost,o=n._indexCurrentDecodingFrame;if(n.region instanceof Array?(i[o]&&i[o]instanceof Array?i[o].length>=5&&i[o].shift():i[o]=[],i[o].push(n._lastInnerDecodeDuration)):(i.length>=5&&i.shift(),i.push(n._lastInnerDecodeDuration)),n.region instanceof Array)r=(t=o+1>=n.region.length?0:o+1)+1>=n.region.length?0:t+1,i[t]&&i[t].length&&a[r]&&a[r].length?n._intervalGetVideoFrame=Math.min.apply(Math,Object(_.a)(i[t]))-Math.max.apply(Math,Object(_.a)(a[r])):n._intervalGetVideoFrame=0;else if(a&&a.length){var s=Math.min.apply(Math,Object(_.a)(i)),c=Math.max.apply(Math,Object(_.a)(a));s||c||(n._intervalGetVideoFrame=s-c)}else n._intervalGetVideoFrame=0;n._intervalGetVideoFrame=n._intervalGetVideoFrame>0?n._intervalGetVideoFrame:0}if(n._isOpen&&!n._video.paused&&!n._bPauseScan){if(n.bPlaySoundOnSuccessfulRead&&e.length){var u=!1;if(!0===n.bPlaySoundOnSuccessfulRead||"frame"===n.bPlaySoundOnSuccessfulRead)u=!0;else if("unduplicated"===n.bPlaySoundOnSuccessfulRead){var d,l=p(e);try{for(l.s();!(d=l.n()).done;)if(d.value.bUnduplicated){u=!0;break}}catch(S){l.e(S)}finally{l.f()}}u&&(n.soundOnSuccessfullRead.currentTime=0,n.soundOnSuccessfullRead.play().catch((function(e){console.warn("Autoplay not allowed. User interaction required: "+(e.message||e))})))}if(navigator.vibrate&&n.bVibrateOnSuccessfulRead&&e.length){var h=!1;if(!0===n.bVibrateOnSuccessfulRead||"frame"===n.bVibrateOnSuccessfulRead)h=!0;else if("unduplicated"===n.bVibrateOnSuccessfulRead){var f,g=p(e);try{for(g.s();!(f=g.n()).done;)if(f.value.bUnduplicated){h=!0;break}}catch(S){g.e(S)}finally{g.f()}}if(h)try{navigator.vibrate(n.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(n.onFrameRead){var v,m=n._cloneDecodeResults(e),E=p(m);try{for(E.s();!(v=E.n()).done;)delete v.value.bUnduplicated}catch(S){E.e(S)}finally{E.f()}n.onFrameRead(m)}if(n.onUnduplicatedRead){var I,A=p(e);try{for(A.s();!(I=A.n()).done;){var b=I.value;b.bUnduplicated&&n.onUnduplicatedRead(b.barcodeText,n._cloneDecodeResults(b))}}catch(S){A.e(S)}finally{A.f()}}n._drawRegionsults(e)}setTimeout((function(){n._loopReadVideo()}),n.intervalTime)})).catch((function(e){n._bWorkerDecodeBuffer=!1,R._onLog&&R._onLog(e.message||e),setTimeout((function(){n._loopReadVideo()}),Math.max(n.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}));case 14:case"end":return e.stop()}}),e,this)})))}},{key:"loopGetVideoFrame",value:function(e){var t=this;if(!this.bDestroyed)if(this._isOpen){if(this._video.paused||this._bPauseScan)return R._onLog&&R._onLog("Video or scan is paused. Ask in 1s."),void this.clearMapDecodeRecord();var n=Date.now();R._onLog&&R._onLog("start getting a frame: "+n);var r=this.queue_handledFrame,i={};if(this.region)if(this.region instanceof Array){var a=this.region[this._indexVideoRegion];a&&(i.region=JSON.parse(JSON.stringify(a)))}else i.region=JSON.parse(JSON.stringify(this.region));if(0===this._getVideoFrameMode){var o=this.handleVideoFrame(this._video,i);o&&(r[0]=o)}else if(1===this._getVideoFrameMode){var s=this.handleVideoFrame(this._video,i);s&&(r[0]=s),this._idGetFrameTimeout&&clearTimeout(this._idGetFrameTimeout),e&&(this._idGetFrameTimeout=setTimeout((function(){t._bWorkerDecodeBuffer&&t._countLoopGetFrame<t.loopGetFrameTimes&&(t._countLoopGetFrame++,t.loopGetVideoFrame(!0))}),this._intervalGetVideoFrame))}else if(2===this._getVideoFrameMode){var c=this.handleVideoFrame(this._video,i);c&&(r[0]=c),this._idGetFrameTimeout&&clearTimeout(this._idGetFrameTimeout),this._idGetFrameTimeout=setTimeout((function(){t._bWorkerDecodeBuffer&&t.loopGetVideoFrame(!0)}),this._intervalGetVideoFrame)}else if(4===this._getVideoFrameMode){var u=this.handleVideoFrame(this._video,i);u&&(r[0]=u),this._idGetFrameTimeout&&clearTimeout(this._idGetFrameTimeout),e&&(this._idGetFrameTimeout=setTimeout((function(){t._bWorkerDecodeBuffer&&t._countLoopGetFrame<t.loopGetFrameTimes&&(t._countLoopGetFrame++,t.loopGetVideoFrame(!0))}),this._intervalGetVideoFrame))}this._idGetFrameTimeout2&&clearTimeout(this._idGetFrameTimeout2),this._idGetFrameTimeout2=setTimeout((function(){0!=t.queue_handledFrame.length&&(R._onLog&&R._onLog("second timeout is executed: "+Date.now()),t.loopGetVideoFrame(!1))}),200);var d=Date.now(),_=d-n;if(4===this._getVideoFrameMode){var l=this.array_getFrameTimeCost;if(this.region instanceof Array){var h=this._indexVideoRegion;l[h]&&l[h]instanceof Array?l[h].length>=5&&l[h].shift():l[h]=[],l[h].push(_)}else l.length>=5&&l.shift(),l.push(_)}this._timeEndGettingFrame=d,R._onLog&&R._onLog("end getting a frame: "+d),R._onLog&&R._onLog("get frame cost: "+_)}else this.clearMapDecodeRecord()}},{key:"_drawRegionsults",value:function(e){var t,n,r;if(this.beingLazyDrawRegionsults=!1,this.singleFrameMode){if(!this.oriCanvas)return;t="contain",n=this.oriCanvas.width,r=this.oriCanvas.height}else{if(!this._video)return;t=this._video.style.objectFit||"contain",n=this._video.videoWidth,r=this._video.videoHeight}var i=this.region;if(i&&(!i.regionLeft&&!i.regionRight&&!i.regionTop&&!i.regionBottom&&!i.regionMeasuredByPercentage||i instanceof Array?i=null:i.regionMeasuredByPercentage?i=i.regionLeft||i.regionRight||100!==i.regionTop||100!==i.regionBottom?{regionLeft:Math.round(i.regionLeft/100*n),regionTop:Math.round(i.regionTop/100*r),regionRight:Math.round(i.regionRight/100*n),regionBottom:Math.round(i.regionBottom/100*r)}:null:delete(i=JSON.parse(JSON.stringify(i))).regionMeasuredByPercentage),this._cvsDrawArea){this._cvsDrawArea.style.objectFit=t;var a=this._cvsDrawArea;a.width=n,a.height=r;var o=a.getContext("2d");if(i){o.fillStyle=this.regionMaskFillStyle,o.fillRect(0,0,a.width,a.height),o.globalCompositeOperation="destination-out",o.fillStyle="#000";var s=Math.round(this.regionMaskLineWidth/2);o.fillRect(i.regionLeft-s,i.regionTop-s,i.regionRight-i.regionLeft+2*s,i.regionBottom-i.regionTop+2*s),o.globalCompositeOperation="source-over",o.strokeStyle=this.regionMaskStrokeStyle,o.lineWidth=this.regionMaskLineWidth,o.rect(i.regionLeft,i.regionTop,i.regionRight-i.regionLeft,i.regionBottom-i.regionTop),o.stroke()}if(e){o.globalCompositeOperation="destination-over",o.fillStyle=this.barcodeFillStyle,o.strokeStyle=this.barcodeStrokeStyle,o.lineWidth=this.barcodeLineWidth;var c,u=p(e=e||[]);try{for(u.s();!(c=u.n()).done;){var d=c.value.localizationResult;o.beginPath(),o.moveTo(d.x1,d.y1),o.lineTo(d.x2,d.y2),o.lineTo(d.x3,d.y3),o.lineTo(d.x4,d.y4),o.fill(),o.beginPath(),o.moveTo(d.x1,d.y1),o.lineTo(d.x2,d.y2),o.lineTo(d.x3,d.y3),o.lineTo(d.x4,d.y4),o.closePath(),o.stroke()}}catch(E){u.e(E)}finally{u.f()}}this.singleFrameMode&&(o.globalCompositeOperation="destination-over",o.drawImage(this.oriCanvas,0,0))}if(this._divScanArea){var _=this._video.offsetWidth,l=this._video.offsetHeight,h=1;_/l<n/r?(h=_/n,this._divScanArea.style.left="0",this._divScanArea.style.top=Math.round((l-r*h)/2)+"px"):(h=l/r,this._divScanArea.style.left=Math.round((_-n*h)/2)+"px",this._divScanArea.style.top="0");var f=i?Math.round(i.regionLeft*h):0,g=i?Math.round(i.regionTop*h):0,v=i?Math.round(i.regionRight*h-f):Math.round(n*h),m=i?Math.round(i.regionBottom*h-g):Math.round(r*h);this._divScanArea.style.marginLeft=f+"px",this._divScanArea.style.marginTop=g+"px",this._divScanArea.style.width=v+"px",this._divScanArea.style.height=m+"px"}}},{key:"_clearRegionsults",value:function(){this._cvsDrawArea&&(this._cvsDrawArea.width=this._cvsDrawArea.height=0)}},{key:"open",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this.singleFrameMode||this._loopReadVideo(),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"openVideo",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this._bPauseScan=!0,this.singleFrameMode||this._loopReadVideo(),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"close",value:function(){return X(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stop(),this._unbindUI(),this._bPauseScan=!1;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"show",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),this._show(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this.singleFrameMode||this._loopReadVideo(),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"showVideo",value:function(){return X(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),this._show(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this._bPauseScan=!0,this.singleFrameMode||this._loopReadVideo(),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"hide",value:function(){return X(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stop(),this._unbindUI(),this._bPauseScan=!1,this.UIElement.style.display="none";case 1:case"end":return e.stop()}}),e,this)})))}},{key:"destroy",value:function(){var e=this,t=Object.create(null,{destroyContext:{get:function(){return f(Object(h.a)(n.prototype),"destroyContext",e)}}});return X(this,void 0,void 0,r.mark((function e(){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.removeEventListener("visibilitychange",this._ev_documentHideEvent),e.next=3,this.close();case 3:n=p(this.styleEls);try{for(n.s();!(i=n.n()).done;)i.value.remove()}catch(r){n.e(r)}finally{n.f()}if(this.styleEls.splice(0,this.styleEls.length),e.t0=this.bDestroyed,e.t0){e.next=10;break}return e.next=10,t.destroyContext.call(this);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"destroyContext",value:function(){return X(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.destroy());case 1:case"end":return e.stop()}}),e,this)})))}}],[{key:"defaultUIElementURL",get:function(){var e;return null===(e=this._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",R.engineResourcePath)},set:function(e){this._defaultUIElementURL=e}},{key:"createInstance",value:function(e){return X(this,void 0,void 0,r.mark((function t(){var i,a;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Q){t.next=2;break}throw new Error("`BarcodeScanner` is not supported in Node.js.");case 2:return i=new n,t.next=5,n.createInstanceInWorker(!0);case 5:for(a in i._instanceID=t.sent,("string"==typeof e||e instanceof String)&&(e=JSON.parse(e)),e)i[a]=e[a];return t.next=10,i.setUIElement(this.defaultUIElementURL);case 10:if(i.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),t.t0=i.singleFrameMode,t.t0){t.next=15;break}return t.next=15,i.updateRuntimeSettings("single");case 15:return document.addEventListener("visibilitychange",i._ev_documentHideEvent),t.abrupt("return",i);case 17:case"end":return t.stop()}}),t,this)})))}},{key:"isRegionSinglePreset",value:function(e){return JSON.stringify(e)==JSON.stringify(this.singlePresetRegion)}},{key:"isRegionNormalPreset",value:function(e){return 0==e.regionLeft&&0==e.regionTop&&0==e.regionRight&&0==e.regionBottom&&0==e.regionMeasuredByPercentage}}]),n}(R);z._defaultUIElementURL="@engineResourcePath/dbr.scanner.html",z.singlePresetRegion=[null,{regionLeft:0,regionTop:30,regionRight:100,regionBottom:70,regionMeasuredByPercentage:1},{regionLeft:25,regionTop:25,regionRight:75,regionBottom:75,regionMeasuredByPercentage:1},{regionLeft:25,regionTop:25,regionRight:75,regionBottom:75,regionMeasuredByPercentage:1}],function(e){e[e.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",e[e.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",e[e.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",e[e.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",e[e.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",e[e.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",e[e.BICM_SKIP=0]="BICM_SKIP",e[e.BICM_REV=2147483648]="BICM_REV"}(I||(I={})),function(e){e[e.BCM_AUTO=1]="BCM_AUTO",e[e.BCM_GENERAL=2]="BCM_GENERAL",e[e.BCM_SKIP=0]="BCM_SKIP",e[e.BCM_REV=2147483648]="BCM_REV"}(A||(A={})),function(e){e[e.BF2_NULL=0]="BF2_NULL",e[e.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",e[e.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",e[e.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",e[e.BF2_POSTNET=2097152]="BF2_POSTNET",e[e.BF2_PLANET=4194304]="BF2_PLANET",e[e.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",e[e.BF2_RM4SCC=16777216]="BF2_RM4SCC",e[e.BF2_DOTCODE=2]="BF2_DOTCODE"}(b||(b={})),function(e){e[e.BM_AUTO=1]="BM_AUTO",e[e.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",e[e.BM_SKIP=0]="BM_SKIP",e[e.BM_THRESHOLD=4]="BM_THRESHOLD",e[e.BM_REV=2147483648]="BM_REV"}(S||(S={})),function(e){e[e.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(T||(T={})),function(e){e[e.CFM_GENERAL=1]="CFM_GENERAL"}(D||(D={})),function(e){e[e.CCM_AUTO=1]="CCM_AUTO",e[e.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",e[e.CCM_SKIP=0]="CCM_SKIP",e[e.CCM_REV=2147483648]="CCM_REV"}(y||(y={})),function(e){e[e.CICM_GENERAL=1]="CICM_GENERAL",e[e.CICM_SKIP=0]="CICM_SKIP",e[e.CICM_REV=2147483648]="CICM_REV"}(M||(M={})),function(e){e[e.CM_IGNORE=1]="CM_IGNORE",e[e.CM_OVERWRITE=2]="CM_OVERWRITE"}(C||(C={})),function(e){e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(k||(k={})),function(e){e[e.DRM_AUTO=1]="DRM_AUTO",e[e.DRM_GENERAL=2]="DRM_GENERAL",e[e.DRM_SKIP=0]="DRM_SKIP",e[e.DRM_REV=2147483648]="DRM_REV"}(L||(L={})),function(e){e[e.DPMCRM_AUTO=1]="DPMCRM_AUTO",e[e.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",e[e.DPMCRM_SKIP=0]="DPMCRM_SKIP",e[e.DPMCRM_REV=2147483648]="DPMCRM_REV"}(O||(O={})),function(e){e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_REV=2147483648]="GTM_REV"}(x||(x={})),function(e){e[e.IPM_AUTO=1]="IPM_AUTO",e[e.IPM_GENERAL=2]="IPM_GENERAL",e[e.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",e[e.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",e[e.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",e[e.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",e[e.IPM_SKIP=0]="IPM_SKIP",e[e.IPM_REV=2147483648]="IPM_REV"}(B||(B={})),function(e){e[e.IRSM_MEMORY=1]="IRSM_MEMORY",e[e.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",e[e.IRSM_BOTH=4]="IRSM_BOTH"}(w||(w={})),function(e){e[e.IRT_NO_RESULT=0]="IRT_NO_RESULT",e[e.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",e[e.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",e[e.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",e[e.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",e[e.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",e[e.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",e[e.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",e[e.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",e[e.IRT_CONTOUR=256]="IRT_CONTOUR",e[e.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",e[e.IRT_FORM=1024]="IRT_FORM",e[e.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",e[e.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",e[e.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(N||(N={})),function(e){e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_REV=2147483648]="LM_REV"}(F||(F={})),function(e){e[e.PDFRM_RASTER=1]="PDFRM_RASTER",e[e.PDFRM_AUTO=2]="PDFRM_AUTO",e[e.PDFRM_VECTOR=4]="PDFRM_VECTOR",e[e.PDFRM_REV=2147483648]="PDFRM_REV"}(P||(P={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(G||(G={})),function(e){e[e.RPM_AUTO=1]="RPM_AUTO",e[e.RPM_GENERAL=2]="RPM_GENERAL",e[e.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",e[e.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",e[e.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",e[e.RPM_SKIP=0]="RPM_SKIP",e[e.RPM_REV=2147483648]="RPM_REV"}(U||(U={})),function(e){e[e.RCT_PIXEL=1]="RCT_PIXEL",e[e.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(V||(V={})),function(e){e[e.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",e[e.RT_RAW_TEXT=1]="RT_RAW_TEXT",e[e.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",e[e.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(W||(W={})),function(e){e[e.SUM_AUTO=1]="SUM_AUTO",e[e.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",e[e.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",e[e.SUM_SKIP=0]="SUM_SKIP",e[e.SUM_REV=2147483648]="SUM_REV"}(H||(H={})),function(e){e[e.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",e[e.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",e[e.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",e[e.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",e[e.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",e[e.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(K||(K={})),function(e){e[e.TFM_AUTO=1]="TFM_AUTO",e[e.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",e[e.TFM_SKIP=0]="TFM_SKIP",e[e.TFM_REV=2147483648]="TFM_REV"}(j||(j={})),function(e){e[e.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",e[e.TROM_POSITION=2]="TROM_POSITION",e[e.TROM_FORMAT=4]="TROM_FORMAT",e[e.TROM_SKIP=0]="TROM_SKIP",e[e.TROM_REV=2147483648]="TROM_REV"}(J||(J={})),function(e){e[e.TDM_AUTO=1]="TDM_AUTO",e[e.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",e[e.TDM_SKIP=0]="TDM_SKIP",e[e.TDM_REV=2147483648]="TDM_REV"}(Y||(Y={}));var Z=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"version",get:function(){return R.version}},{key:"productKeys",get:function(){return R.productKeys},set:function(e){R.productKeys=e}},{key:"handshakeCode",get:function(){return R.handshakeCode},set:function(e){R.handshakeCode=e}},{key:"organizationID",get:function(){return R.organizationID},set:function(e){R.organizationID=e}},{key:"sessionPassword",get:function(){return R.sessionPassword},set:function(e){R.sessionPassword=e}},{key:"browserInfo",get:function(){return R.browserInfo}},{key:"detectEnvironment",value:function(){return R.detectEnvironment()}},{key:"_workerName",get:function(){return R._workerName},set:function(e){R._workerName=e}},{key:"engineResourcePath",get:function(){return R.engineResourcePath},set:function(e){R.engineResourcePath=e}},{key:"licenseServer",get:function(){return R.licenseServer},set:function(e){R.licenseServer=e}},{key:"deviceFriendlyName",get:function(){return R.deviceFriendlyName},set:function(e){R.deviceFriendlyName=e}},{key:"_onLog",get:function(){return R._onLog},set:function(e){R._onLog=e}},{key:"_bWasmDebug",get:function(){return R._bWasmDebug},set:function(e){R._bWasmDebug=e}},{key:"_bUseFullFeature",get:function(){return R._bUseFullFeature},set:function(e){R._bUseFullFeature=e}},{key:"_dbrWorker",get:function(){return R._dbrWorker}},{key:"isLoaded",value:function(){return R.isLoaded()}},{key:"isWasmLoaded",value:function(){return R.isLoaded()}},{key:"loadWasm",value:function(){return R.loadWasm()}}]),e}();Z.BarcodeReader=R,Z.BarcodeScanner=z,Z.EnumBarcodeColourMode=I,Z.EnumBarcodeComplementMode=A,Z.EnumBarcodeFormat=g,Z.EnumBarcodeFormat_2=b,Z.EnumBinarizationMode=S,Z.EnumClarityCalculationMethod=T,Z.EnumClarityFilterMode=D,Z.EnumColourClusteringMode=y,Z.EnumColourConversionMode=M,Z.EnumConflictMode=C,Z.EnumDeblurMode=k,Z.EnumDeformationResistingMode=L,Z.EnumDPMCodeReadingMode=O,Z.EnumErrorCode=a,Z.EnumGrayscaleTransformationMode=x,Z.EnumImagePixelFormat=i,Z.EnumImagePreprocessingMode=B,Z.EnumIMResultDataType=d,Z.EnumIntermediateResultSavingMode=w,Z.EnumIntermediateResultType=N,Z.EnumLocalizationMode=F,Z.EnumPDFReadingMode=P,Z.EnumQRCodeErrorCorrectionLevel=G,Z.EnumRegionPredetectionMode=U,Z.EnumResultCoordinateType=V,Z.EnumResultType=W,Z.EnumScaleUpMode=H,Z.EnumTerminatePhase=K,Z.EnumTextFilterMode=j,Z.EnumTextResultOrderMode=J,Z.EnumTextureDetectionMode=Y,t.default=Z}])},"object"==typeof exports&&"object"==typeof e?e.exports=v():"function"==typeof define&&define.amd?define(v):"object"==typeof exports?exports.dbr=v():g.dbr=v(g.worker_threads,g.https,g.http,g.fs,g.os),"object"==typeof dbr?m=dbr.DBR:"object"==typeof e&&e.exports&&e.exports.default?m=e.exports.default:"object"==typeof exports&&exports.dbr&&(m=exports.dbr.DBR);var R=m;m.DBR,m.BarcodeReader,m.BarcodeScanner,m.EnumBarcodeColourMode,m.EnumBarcodeComplementMode,m.EnumBarcodeFormat,m.EnumBarcodeFormat_2,m.EnumBinarizationMode,m.EnumClarityCalculationMethod,m.EnumClarityFilterMode,m.EnumColourClusteringMode,m.EnumColourConversionMode,m.EnumConflictMode,m.EnumDeblurMode,m.EnumDeformationResistingMode,m.EnumDPMCodeReadingMode,m.EnumErrorCode,m.EnumGrayscaleTransformationMode,m.EnumImagePixelFormat,m.EnumImagePreprocessingMode,m.EnumIMResultDataType,m.EnumIntermediateResultSavingMode,m.EnumIntermediateResultType,m.EnumLocalizationMode,m.EnumPDFReadingMode,m.EnumQRCodeErrorCorrectionLevel,m.EnumRegionPredetectionMode,m.EnumResultCoordinateType,m.EnumResultType,m.EnumScaleUpMode,m.EnumTerminatePhase,m.EnumTextFilterMode,m.EnumTextResultOrderMode,m.EnumTextureDetectionMode;R.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@8.6.3/dist/";var I=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"toggleTorch",value:function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.on?this.scanner.turnOnTorch():this.scanner.turnOffTorch(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new Error("Torch unsupported");case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScan",value:function(){var e=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.scanner.hide(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()},{key:"scan",value:function(){var e=Object(a.a)(i.a.mark((function e(t){var n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.scanningResult=void 0,void 0!==this.scanner){e.next=14;break}return t.organizationID?(R.BarcodeScanner.organizationID=t.organizationID,console.log("set organization ID")):t.license&&(R.BarcodeScanner.productKeys=t.license),e.next=5,R.BarcodeScanner.createInstance();case 5:if(this.scanner=e.sent,!t.template){e.next=10;break}return e.next=9,this.scanner.initRuntimeSettingsWithString(t.template);case 9:console.log("Using template");case 10:this.scanner.onFrameRead=function(e){e.length>0&&(n.scanner.close(),n.scanner.hide(),n.scanningResult=e[0])},this.scanner.UIElement.getElementsByClassName("dbrScanner-btn-close")[0].remove(),e.next=15;break;case 14:console.log("Scanner already initialized.");case 15:return e.next=17,this.scanner.show();case 17:return e.next=19,this.getResult();case 19:if(!e.sent){e.next=24;break}return e.abrupt("return",{barcodeText:this.scanningResult.barcodeText,barcodeFormat:this.scanningResult.barcodeFormatString,barcodeBytesBase64:this.arrayBufferToBase64(this.scanningResult.barcodeBytes)});case 24:throw new Error("Failed to scan");case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getResult",value:function(){var e=this;return new Promise(function(){var t=Object(a.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.scanningResult){t.next=5;break}return t.next=3,e.sleep(500);case 3:t.next=0;break;case 5:n(!0);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"sleep",value:function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sleep(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sleep",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"arrayBufferToBase64",value:function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return window.btoa(t)}}]),n}(d.b)}}]);
//# sourceMappingURL=4.ce4a6567.chunk.js.map